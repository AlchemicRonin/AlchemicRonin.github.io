<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>双象杀单王</title>
    <link href="/posts/12c50f09/"/>
    <url>/posts/12c50f09/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=28563214&auto=1&height=66"></iframe><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p><strong>国际象棋初级教程</strong><br><strong>第三章 残局入门</strong><br><strong>第一节 单王杀局</strong><br><strong>四、双象杀单王</strong></p><hr><h2 id="『练习』"><a href="#『练习』" class="headerlink" title="『练习』"></a>『练习』</h2><h3 id="52"><a href="#52" class="headerlink" title="52"></a>52</h3><iframe id="6575194" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575194"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575194"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="53"><a href="#53" class="headerlink" title="53"></a>53</h3><iframe id="6575388" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575388"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575388"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="54"><a href="#54" class="headerlink" title="54"></a>54</h3><iframe id="6575382" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575382"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575382"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><hr><h2 id="『解答』"><a href="#『解答』" class="headerlink" title="『解答』"></a>『解答』</h2><h3 id="52-1"><a href="#52-1" class="headerlink" title="52"></a>52</h3><iframe id="6575184" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575184"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575184"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="53-1"><a href="#53-1" class="headerlink" title="53"></a>53</h3><iframe id="6575364" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575364"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575364"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="54-1"><a href="#54-1" class="headerlink" title="54"></a>54</h3><iframe id="6575380" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575380"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575380"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Chess</tag>
      
      <tag>国际象棋初级教程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>单车杀单王</title>
    <link href="/posts/28ffee28/"/>
    <url>/posts/28ffee28/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=28563214&auto=1&height=66"></iframe><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p><strong>国际象棋初级教程</strong><br><strong>第三章 残局入门</strong><br><strong>第一节 单王杀局</strong><br><strong>三、单车杀单王</strong></p><hr><h2 id="『练习』"><a href="#『练习』" class="headerlink" title="『练习』"></a>『练习』</h2><h3 id="50"><a href="#50" class="headerlink" title="50"></a>50</h3><iframe id="6575014" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575014"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575014"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="51"><a href="#51" class="headerlink" title="51"></a>51</h3><iframe id="6575032" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575032"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575032"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><hr><h2 id="『解答』"><a href="#『解答』" class="headerlink" title="『解答』"></a>『解答』</h2><h3 id="50-1"><a href="#50-1" class="headerlink" title="50"></a>50</h3><iframe id="6574982" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6574982"></iframe><script>window.addEventListener("message",e=>{e.data&&"6574982"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="51-1"><a href="#51-1" class="headerlink" title="51"></a>51</h3><iframe id="6575026" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6575026"></iframe><script>window.addEventListener("message",e=>{e.data&&"6575026"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Chess</tag>
      
      <tag>国际象棋初级教程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>后杀单王</title>
    <link href="/posts/9210f0e/"/>
    <url>/posts/9210f0e/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=28563214&auto=1&height=66"></iframe><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p><strong>国际象棋初级教程</strong><br><strong>第三章 残局入门</strong><br><strong>第一节 单王杀局</strong><br><strong>二、后杀单王</strong></p><hr><h2 id="『练习』"><a href="#『练习』" class="headerlink" title="『练习』"></a>『练习』</h2><h3 id="49"><a href="#49" class="headerlink" title="49"></a>49</h3><iframe id="6573292" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573292"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573292"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><hr><h2 id="『解答』"><a href="#『解答』" class="headerlink" title="『解答』"></a>『解答』</h2><h3 id="49-1"><a href="#49-1" class="headerlink" title="49"></a>49</h3><iframe id="6573290" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573290"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573290"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Chess</tag>
      
      <tag>国际象棋初级教程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>双车杀单王</title>
    <link href="/posts/fa0386b7/"/>
    <url>/posts/fa0386b7/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=28563214&auto=1&height=66"></iframe><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p><strong>国际象棋初级教程</strong><br><strong>第三章 残局入门</strong><br><strong>第一节 单王杀局</strong><br><strong>一、双车杀单王</strong></p><hr><h2 id="『练习』"><a href="#『练习』" class="headerlink" title="『练习』"></a>『练习』</h2><h3 id="45"><a href="#45" class="headerlink" title="45"></a>45</h3><iframe id="6573086" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573086"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573086"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="46"><a href="#46" class="headerlink" title="46"></a>46</h3><iframe id="6573094" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573094"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573094"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="47"><a href="#47" class="headerlink" title="47"></a>47</h3><iframe id="6573112" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573112"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573112"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><hr><h2 id="『解答』"><a href="#『解答』" class="headerlink" title="『解答』"></a>『解答』</h2><h3 id="45-1"><a href="#45-1" class="headerlink" title="45"></a>45</h3><iframe id="6573074" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573074"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573074"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="46-1"><a href="#46-1" class="headerlink" title="46"></a>46</h3><iframe id="6573102" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573102"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573102"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script><h3 id="47-1"><a href="#47-1" class="headerlink" title="47"></a>47</h3><iframe id="6573106" allowtransparency="true" frameborder="0" style="width:100%;border:none;" src="//www.chess.com/emboard?id=6573106"></iframe><script>window.addEventListener("message",e=>{e.data&&"6573106"===e.data.id&&document.getElementById(`${e.data.id}`)&&(document.getElementById(`${e.data.id}`).style.height=`${e.data.frameHeight+30}px`)});</script>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Chess</tag>
      
      <tag>国际象棋初级教程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进阶篇 VII [CAN]</title>
    <link href="/posts/59eedfd8/"/>
    <url>/posts/59eedfd8/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="1-0-什么是CAN"><a href="#1-0-什么是CAN" class="headerlink" title="1.0 什么是CAN?"></a>1.0 什么是CAN?</h2><h3 id="1-1-背景-定义"><a href="#1-1-背景-定义" class="headerlink" title="1.1 背景 + 定义"></a>1.1 背景 + 定义</h3><blockquote><p><strong>Controller Area Network 控制器局域网络</strong> 是ISO国际标准化的串行通信协议。在汽车产业中，出于对安全性、舒适性、方便性、低公害、低成本的要求，各种各样的电子控制系统被开发了出来。由于这些系统之间通信所用的数据类型及对可靠性的要求不尽相同，由多条总线构成的情况很多，线束的数量也随之增加。为适应“减少线束的数量”、“通过多个LAN，进行大量数据的高速通信”的需要，1986 年德国电气商博世公司开发出面向汽车的CAN 通信协议。此后，CAN 通过ISO11898及ISO11519进行了标准化，在欧洲已是汽车网络的标准协议。</p><p>CAN 的高性能和可靠性已被认同，并被广泛地应用于工业自动化、船舶、医疗设备、工业设备等方面。现场总线是当今自动化领域技术发展的热点之一，被誉为自动化领域的计算机局域网。它的出现为分布式控制系统实现各节点之间实时、可靠的数据通信提供了强有力的技术支持。近年来，它具有的高可靠性和良好的错误检测能力受到重视，被广泛应用于汽车计算机控制系统和环境温度恶劣、电磁辐射强及振动大的工业环境。</p></blockquote><h3 id="1-2-意义-优势"><a href="#1-2-意义-优势" class="headerlink" title="1.2 意义 + 优势"></a>1.2 意义 + 优势</h3><blockquote><ol><li><strong>多主控制</strong><ul><li>在总线空闲时，所有的单元都可开始发送消息（多主控制）</li><li>最先访问总线的单元可获得发送权（CSMA/CA力式）</li><li>多个单元同时开始发送时，发送高优先级 ID 消息的单元可获得发送权</li></ul></li><li><strong>消息的发送</strong><ul><li>在CAN协议中，所有的消息都以固定的格式发送。总线空闲时，所有与总线相连的单元都可开始发送新消息。两个以上的单元同时开始发送消息时，根据标识符（Identifier以下称为ID）决定优先级。ID并不是表示发送的目的地址，而是表示访问总线的消息的优先级。两个以上的单元同时开始发送消息时，对各消息ID的每个位进行逐个仲裁比较。仲裁获胜（被判定为优先级最高）的单元可继续发送消息。仲裁失利的单元则立刻停止发送而进行接收工作。</li></ul></li><li><strong>系统的柔软性</strong><ul><li>与总线相连的单元没有类似于“地址”的信息。因此在总线上增加单元时，连接在总线上的其他单元的软硬件及应用层都不需要改变。</li></ul></li><li><strong>通信速度</strong><ul><li>根据整个网络的规模，可设定适合的通信速度。在同一网络中，所有单元必须设定成统一的通信速度。即使有一个单元的通信速度与其它的不一样。此单元也会输出错误信号，妨碍整个网络的通信。不同网络间则可以有不同的通信速度。</li></ul></li><li><strong>远程数据请求</strong><ul><li>可通过发送“遥控帧”，请求其他单元发送数据。</li></ul></li><li><strong>错误检测功能</strong><ul><li>所有的单元都可以检测错误（错误检测功能）</li><li>检测出错误的单元会立即同时通知其他所有单元（错误通知功能）</li><li>正在发送消息的单元一旦检测出错误，会强制结束当前的发送。强制结束发送的单元会不断反复地重新发送此消息直到成功发送为止（错误恢复功能）</li></ul></li><li><strong>故障封闭</strong><ul><li>CAN可以判断出错误的类型是总线上暂时的数据错误（如外部噪声等）还是持续的数据错误（如单元内部故障、驱动器故障、断线等）。由此功能，当总线上发生持续数据错误时，可将引起此故障的单元从总线上隔离出去。</li></ul></li><li><strong>连接</strong><ul><li>CAN总线是可同时连接多个单元的总线。可连接的单元总数理论上是没有限制的。但实际上可连接的单元数受总线上的时间延迟及电气负载的限制。降低通信速度，可连接的单元数增加：提高通信速度，则可连接的单元数减少。</li></ul></li></ol></blockquote><h2 id="2-0-CAN原理"><a href="#2-0-CAN原理" class="headerlink" title="2.0 CAN原理"></a>2.0 CAN原理</h2><h3 id="2-1-Differential-signal-差分信号"><a href="#2-1-Differential-signal-差分信号" class="headerlink" title="2.1  Differential signal 差分信号"></a>2.1  Differential signal 差分信号</h3><p><img src="https://i.loli.net/2020/03/30/rmacW45kE8Y13T2.jpg" alt="ISO11898-2.jpg"></p><p>从上图我们可以看到，与图中下部分的普通信号不同，并不是低电平表示0高电平表示1，而是当两根数据线在同一时刻，如果有电压差表示0无电压差表示1。</p><p>相对于单信号线传输的方式，使用差分信号传输具有如下优点：</p><ul><li><strong>抗干扰能力强</strong>：当外界存在噪声干扰时，几乎会同时耦合到两条信号线上，而接收端只关心两个信号的差值，所以外界的共模噪声可以被完全抵消。</li><li><strong>有效抑制电磁干扰</strong>：同样的道理，由于两根信号的极性相反，他们对外辐射的电磁场可以相互抵消，耦合的越紧密，泄放到外界的电磁能量越少。</li><li><strong>时序定位精确</strong>：由于差分信号的开关变化是位于两个信号的交点，而不像普通单端信号依靠高低两个阈值电压判断，因而受工艺，温度的影响小，能降低时序上的误差，同时也更适合于低幅度信号的电路</li></ul><p>由于差分信号线具有这些优点，所以在USB协议，485 协议，以太网协议，及 CAN 协议的物理层中，都使用了差分信号传输。</p><p><img src="https://i.loli.net/2020/03/30/pRTdzBhxfG6YvEL.png" alt="CAN node.png"></p><p>虽然CAN是通过差分信号传输数据，但是MCU不是，所以需要CAN Transceiver来把MCU的普通信号转换成差分信号。STM32并不自己提供该功能，所以需要外接CAN Transceiver。</p><h3 id="2-2-Time-Quantum-时间量子"><a href="#2-2-Time-Quantum-时间量子" class="headerlink" title="2.2 Time Quantum 时间量子"></a>2.2 Time Quantum 时间量子</h3><ul><li>数据的每一Bit位，都分为4段<ul><li>同步段 ( SS / Sync )</li><li>传播时间段 ( PTS / Prop )</li><li>相位缓冲段 1 ( PBS1 / Phase 1 )</li><li>相位缓冲段 2 ( PBS2 / Phase 2 )</li></ul></li></ul><p><img src="https://i.loli.net/2020/03/30/xNarijqgA28Mf95.jpg" alt="CAN_Bit_Timing2.jpg"></p><ul><li>而这每一段又由称为Time Quantum 时间量子的最小时间单位组成</li></ul><h3 id="2-3-Data-Frame-数据帧"><a href="#2-3-Data-Frame-数据帧" class="headerlink" title="2.3 Data Frame 数据帧"></a>2.3 Data Frame 数据帧</h3><p>在CAN标准中，分为标准格式和扩展格式，而帧也分为5种</p><ul><li><strong>数据帧</strong></li><li>遥控帧</li><li>错误帧</li><li>过载帧</li><li>间隔帧</li></ul><p>我们这里主要解析一下数据帧</p><p><img src="https://i.loli.net/2020/03/30/xLAM7N31Dh2keVd.jpg" alt="CAN-Bus-frame_in_base_format_without_stuffbits_1.jpg"></p><p>每个数据帧总共包含7个段</p><ol><li><strong>Start of Frame 帧起始</strong>：表示数据帧开始的段</li><li><strong>Arbitration Field 仲裁段</strong>：表示该帧优先级的段</li><li><strong>Control 控制段</strong>：表示数据的字节数及保留位的段</li><li><strong>Data 数据段</strong>：数据的内容，一帧可发送 0~8 个字节的数据</li><li><strong>CRC Field CRC段</strong>：检查帧的传输错误的段</li><li><strong>ACK Field ACK段</strong>：表示确认正常接收的段</li><li><strong>End of Frame 帧结束</strong>：表示数据帧结束的段</li></ol><h3 id="2-4-Arbitration-仲裁"><a href="#2-4-Arbitration-仲裁" class="headerlink" title="2.4 Arbitration 仲裁"></a>2.4 Arbitration 仲裁</h3><p><img src="https://i.loli.net/2020/03/30/DfN6Ws4jcUumnY9.jpg" alt="arbitration.jpg"></p><p>在CAN中，仲裁是为了解决当同一时刻有多个Node在试图发送信息的时候，让优先权最大的那个Node先发。在CAN中，1是隐性电平，0是显性电平，在ID中显性电平越靠前越多，也就是ID越小，优先权越大。在仲裁的时候，比如有上图中的3个Node同时发送数据，当他们同时发送帧ID的时候，CAN的特性之一就会起作用，<strong>隐性电平会被显性电平覆盖</strong>，也就是只要在同一时刻，CAN上既有Node发送隐性电平又有Node发送显性电平，那CAN上就只有显性电平，反过来说，只有当CAN上所有Node都只发送隐性电平的时候，CAN上才是隐性电平。这就是仲裁机制背后的物理机制。</p><p>然后接下来，我们继续谈谈仲裁的过程中到底发生了什么，继续上图的例子，在时刻5的时候，Node 2是隐性电平 ( 1 ) ，而其他Node是显性电平 ( 0 ) ，所以整个CAN上也是显性电平 ( 0 ) ，然后Node 2自己一对比自己的输入输出不同，很自觉得知道自己优先权比其他Node低，然后停止发送数据，转为监听模式，Node 1和Node 3继续仲裁。在时刻2的时候，Node 1是隐性电平 ( 1 ) ，而Node 3是显性电平 ( 0 ) ，所以Node 1也转为监听模式，最后当整个ID发送完，仲裁完成后，只有Node 3发现自己没事，就知道自己是优先权最大的那个，接下来就继续发送数据帧，而其他Node就暂停发送数据，一直监听Node 3的数据，直到Node 3发完数据，其他Node再继续仲裁下去，决定接下来的发送权。</p><h2 id="3-0-STM32的CAN配置原理"><a href="#3-0-STM32的CAN配置原理" class="headerlink" title="3.0 STM32的CAN配置原理"></a>3.0 STM32的CAN配置原理</h2><h3 id="3-1-图解CAN内部实现机构"><a href="#3-1-图解CAN内部实现机构" class="headerlink" title="3.1 图解CAN内部实现机构"></a>3.1 图解CAN内部实现机构</h3><p><img src="https://i.loli.net/2020/03/30/Wu1C8gAadiDZv79.jpg" alt="Reference-Manual-1079.jpg"></p><p>从图上我们可以看到，CAN 1与CAN 2为主从关系，CAN 1为Master ( 主 ) ，CAN 2为Slave ( 从 ) 。CAN 1和CAN 2有各自的3个发送邮箱，2个FIFO Buffer缓冲，6个接收邮箱。但是，28个Filter 过滤器却是共用的，我们可以规定，哪些Filter给那个CAN用，甚至可以在程序运行的时候调控。</p><p><img src="https://i.loli.net/2020/03/30/hHmq1MaRX2p7Q5d.png" alt="Transmit Mailbox.png"></p><p><img src="https://i.loli.net/2020/03/30/AoPq8lhRLzgwvyI.png" alt="Receive Mailbox.png"></p><p>上面俩图是发送邮箱和接收邮箱的具体的流程和机制。具体的细节就实在太多了，本文毕竟不是参考手册，想更加深入的看官，可以去ST官方的<em>Reference Manual</em>查阅具体细节。</p><h3 id="3-2-Filter-过滤器"><a href="#3-2-Filter-过滤器" class="headerlink" title="3.2 Filter 过滤器"></a>3.2 Filter 过滤器</h3><p>Filter 过滤器就很简单了，就是过滤接收到的每一帧的ID，如果符合特定条件，那就将该帧放入接收FIFO中。</p><p>Filter 过滤器有两种模式：</p><ol><li><strong>Identifier List Mode 标识符列表模式</strong>：它把要接收报文的 ID 列成一个表，要求报文 ID 与列表中的某一个标识符完全相同才可以接收，可以理解为白名单管理</li><li><strong>Mask Mode 掩码模式</strong>：它把可接收报文 ID 的某几位作为列表，这几位被称为掩码，可以把它理解成关键字搜索，只要掩码(关键字)相同，就符合要求，报文就会被保存到接收FIFO</li></ol><p><img src="https://i.loli.net/2020/03/30/n6UpCBElg8bjW79.png" alt="CAN Mask.png"></p><p>每种模式又有对应的16 Bit位，32 Bit位模式，具体的使用方法和区别，本文不深入讨论，这部分内容再出个完整的教程都足够了，所以这部分留给客官去看<em>Reference Manuel</em>来理解。</p><h3 id="3-3-如何通过Bit-Rate-比特率来选择Time-Quantum-时间量子"><a href="#3-3-如何通过Bit-Rate-比特率来选择Time-Quantum-时间量子" class="headerlink" title="3.3 如何通过Bit Rate 比特率来选择Time Quantum 时间量子"></a>3.3 如何通过Bit Rate 比特率来选择Time Quantum 时间量子</h3><p><img src="https://i.loli.net/2020/03/30/4r3nTE92bmPzxqK.png" alt="CAN for STM32.png"></p><p>该图生成于<a href="http://www.bittiming.can-wiki.info/">CAN Bit Time Calculation</a>，可以看出在iRM2018的时钟树配置下，42MHz的CAN总线，最推荐的是黄色的那条，是稳定和高速的交际范围，越往上越快，但是越不稳定，越往下越稳定，但是越慢。因为C620电调和M3508电机接收的比特率是1Mbps，所以我们只能选择最上面的那个最快的那组参数。</p><h3 id="3-4-特殊功能选项"><a href="#3-4-特殊功能选项" class="headerlink" title="3.4 特殊功能选项"></a>3.4 特殊功能选项</h3><ul><li><strong>Automatic Bus-Off Management 自动离线管理</strong>：可以在出错时离线后适时自动恢复，不需要软件干预</li><li><strong>Automatic Retransmission 自动重传</strong>：使用本功能时，会一直发送报文直到成功为止</li></ul><h3 id="3-5-RoboMaster-Assistant"><a href="#3-5-RoboMaster-Assistant" class="headerlink" title="3.5 RoboMaster Assistant"></a>3.5 RoboMaster Assistant</h3><p>在用串口转接器后，可以在PWM接口连接上PC的RoboMaster Assitant来调试电机，重要的是可以调整电机的CAN数据发送频率，适当调低可以降低CPU的接收压力，把计算资源留给其他更加重要的功能。</p><h3 id="3-6-终端电阻"><a href="#3-6-终端电阻" class="headerlink" title="3.6 终端电阻"></a>3.6 终端电阻</h3><p>在C620电调的侧翼，有个开关，用于是否开启终端电阻。这个电阻是一定要开的，因为CAN总线的任何终端，任何Node 节点，都需要在两根线中间接$120\ Ω$的电阻。</p><h2 id="4-0-CAN的用法"><a href="#4-0-CAN的用法" class="headerlink" title="4.0 CAN的用法"></a>4.0 CAN的用法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_CAN_ActivateNotification</span><span class="hljs-params">(CAN_HandleTypeDef *hcan, <span class="hljs-keyword">uint32_t</span> ActiveITs)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hcan</code>：指向CAN配置结构体</li><li><code>ActiveITs</code>：表明哪个中断会被启动，开启改中断的消息提示</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果开启成功，返回<code>HAL_OK</code>；如果失败，返回<code>HAL_ERROR</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_CAN_Start</span><span class="hljs-params">(CAN_HandleTypeDef *hcan)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hcan</code>：指向CAN配置结构体</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果开启成功，返回<code>HAL_OK</code>；如果失败，返回<code>HAL_ERROR</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_CAN_ConfigFilter</span><span class="hljs-params">(CAN_HandleTypeDef *hcan, CAN_FilterTypeDef *sFilterConfig)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hcan</code>：指向CAN配置结构体</li><li><code>sFilterConfig</code>：指向Filter过滤器配置结构体</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果开启成功，返回<code>HAL_OK</code>；如果失败，返回<code>HAL_ERROR</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_CAN_AddTxMessage</span><span class="hljs-params">(CAN_HandleTypeDef *hcan, CAN_TxHeaderTypeDef *pHeader, <span class="hljs-keyword">uint8_t</span> aData[], <span class="hljs-keyword">uint32_t</span> *pTxMailbox)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hcan</code>：指向CAN配置结构体</li><li><code>pHeader</code>：指向发送数据的配置结构体</li><li><code>aData[]</code>：指向需要发送的数据</li><li><code>pTxMailbox</code>：该函数会返回用于储存发送数据的发送邮箱编号到该变量</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果添加成功，返回<code>HAL_OK</code>；如果失败，返回<code>HAL_ERROR</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">HAL_CAN_IsTxMessagePending</span><span class="hljs-params">(CAN_HandleTypeDef *hcan, <span class="hljs-keyword">uint32_t</span> TxMailboxes)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hcan</code>：指向CAN配置结构体</li><li><code>TxMailboxes</code>：指向发送数据的发送邮箱</li></ul></li><li><strong>返回值</strong><ul><li><code>uint32_t</code>：如果有发送数据正在等待发送，返回<code>1</code>；如果没有，返回<code>0</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_CAN_RxFifo0MsgPendingCallback</span><span class="hljs-params">(CAN_HandleTypeDef *hcan)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>HAL_CAN_RxFifo0MsgPendingCallback</code>函数</li><li>在该函数中填写在FIFO 0中已经没有正在等待接收的数据的时候开启中断，需要执行的代码</li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_CAN_GetRxMessage</span><span class="hljs-params">(CAN_HandleTypeDef *hcan, <span class="hljs-keyword">uint32_t</span> RxFifo, CAN_RxHeaderTypeDef *pHeader, <span class="hljs-keyword">uint8_t</span> aData[])</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hcan</code>：指向CAN配置结构体</li><li><code>RxFifo</code>：指向负责接收的FIFO</li><li><code>pHeader</code>：指向接收数据的配置结构体</li><li><code>aData[]</code>：指向需要接收的数据</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果接收成功，返回<code>HAL_OK</code>；如果失败，返回<code>HAL_ERROR</code></li></ul></li></ul><h2 id="5-0-练习项目"><a href="#5-0-练习项目" class="headerlink" title="5.0 练习项目"></a>5.0 练习项目</h2><h3 id="5-1-项目简介"><a href="#5-1-项目简介" class="headerlink" title="5.1 项目简介"></a>5.1 项目简介</h3><ul><li><strong>CAN电机控制与读取</strong>：通过CAN控制电机，并且在按下按钮时通过CAN读取电机运行数据</li></ul><h3 id="5-2-项目代码"><a href="#5-2-项目代码" class="headerlink" title="5.2 项目代码"></a>5.2 项目代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;string.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;stdio.h&quot;</span></span><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br><span class="hljs-keyword">uint8_t</span>     motor_id;<br><span class="hljs-keyword">int16_t</span>     angle;<br><span class="hljs-keyword">int16_t</span>     current_get;<br><span class="hljs-keyword">int16_t</span>     speed_rpm;<br><span class="hljs-keyword">uint8_t</span>     temperature;<br>&#125;   <span class="hljs-keyword">motor_3508_t</span>;<br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CAN1_DEVICE_NUM     4</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FIRST_GROUP_ID      0x200</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOTOR_SPEED_MAX     16384</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CAN_DATA_SIZE       8</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CAN1_RX_ID_START    0x201</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOTOR_ID            2</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>CAN_HandleTypeDef hcan1;<br><br>UART_HandleTypeDef huart7;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><span class="hljs-keyword">int16_t</span> speedFlag=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">uint8_t</span> can1_rx_buffer[CAN1_DEVICE_NUM][CAN_DATA_SIZE];<br><span class="hljs-keyword">motor_3508_t</span> motorPrintTest=&#123;.motor_id=MOTOR_ID&#125;;<br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_CAN1_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">can_filter_enable</span><span class="hljs-params">(CAN_HandleTypeDef* hcan)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">can_filter_disable</span><span class="hljs-params">(CAN_HandleTypeDef* hcan)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">can_transmit</span><span class="hljs-params">(CAN_HandleTypeDef* hcan, <span class="hljs-keyword">uint16_t</span> id, <span class="hljs-keyword">int16_t</span> msg1, <span class="hljs-keyword">int16_t</span> msg2, <span class="hljs-keyword">int16_t</span> msg3, <span class="hljs-keyword">int16_t</span> msg4)</span></span>;<br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_CAN1_Init();<br>  MX_UART7_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  can_filter_disable(&amp;hcan1);<br>  HAL_CAN_ActivateNotification(&amp;hcan1, CAN_IT_RX_FIFO0_MSG_PENDING);<br>  HAL_CAN_Start(&amp;hcan1);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>  <span class="hljs-keyword">while</span>(speedFlag &lt;= MOTOR_SPEED_MAX/<span class="hljs-number">12</span>)&#123;<br>  can_transmit(&amp;hcan1,FIRST_GROUP_ID,speedFlag,speedFlag,speedFlag,speedFlag);<br>    speedFlag++;<br>  HAL_Delay(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">while</span>(speedFlag &gt;= -MOTOR_SPEED_MAX/<span class="hljs-number">12</span>)&#123;<br>  can_transmit(&amp;hcan1,FIRST_GROUP_ID,speedFlag,speedFlag,speedFlag,speedFlag);<br>    speedFlag--;<br>    HAL_Delay(<span class="hljs-number">1</span>);<br>  &#125;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;<br>  RCC_OscInitStruct.HSEState = RCC_HSE_ON;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;<br>  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;<br>  RCC_OscInitStruct.PLL.PLLM = <span class="hljs-number">6</span>;<br>  RCC_OscInitStruct.PLL.PLLN = <span class="hljs-number">168</span>;<br>  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;<br>  RCC_OscInitStruct.PLL.PLLQ = <span class="hljs-number">4</span>;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief CAN1 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_CAN1_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN CAN1_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END CAN1_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE BEGIN CAN1_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END CAN1_Init 1 */</span><br>  hcan1.Instance = CAN1;<br>  hcan1.Init.Prescaler = <span class="hljs-number">3</span>;<br>  hcan1.Init.Mode = CAN_MODE_NORMAL;<br>  hcan1.Init.SyncJumpWidth = CAN_SJW_1TQ;<br>  hcan1.Init.TimeSeg1 = CAN_BS1_11TQ;<br>  hcan1.Init.TimeSeg2 = CAN_BS2_2TQ;<br>  hcan1.Init.TimeTriggeredMode = DISABLE;<br>  hcan1.Init.AutoBusOff = ENABLE;<br>  hcan1.Init.AutoWakeUp = DISABLE;<br>  hcan1.Init.AutoRetransmission = ENABLE;<br>  hcan1.Init.ReceiveFifoLocked = DISABLE;<br>  hcan1.Init.TransmitFifoPriority = DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_CAN_Init(&amp;hcan1) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN CAN1_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END CAN1_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief UART7 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 1 */</span><br>  huart7.Instance = UART7;<br>  huart7.Init.BaudRate = <span class="hljs-number">115200</span>;<br>  huart7.Init.WordLength = UART_WORDLENGTH_8B;<br>  huart7.Init.StopBits = UART_STOPBITS_1;<br>  huart7.Init.Parity = UART_PARITY_NONE;<br>  huart7.Init.Mode = UART_MODE_TX_RX;<br>  huart7.Init.HwFlowCtl = UART_HWCONTROL_NONE;<br>  huart7.Init.OverSampling = UART_OVERSAMPLING_16;<br>  <span class="hljs-keyword">if</span> (HAL_UART_Init(&amp;huart7) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOD_CLK_ENABLE();<br>  __HAL_RCC_GPIOH_CLK_ENABLE();<br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/* EXTI interrupt init*/</span><br>  HAL_NVIC_SetPriority(EXTI2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(EXTI2_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">can_filter_enable</span><span class="hljs-params">(CAN_HandleTypeDef* hcan)</span></span>&#123;<br>CAN_FilterTypeDef CAN_FilterConfigStructure;<br><br>CAN_FilterConfigStructure.FilterIdHigh = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterIdLow = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterMaskIdHigh = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterMaskIdLow = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterFIFOAssignment = CAN_FILTER_FIFO0;<br>CAN_FilterConfigStructure.FilterMode = CAN_FILTERMODE_IDMASK;<br>CAN_FilterConfigStructure.FilterScale = CAN_FILTERSCALE_32BIT;<br>CAN_FilterConfigStructure.FilterActivation = ENABLE;<br>CAN_FilterConfigStructure.SlaveStartFilterBank = <span class="hljs-number">27</span>;<br><br>CAN_FilterConfigStructure.FilterBank = <span class="hljs-number">0</span>;<br><br>HAL_CAN_ConfigFilter(hcan, &amp;CAN_FilterConfigStructure);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">can_filter_disable</span><span class="hljs-params">(CAN_HandleTypeDef* hcan)</span></span>&#123;<br>CAN_FilterTypeDef CAN_FilterConfigStructure;<br><br>CAN_FilterConfigStructure.FilterIdHigh = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterIdLow = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterMaskIdHigh = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterMaskIdLow = <span class="hljs-number">0x0000</span>;<br>CAN_FilterConfigStructure.FilterFIFOAssignment = CAN_FILTER_FIFO0;<br>CAN_FilterConfigStructure.FilterMode = CAN_FILTERMODE_IDMASK;<br>CAN_FilterConfigStructure.FilterScale = CAN_FILTERSCALE_32BIT;<br>CAN_FilterConfigStructure.FilterActivation = DISABLE;<br>CAN_FilterConfigStructure.SlaveStartFilterBank = <span class="hljs-number">27</span>;<br><br>CAN_FilterConfigStructure.FilterBank = <span class="hljs-number">0</span>;<br><br>HAL_CAN_ConfigFilter(hcan, &amp;CAN_FilterConfigStructure);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">can_transmit</span><span class="hljs-params">(CAN_HandleTypeDef* hcan, <span class="hljs-keyword">uint16_t</span> id, <span class="hljs-keyword">int16_t</span> msg1, <span class="hljs-keyword">int16_t</span> msg2, <span class="hljs-keyword">int16_t</span> msg3, <span class="hljs-keyword">int16_t</span> msg4)</span></span>&#123;<br>CAN_TxHeaderTypeDef tx_header;<br><span class="hljs-keyword">uint8_t</span>             data[<span class="hljs-number">8</span>];<br><span class="hljs-keyword">uint32_t</span>            pTxMailbox;<br><br>tx_header.StdId = id;<br>tx_header.IDE   = CAN_ID_STD;<br>tx_header.RTR   = CAN_RTR_DATA;<br>tx_header.DLC   = CAN_DATA_SIZE;<br>tx_header.TransmitGlobalTime = DISABLE;<br>data[<span class="hljs-number">0</span>] = msg1 &gt;&gt; <span class="hljs-number">8</span>;<br>data[<span class="hljs-number">1</span>] = msg1;<br>data[<span class="hljs-number">2</span>] = msg2 &gt;&gt; <span class="hljs-number">8</span>;<br>data[<span class="hljs-number">3</span>] = msg2;<br>data[<span class="hljs-number">4</span>] = msg3 &gt;&gt; <span class="hljs-number">8</span>;<br>data[<span class="hljs-number">5</span>] = msg3;<br>data[<span class="hljs-number">6</span>] = msg4 &gt;&gt; <span class="hljs-number">8</span>;<br>data[<span class="hljs-number">7</span>] = msg4;<br><br><span class="hljs-keyword">if</span> (HAL_CAN_AddTxMessage(hcan, &amp;tx_header, data, &amp;pTxMailbox) == HAL_OK)&#123;<br><span class="hljs-keyword">while</span> (HAL_CAN_IsTxMessagePending(hcan, pTxMailbox));<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_CAN_RxFifo0MsgPendingCallback</span><span class="hljs-params">(CAN_HandleTypeDef *hcan)</span></span>&#123;<br>CAN_RxHeaderTypeDef rx_header;<br>rx_header.StdId = (CAN_RI0R_STID &amp; hcan-&gt;Instance-&gt;sFIFOMailBox[CAN_RX_FIFO0].RIR) &gt;&gt; CAN_TI0R_STID_Pos;<br><span class="hljs-keyword">uint8_t</span> idx = rx_header.StdId - CAN1_RX_ID_START;<br>HAL_CAN_GetRxMessage(hcan, CAN_RX_FIFO0, &amp;rx_header, can1_rx_buffer[idx]);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">can1_read</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> id, <span class="hljs-keyword">uint8_t</span> buf[CAN_DATA_SIZE])</span></span>&#123;<br><span class="hljs-built_in">memcpy</span>(buf, can1_rx_buffer[--id], CAN_DATA_SIZE);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_motor_data</span><span class="hljs-params">(<span class="hljs-keyword">motor_3508_t</span> *motor, <span class="hljs-keyword">uint8_t</span> buf[CAN_DATA_SIZE])</span></span>&#123;<br>motor-&gt;angle        = (<span class="hljs-keyword">int16_t</span>)(buf[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">8</span> | buf[<span class="hljs-number">1</span>]);<br>motor-&gt;speed_rpm    = (<span class="hljs-keyword">int16_t</span>)(buf[<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">8</span> | buf[<span class="hljs-number">3</span>]);<br>motor-&gt;current_get  = (<span class="hljs-keyword">int16_t</span>)(buf[<span class="hljs-number">4</span>] &lt;&lt; <span class="hljs-number">8</span> | buf[<span class="hljs-number">5</span>]);<br>motor-&gt;temperature  = (<span class="hljs-keyword">uint8_t</span>)buf[<span class="hljs-number">6</span>];<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_motor_data</span><span class="hljs-params">(<span class="hljs-keyword">motor_3508_t</span> *motor, <span class="hljs-keyword">char</span> *msg)</span></span>&#123;<br><span class="hljs-built_in">sprintf</span>(msg, <span class="hljs-string">&quot;======== 3508 at CAN bus ========\r\n&quot;</span>\<br>             <span class="hljs-string">&quot;ID           %d\r\n&quot;</span>\<br>             <span class="hljs-string">&quot;Angle        %d\r\n&quot;</span>\<br>             <span class="hljs-string">&quot;Current      %d\r\n&quot;</span>\<br>             <span class="hljs-string">&quot;Speed        %d\r\n&quot;</span>\<br>             <span class="hljs-string">&quot;Temperature  %u\r\n&quot;</span>\<br>             <span class="hljs-string">&quot;=================================\r\n\r\n&quot;</span>\<br>             , motor-&gt;motor_id, motor-&gt;angle, motor-&gt;current_get, motor-&gt;speed_rpm, motor-&gt;temperature);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span>&#123;<br><span class="hljs-keyword">if</span>(GPIO_Pin == Button_Pin)&#123;<br>can_filter_enable(&amp;hcan1);<br><span class="hljs-keyword">uint8_t</span> motorStatus[CAN_DATA_SIZE];<br><span class="hljs-keyword">char</span> motorMsg[<span class="hljs-number">250</span>];<br>can1_read(MOTOR_ID,motorStatus);<br>get_motor_data(&amp;motorPrintTest, motorStatus);<br>print_motor_data(&amp;motorPrintTest, motorMsg);<br>HAL_UART_Transmit(&amp;huart7, (<span class="hljs-keyword">uint8_t</span>*)motorMsg, <span class="hljs-built_in">strlen</span>(motorMsg), HAL_MAX_DELAY);<br>can_filter_disable(&amp;hcan1);<br>&#125;<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h3 id="5-3-效果展示"><a href="#5-3-效果展示" class="headerlink" title="5.3 效果展示"></a>5.3 效果展示</h3><iframe height=500 width=100% src="//player.bilibili.com/player.html?aid=242558868&bvid=BV1he411x7DN&cid=170233216&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进阶篇 VI [Timer &amp; PWM]</title>
    <link href="/posts/fd31d369/"/>
    <url>/posts/fd31d369/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="1-0-什么是Timer？PWM又是什么玩意儿？"><a href="#1-0-什么是Timer？PWM又是什么玩意儿？" class="headerlink" title="1.0 什么是Timer？PWM又是什么玩意儿？"></a>1.0 什么是Timer？PWM又是什么玩意儿？</h2><h3 id="1-1-Timer定义"><a href="#1-1-Timer定义" class="headerlink" title="1.1 Timer定义"></a>1.1 Timer定义</h3><blockquote><p>Timer就是<strong>定时器</strong>，但是与一般我们生活中使用的定时器不同的是，Timer的单位不是s秒，而是<strong>Hz赫兹</strong>，而且通常是MHz（1,000,000Hz），定时器通常从0开始数数，然后直到占满其16位寄存器，就会告诉CPU，“我已经满得不行了～～”，然后从0开始重新计数。</p><p>Timer具体的频率多少通常取决于，其Clock Source，Prescaler，和Period</p><p>$$Frequency\ =\ \frac{Clock\ Source}{(Prescaler+1)(Period+1)}$$</p><blockquote><p>这里值得注意的是，虽然Prescaler和Period都可以降频，但是根据笔者实测，两者是不一样的，Prescaler会改变PWM信号的密度，所以不推荐过大的Prescaler，而Period会改变PWM信号的Resolution清晰度/分辨率，过小会导致能选择的Duty Cycle占空比过少，所以不推荐过小的Period。但是具体怎么平衡选择，其实还是需要看你的需求和设备。</p></blockquote><p>如果是高级定时器，还需要考虑Repetition Counter ( RC )</p><p>$$Frequency\ =\ \frac{Clock\ Source}{(Prescaler+1)(Period+1)(RC+1)}$$</p><p>定时器分为</p><ol><li><p>Basic Timer</p><ul><li>TIM6</li><li>TIM7</li></ul></li><li><p>General Purpose Timer</p><ul><li>TIM2到TIM5</li><li>TIM9到TIM14</li></ul></li><li><p>Advanced Timer</p><ul><li><p>TIM1</p></li><li><p>TIM8</p></li></ul></li><li><p>SysTick Timer</p></li></ol><p>因为RoboMaster暂时只用得上Basic Timer和General Purpose Timer，其他Timer都暂时不讲。在RM中，Basic Timer用于计时，General Purpose Timer用于生成PWM，虽然也可以当成普通的Basic Timer来用。</p><p>所有Timer的时钟源分布图</p><p><img src="https://i.loli.net/2020/03/23/CkxDet1yH7Oi3o4.jpg" alt="Clock Source for Timer.jpg"></p><p>在无法确认某个Timer的时钟源在Clock Tree中的位置时，请参考上图！</p></blockquote><h3 id="1-2-PWM定义"><a href="#1-2-PWM定义" class="headerlink" title="1.2 PWM定义"></a>1.2 PWM定义</h3><blockquote><p>PWM ( <strong>Pulse Width Modulation</strong> ) <strong>脉冲宽度调制</strong>技术，通过对一系列脉冲的宽度进行调制，来等效地获得所需要波形（含形状和幅值）。PWM控制技术在逆变电路中应用最广，应用的逆变电路绝大部分是PWM型，PWM控制技术正是有赖于在逆变电路中的应用，才确定了它在电力电子技术中的重要地位。PWM能使电源的输出电压在工作条件变化时保持恒定，是利用微处理器的数字信号对模拟电路进行控制的一种非常有效的技术，广泛应用在从测量通信到功率控制与变换的许多领域中。</p><p>最基础最本质的概念：<strong>Duty Cycle 占空比</strong></p><p>$$D\ =\ \frac{T_{on}}{Period}\times100%$$</p><p>$$Period\ =\ T_{on}+T_{off}$$</p><p><img src="https://i.loli.net/2020/03/23/MuvIJ2Fl4oGqxNS.png" alt="Duty Cycle.png"></p><p>PWM这项技术的本质其实非常简单，“在不改变最大电压的情况下，通过改变最大电压出现的比率，来改变整体的平均电压”，而这可以顺带传递信息。</p><p>PWM通常用于控制电机，舵机，加密信息传递，电压变化控制等等</p></blockquote><h3 id="1-3-PWM的实际应用"><a href="#1-3-PWM的实际应用" class="headerlink" title="1.3 PWM的实际应用"></a>1.3 PWM的实际应用</h3><h4 id="1-3-1-呼吸灯"><a href="#1-3-1-呼吸灯" class="headerlink" title="1.3.1 呼吸灯"></a>1.3.1 呼吸灯</h4><ul><li>这个很好理解，毕竟越大的Duty Cycle占空比，短时间内的平均电压越大，灯也就越亮，所以控制PWM信号的Duty Cycle占空比就可以在不改变电压的情况下调控瞬时平均电压。</li></ul><h4 id="1-3-2-舵机控制"><a href="#1-3-2-舵机控制" class="headerlink" title="1.3.2 舵机控制"></a>1.3.2 舵机控制</h4><ul><li>舵机通常可以用CAN或者PWM来控制，PWM是非常常见的舵机控制方式，基本上没有不支持PWM的舵机。PWM的Duty Cycle占空比的大小对应者着舵机的角度。通常频率为50Hz，如果Period为2000，$T_{on}$为50~250，Duty Cycle占空比为2.5%~12.5%，则对应着舵机的0°~180°/0°~270°。</li></ul><h4 id="1-3-3-电机控制"><a href="#1-3-3-电机控制" class="headerlink" title="1.3.3 电机控制"></a>1.3.3 电机控制</h4><blockquote><p>这里以RoboMaster中常见的M3508直流无刷减速电机和C620无刷电机调速器为例</p></blockquote><p><img src="https://i.loli.net/2020/03/23/kfVOznxQBRsJu7X.jpg" alt="M3508.jpg"></p><ul><li>PWM信号给到C620，然后C620根据其Duty Cycle占空比来控制M3508速度</li><li>M3508用PWM驱动，需要每次都先校验PWM，需要先给最大Duty Cycle占空比，然后在3s内给最小Duty Cycle占空比</li><li>M3508是缓启动，也就是说，速度需要从0开始递增，而不能直接让M3508满速</li><li>M3508能接收的频率为50Hz到500Hz，脉宽从1000us到2000us变化，推荐500Hz，Period为2000</li><li>M3508分为两种模式<ul><li>单向转动模式<ul><li>$V_{min}\ =\ 1000us$</li><li>$V_{max}\ =\ 2000us$</li></ul></li><li>双向转动模式<ul><li>$-V_{max}\ =\ 1000us$</li><li>$V_{0}\ =\ 1500us$</li><li>$V_{max}\ =\ 2000us$</li></ul></li></ul></li></ul><h2 id="2-0-Timer的用法"><a href="#2-0-Timer的用法" class="headerlink" title="2.0 Timer的用法"></a>2.0 Timer的用法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_TIM_Base_Start_IT</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>htim</code>：指向TIM配置结构体</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果开启成功，返回<code>HAL_OK</code></li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_TIM_Base_Stop_IT</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>htim</code>：指向TIM配置结构体</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果停止成功，返回<code>HAL_OK</code></li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_TIM_PeriodElapsedCallback</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span></span>&#123;<br>    ......<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>HAL_TIM_PeriodElapsedCallback</code>函数</li><li>在该函数中填写TIM达到预定时间后开启中断，需要执行的代码</li></ul><h2 id="3-0-PWM的用法"><a href="#3-0-PWM的用法" class="headerlink" title="3.0 PWM的用法"></a>3.0 PWM的用法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_TIM_PWM_Start</span><span class="hljs-params">(TIM_HandleTypeDef *htim, <span class="hljs-keyword">uint32_t</span> Channel)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>htim</code>：指向TIM配置结构体</li><li><code>Channel</code>：打开的Channel序号</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果开启成功，返回<code>HAL_OK</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_TIM_PWM_Stop</span><span class="hljs-params">(TIM_HandleTypeDef *htim, <span class="hljs-keyword">uint32_t</span> Channel)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>htim</code>：指向TIM配置结构体</li><li><code>Channel</code>：打开的Channel序号</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果停止成功，返回<code>HAL_OK</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">__HAL_TIM_SET_AUTORELOAD(__HANDLE__);<br></code></pre></td></tr></table></figure><blockquote><p>用于实时设置TIM计时器的复位值，计算公式：</p><p>$$\frac{Clock\ Freq}{Output\ Freq}\ -\ 1$$</p></blockquote><ul><li><strong>参数</strong><ul><li><code>__HANDLE__</code>：指向TIM配置结构体</li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">__HAL_TIM_SET_COMPARE(__HANDLE__, __CHANNEL__, __COMPARE__);<br></code></pre></td></tr></table></figure><blockquote><p>用于实时设置PWM的Duty Circle宽度值，计算公式：</p><p>$$\frac{Clock\ Freq}{Output\ Freq}\ \times\ Duty\ Circle\ -\ 1$$</p></blockquote><ul><li><strong>参数</strong><ul><li><code>__HANDLE__</code>：指向TIM配置结构体</li><li><code>__CHANNEL__</code>：Channel序号</li><li><code>__COMPARE__</code>：新的$T_{on}$值，以此改变Duty Cycle占空比</li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">__HAL_TIM_SET_COUNTER(__HANDLE__, __COUNTER__);<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>__HANDLE__</code>：指向TIM配置结构体</li><li><code>__COMPARE__</code>：新的Timer计数器值，如果为0，也就是常见的初始化用法</li></ul></li></ul><h2 id="4-0-练习项目"><a href="#4-0-练习项目" class="headerlink" title="4.0 练习项目"></a>4.0 练习项目</h2><h3 id="4-1-项目简介"><a href="#4-1-项目简介" class="headerlink" title="4.1 项目简介"></a>4.1 项目简介</h3><ul><li><strong>彩灯</strong>：按下按键，就开始每0.5s ( 2Hz ) 改变一次所有LED灯状态（交叉点亮）。</li><li><strong>呼吸灯</strong>：灯光在PWM控制电压下完成由亮到暗的逐渐变化，感觉好像是人在呼吸。</li><li><strong>舵机控制</strong>：通过PWM控制舵机的位置</li><li><strong>电机控制（单向转动模式）</strong>：通过PWM控制电机的速度</li><li><strong>电机控制（双向转动模式）</strong>：通过PWM控制电机的速度</li></ul><h3 id="4-2-项目代码"><a href="#4-2-项目代码" class="headerlink" title="4.2 项目代码"></a>4.2 项目代码</h3><blockquote><p>完整的工程文件可以在<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">这里</a>找到！</p></blockquote><h4 id="4-2-1-彩灯"><a href="#4-2-1-彩灯" class="headerlink" title="4.2.1 彩灯"></a>4.2.1 彩灯</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;stdbool.h&quot;</span></span><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>TIM_HandleTypeDef htim6;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM6_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><span class="hljs-keyword">bool</span> flag=<span class="hljs-literal">false</span>;<br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_TIM6_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port,LD_RED_Pin,RESET);<br>  HAL_GPIO_WritePin(LD_GREEN_GPIO_Port,LD_GREEN_Pin,SET);<br>  HAL_GPIO_WritePin(LD1_GPIO_Port,LD1_Pin,RESET);<br>  HAL_GPIO_WritePin(LD2_GPIO_Port,LD2_Pin,SET);<br>  HAL_GPIO_WritePin(LD3_GPIO_Port,LD3_Pin,RESET);<br>  HAL_GPIO_WritePin(LD4_GPIO_Port,LD4_Pin,SET);<br>  HAL_GPIO_WritePin(LD5_GPIO_Port,LD5_Pin,RESET);<br>  HAL_GPIO_WritePin(LD6_GPIO_Port,LD6_Pin,SET);<br>  HAL_GPIO_WritePin(LD7_GPIO_Port,LD7_Pin,RESET);<br>  HAL_GPIO_WritePin(LD8_GPIO_Port,LD8_Pin,SET);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;<br>  RCC_OscInitStruct.HSEState = RCC_HSE_ON;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;<br>  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;<br>  RCC_OscInitStruct.PLL.PLLM = <span class="hljs-number">6</span>;<br>  RCC_OscInitStruct.PLL.PLLN = <span class="hljs-number">168</span>;<br>  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;<br>  RCC_OscInitStruct.PLL.PLLQ = <span class="hljs-number">4</span>;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief TIM6 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM6_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM6_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM6_Init 0 */</span><br><br>  TIM_MasterConfigTypeDef sMasterConfig = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM6_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM6_Init 1 */</span><br>  htim6.Instance = TIM6;<br>  htim6.Init.Prescaler = <span class="hljs-number">41999</span>;<br>  htim6.Init.CounterMode = TIM_COUNTERMODE_UP;<br>  htim6.Init.Period = <span class="hljs-number">999</span>;<br>  htim6.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_Base_Init(&amp;htim6) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;<br>  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIMEx_MasterConfigSynchronization(&amp;htim6, &amp;sMasterConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN TIM6_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM6_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOH_CLK_ENABLE();<br>  __HAL_RCC_GPIOG_CLK_ENABLE();<br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br>  __HAL_RCC_GPIOF_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(GPIOG, LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_GREEN_GPIO_Port, LD_GREEN_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pins : LD8_Pin LD7_Pin LD6_Pin LD5_Pin </span><br><span class="hljs-comment">                           LD4_Pin LD3_Pin LD2_Pin LD1_Pin */</span><br>  GPIO_InitStruct.Pin = LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(GPIOG, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_GREEN_Pin */</span><br>  GPIO_InitStruct.Pin = LD_GREEN_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_GREEN_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/* EXTI interrupt init*/</span><br>  HAL_NVIC_SetPriority(EXTI2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(EXTI2_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span> </span>&#123;<br><span class="hljs-keyword">if</span>(GPIO_Pin == Button_Pin)&#123;<br>flag=!flag;<br><span class="hljs-keyword">if</span>(flag)&#123;<br>HAL_TIM_Base_Start_IT(&amp;htim6);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>HAL_TIM_Base_Stop_IT(&amp;htim6);<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_TIM_PeriodElapsedCallback</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span> </span>&#123;<br><span class="hljs-keyword">if</span>(htim-&gt;Instance == TIM6)&#123;<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>HAL_GPIO_TogglePin(LD_GREEN_GPIO_Port,LD_GREEN_Pin);<br>HAL_GPIO_TogglePin(LD1_GPIO_Port,LD1_Pin);<br>HAL_GPIO_TogglePin(LD2_GPIO_Port,LD2_Pin);<br>HAL_GPIO_TogglePin(LD3_GPIO_Port,LD3_Pin);<br>HAL_GPIO_TogglePin(LD4_GPIO_Port,LD4_Pin);<br>HAL_GPIO_TogglePin(LD5_GPIO_Port,LD5_Pin);<br>HAL_GPIO_TogglePin(LD6_GPIO_Port,LD6_Pin);<br>HAL_GPIO_TogglePin(LD7_GPIO_Port,LD7_Pin);<br>HAL_GPIO_TogglePin(LD8_GPIO_Port,LD8_Pin);<br>&#125;<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h4 id="4-2-2-呼吸灯"><a href="#4-2-2-呼吸灯" class="headerlink" title="4.2.2 呼吸灯"></a>4.2.2 呼吸灯</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>TIM_HandleTypeDef htim1;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM1_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_TIM1_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_TIM_PWM_Start(&amp;htim1,TIM_CHANNEL_2);<br>  <span class="hljs-keyword">uint16_t</span> dutyCycle=<span class="hljs-number">0</span>;<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>  <span class="hljs-keyword">while</span>(dutyCycle &lt; __HAL_TIM_GET_AUTORELOAD(&amp;htim1))&#123;<br>  __HAL_TIM_SET_COMPARE(&amp;htim1,TIM_CHANNEL_2,dutyCycle++);<br>  HAL_Delay(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">while</span>(dutyCycle &gt; <span class="hljs-number">0</span>)&#123;<br>  __HAL_TIM_SET_COMPARE(&amp;htim1,TIM_CHANNEL_2,dutyCycle--);<br>  HAL_Delay(<span class="hljs-number">1</span>);<br>  &#125;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;<br>  RCC_OscInitStruct.HSEState = RCC_HSE_ON;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;<br>  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;<br>  RCC_OscInitStruct.PLL.PLLM = <span class="hljs-number">6</span>;<br>  RCC_OscInitStruct.PLL.PLLN = <span class="hljs-number">168</span>;<br>  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;<br>  RCC_OscInitStruct.PLL.PLLQ = <span class="hljs-number">4</span>;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief TIM1 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM1_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM1_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM1_Init 0 */</span><br><br>  TIM_ClockConfigTypeDef sClockSourceConfig = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_MasterConfigTypeDef sMasterConfig = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_OC_InitTypeDef sConfigOC = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_BreakDeadTimeConfigTypeDef sBreakDeadTimeConfig = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM1_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM1_Init 1 */</span><br>  htim1.Instance = TIM1;<br>  htim1.Init.Prescaler = <span class="hljs-number">0</span>;<br>  htim1.Init.CounterMode = TIM_COUNTERMODE_UP;<br>  htim1.Init.Period = <span class="hljs-number">499</span>;<br>  htim1.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;<br>  htim1.Init.RepetitionCounter = <span class="hljs-number">0</span>;<br>  htim1.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_Base_Init(&amp;htim1) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_ConfigClockSource(&amp;htim1, &amp;sClockSourceConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_Init(&amp;htim1) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;<br>  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIMEx_MasterConfigSynchronization(&amp;htim1, &amp;sMasterConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sConfigOC.OCMode = TIM_OCMODE_PWM2;<br>  sConfigOC.Pulse = <span class="hljs-number">0</span>;<br>  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;<br>  sConfigOC.OCNPolarity = TIM_OCNPOLARITY_HIGH;<br>  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;<br>  sConfigOC.OCIdleState = TIM_OCIDLESTATE_RESET;<br>  sConfigOC.OCNIdleState = TIM_OCNIDLESTATE_RESET;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_ConfigChannel(&amp;htim1, &amp;sConfigOC, TIM_CHANNEL_2) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sBreakDeadTimeConfig.OffStateRunMode = TIM_OSSR_DISABLE;<br>  sBreakDeadTimeConfig.OffStateIDLEMode = TIM_OSSI_DISABLE;<br>  sBreakDeadTimeConfig.LockLevel = TIM_LOCKLEVEL_OFF;<br>  sBreakDeadTimeConfig.DeadTime = <span class="hljs-number">0</span>;<br>  sBreakDeadTimeConfig.BreakState = TIM_BREAK_DISABLE;<br>  sBreakDeadTimeConfig.BreakPolarity = TIM_BREAKPOLARITY_HIGH;<br>  sBreakDeadTimeConfig.AutomaticOutput = TIM_AUTOMATICOUTPUT_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIMEx_ConfigBreakDeadTime(&amp;htim1, &amp;sBreakDeadTimeConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN TIM1_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM1_Init 2 */</span><br>  HAL_TIM_MspPostInit(&amp;htim1);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOH_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h4 id="4-2-3-舵机控制"><a href="#4-2-3-舵机控制" class="headerlink" title="4.2.3 舵机控制"></a>4.2.3 舵机控制</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>TIM_HandleTypeDef htim2;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM2_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_TIM2_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_TIM_PWM_Start(&amp;htim2,TIM_CHANNEL_1);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,<span class="hljs-number">50</span>);<br>  HAL_Delay(<span class="hljs-number">1000</span>);<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,<span class="hljs-number">100</span>);<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,<span class="hljs-number">150</span>);<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,<span class="hljs-number">200</span>);<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,<span class="hljs-number">250</span>);<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;<br>  RCC_OscInitStruct.HSEState = RCC_HSE_ON;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;<br>  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;<br>  RCC_OscInitStruct.PLL.PLLM = <span class="hljs-number">6</span>;<br>  RCC_OscInitStruct.PLL.PLLN = <span class="hljs-number">168</span>;<br>  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;<br>  RCC_OscInitStruct.PLL.PLLQ = <span class="hljs-number">4</span>;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief TIM2 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM2_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 0 */</span><br><br>  TIM_ClockConfigTypeDef sClockSourceConfig = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_MasterConfigTypeDef sMasterConfig = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_OC_InitTypeDef sConfigOC = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 1 */</span><br>  htim2.Instance = TIM2;<br>  htim2.Init.Prescaler = <span class="hljs-number">839</span>;<br>  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;<br>  htim2.Init.Period = <span class="hljs-number">1999</span>;<br>  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;<br>  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_Base_Init(&amp;htim2) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_ConfigClockSource(&amp;htim2, &amp;sClockSourceConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_Init(&amp;htim2) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;<br>  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIMEx_MasterConfigSynchronization(&amp;htim2, &amp;sMasterConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sConfigOC.OCMode = TIM_OCMODE_PWM1;<br>  sConfigOC.Pulse = <span class="hljs-number">150</span>;<br>  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;<br>  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_ConfigChannel(&amp;htim2, &amp;sConfigOC, TIM_CHANNEL_1) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 2 */</span><br>  HAL_TIM_MspPostInit(&amp;htim2);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOH_CLK_ENABLE();<br>  __HAL_RCC_GPIOA_CLK_ENABLE();<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h4 id="4-2-4-电机控制（单向转动模式）"><a href="#4-2-4-电机控制（单向转动模式）" class="headerlink" title="4.2.4 电机控制（单向转动模式）"></a>4.2.4 电机控制（单向转动模式）</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>TIM_HandleTypeDef htim2;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM2_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_TIM2_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_TIM_PWM_Start(&amp;htim2,TIM_CHANNEL_1);<br>  <span class="hljs-keyword">__uint16_t</span> flag=<span class="hljs-number">0</span>;<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>  <span class="hljs-keyword">while</span>(flag &lt; <span class="hljs-number">2000</span>)&#123;<br>    __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,flag++);<br>    HAL_Delay(<span class="hljs-number">3</span>);<br>  &#125;<br>  <span class="hljs-keyword">while</span>(flag &gt; <span class="hljs-number">1000</span>)&#123;<br>    __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,flag--);<br>    HAL_Delay(<span class="hljs-number">3</span>);<br>  &#125;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;<br>  RCC_OscInitStruct.HSEState = RCC_HSE_ON;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;<br>  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;<br>  RCC_OscInitStruct.PLL.PLLM = <span class="hljs-number">6</span>;<br>  RCC_OscInitStruct.PLL.PLLN = <span class="hljs-number">168</span>;<br>  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;<br>  RCC_OscInitStruct.PLL.PLLQ = <span class="hljs-number">4</span>;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief TIM2 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM2_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 0 */</span><br><br>  TIM_ClockConfigTypeDef sClockSourceConfig = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_MasterConfigTypeDef sMasterConfig = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_OC_InitTypeDef sConfigOC = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 1 */</span><br>  htim2.Instance = TIM2;<br>  htim2.Init.Prescaler = <span class="hljs-number">83</span>;<br>  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;<br>  htim2.Init.Period = <span class="hljs-number">1999</span>;<br>  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;<br>  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_Base_Init(&amp;htim2) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_ConfigClockSource(&amp;htim2, &amp;sClockSourceConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_Init(&amp;htim2) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;<br>  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIMEx_MasterConfigSynchronization(&amp;htim2, &amp;sMasterConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sConfigOC.OCMode = TIM_OCMODE_PWM1;<br>  sConfigOC.Pulse = <span class="hljs-number">2000</span>;<br>  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;<br>  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_ConfigChannel(&amp;htim2, &amp;sConfigOC, TIM_CHANNEL_1) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 2 */</span><br>  HAL_TIM_MspPostInit(&amp;htim2);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOH_CLK_ENABLE();<br>  __HAL_RCC_GPIOA_CLK_ENABLE();<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h4 id="4-2-4-电机控制（双向转动模式）"><a href="#4-2-4-电机控制（双向转动模式）" class="headerlink" title="4.2.4 电机控制（双向转动模式）"></a>4.2.4 电机控制（双向转动模式）</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>TIM_HandleTypeDef htim2;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM2_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_TIM2_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_TIM_PWM_Start(&amp;htim2,TIM_CHANNEL_1);<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,<span class="hljs-number">0</span>);<br>  HAL_Delay(<span class="hljs-number">2000</span>);<br>  <span class="hljs-keyword">uint16_t</span> flag=<span class="hljs-number">1500</span>;<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>  <span class="hljs-keyword">while</span>(flag &lt; <span class="hljs-number">2000</span>)&#123;<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,flag++);<br>  HAL_Delay(<span class="hljs-number">3</span>);<br>  &#125;<br>  <span class="hljs-keyword">while</span>(flag &gt; <span class="hljs-number">1000</span>)&#123;<br>  __HAL_TIM_SET_COMPARE(&amp;htim2,TIM_CHANNEL_1,flag--);<br>  HAL_Delay(<span class="hljs-number">3</span>);<br>  &#125;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;<br>  RCC_OscInitStruct.HSEState = RCC_HSE_ON;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;<br>  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;<br>  RCC_OscInitStruct.PLL.PLLM = <span class="hljs-number">6</span>;<br>  RCC_OscInitStruct.PLL.PLLN = <span class="hljs-number">168</span>;<br>  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;<br>  RCC_OscInitStruct.PLL.PLLQ = <span class="hljs-number">4</span>;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief TIM2 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_TIM2_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 0 */</span><br><br>  TIM_MasterConfigTypeDef sMasterConfig = &#123;<span class="hljs-number">0</span>&#125;;<br>  TIM_OC_InitTypeDef sConfigOC = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 1 */</span><br>  htim2.Instance = TIM2;<br>  htim2.Init.Prescaler = <span class="hljs-number">83</span>;<br>  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;<br>  htim2.Init.Period = <span class="hljs-number">1999</span>;<br>  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;<br>  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_Init(&amp;htim2) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;<br>  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIMEx_MasterConfigSynchronization(&amp;htim2, &amp;sMasterConfig) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  sConfigOC.OCMode = TIM_OCMODE_PWM1;<br>  sConfigOC.Pulse = <span class="hljs-number">2000</span>;<br>  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;<br>  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;<br>  <span class="hljs-keyword">if</span> (HAL_TIM_PWM_ConfigChannel(&amp;htim2, &amp;sConfigOC, TIM_CHANNEL_1) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN TIM2_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END TIM2_Init 2 */</span><br>  HAL_TIM_MspPostInit(&amp;htim2);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOH_CLK_ENABLE();<br>  __HAL_RCC_GPIOA_CLK_ENABLE();<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h3 id="4-3-效果展示"><a href="#4-3-效果展示" class="headerlink" title="4.3 效果展示"></a>4.3 效果展示</h3><iframe height=500 width=100% src="//player.bilibili.com/player.html?aid=98576098&bvid=BV177411m7we&cid=168273908&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进阶篇 V [Clock Tree]</title>
    <link href="/posts/44ad04be/"/>
    <url>/posts/44ad04be/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="1-0-什么是Clock-Tree？"><a href="#1-0-什么是Clock-Tree？" class="headerlink" title="1.0 什么是Clock Tree？"></a>1.0 什么是Clock Tree？</h2><h3 id="1-1-定义"><a href="#1-1-定义" class="headerlink" title="1.1 定义"></a>1.1 定义</h3><blockquote><p>时钟是单片机运行的基础，时钟信号推动单片机内各个部分执行相应的指令。<strong>时钟系统就是CPU的心脏</strong>，决定CPU速率，像人的心跳一样 只有有了心跳，人才能做其他的事情，而单片机有了时钟，才能够运行执行指令，才能够做其他的处理（点灯，串口，ADC），时钟的重要性不言而喻。</p><p>STM32本身十分复杂，外设非常多  但我们实际使用的时候只会用到有限的几个外设，使用任何外设都需要时钟才能启动，但并不是所有的外设都需要系统时钟那么高的频率，为了兼容不同速度的设备，有些高速，有些低速，如果都用高速时钟，势必造成浪费   并且，同一个电路，时钟越快功耗越快，同时抗电磁干扰能力也就越弱，所以较为复杂的MCU都是采用多时钟源的方法来解决这些问题。所以便有了STM32的时钟系统和时钟树。</p><ol><li>STM32时钟系统主要的目的就是给相对独立的外设模块提供时钟，也是为了<strong>降低整个芯片的耗能</strong>。</li><li>系统时钟，是处理器运行时间基准（每一条机器指令一个时钟周期）</li><li>时钟是单片机运行的基础，时钟信号推动单片机内各个部分执行相应的指令。</li><li>一个单片机内提供多个不同的系统时钟，可以适应更多的应用场合。</li><li>不同的功能模块会有不同的时钟上限，因此提供不同的时钟，也能在一个单片机内放置更多的功能模块。</li><li>对不同模块的时钟增加开启和关闭功能，可以降低单片机的功耗</li><li>STM32为了低功耗，他将所有的外设时钟都设置为disable（不使能），用到什么外设，只要打开对应外设的时钟就可以，其他的没用到的可以还是disable（不使能），这样耗能就会减少。这就是为什么不管你配置什么功能都需要先打开对应的时钟的原因。</li></ol></blockquote><h3 id="1-2-解析"><a href="#1-2-解析" class="headerlink" title="1.2 解析"></a>1.2 解析</h3><p><img src="https://i.loli.net/2020/03/19/jq3UoHD2Jn4hbWA.png" alt="Clock Tree.png"></p><p>先不要被吓到，我们慢慢来一条线一条线地梳理清楚。</p><p>除了时钟，有两个概念必须提前讲解</p><p><img src="https://i.loli.net/2020/03/19/ELGc2FiOAHbrfMy.png" alt="PLL and Prescaler.png"></p><ul><li><strong>Phase-Locked Loop ( PLL )</strong> ：锁相环 的作用是整数倍地增高频率</li><li><strong>Prescaler</strong>：预分频器 的作用是整数倍地降低频率</li></ul><p>在STM32F4系列中，有5个最重要的时钟源，为HSI、HSE、LSI、LSE、PLL。其中PLL实际是分为三个时钟源，分别为主PLL和I2S部分专用PLLI2S和SAI部分专用PLLSAI。从时钟频率来分可以分为高速时钟源和低速时钟源，在这5个中HSI，HSE以及PLL是高速时钟，LSI和LSE是低速时钟。从来源可分为外部时钟源和内部时钟源，外部时钟源就是从外部通过接晶振的方式获取时钟源，其中HSE和LSE是外部时钟源，其他的是内部时钟源。</p><ul><li><strong>❶ LSI</strong>：Low Speed Internal 低速内部时钟，RC振荡器，频率为32kHz左右，供独立看门狗和自动唤醒单元使用</li><li><strong>❷ LSE</strong>：Low Speed External 低速外部时钟，接频率为32.768kHz的石英晶体，这个主要是RTC的时钟源</li><li><strong>❸ HSE</strong>：High Speed External 高速外部时钟，可接石英/陶瓷谐振器，或者接外部时钟源，频率范围为4MHz~26MHz，HSE也可以直接做为系统时钟或者PLL输入</li><li><strong>❹ HSI</strong>：High Speed Internal 高速内部时钟，RC振荡器，频率为16MHz，可以直接作为系统时钟或者用作PLL输入</li><li><strong>❺ PLL</strong>：Phase-Locked Loop 锁相环倍频输出，STM32F4有三个PLL<ol><li><strong>主PLL</strong>由HSE或者HSI提供时钟信号，并具有两个不同的输出时钟，第一个输出PLLP用于生成高速的系统时钟（最高180MHz）；第二个输出PLLQ为48M时钟，用于USB OTG FS时钟，随机数发生器的时钟，和SDIO时钟</li><li>第一个专用PLL ( <strong>PLLI2S</strong> ) 用于生成精确时钟，在I2S和SAI1上实现高品质音频性能，其中，N是用于PLLI2S vco的倍频系数，其取值范围是：192~432；R是I2S时钟的分频系数，其取值范围是：2~7；Q是SAI时钟分频系数，其取值范围是：2~15；P没用到</li><li>第二个专用PLL ( <strong>PLLSAI</strong> ) 同样用于生成精确时钟，用于SAI1输入时钟，同时还为LCD_TFT接口提供精确时钟,其中，N是用于PLLSAI vco的倍频系数，其取值范围是：192~432；Q是SAI时钟分频系数，其取值范围是：2~15；R是LTDC时钟的分频系数，其取值范围是：2~7；P没用到</li></ol></li><li><strong>A 看门狗时钟</strong>：看门狗时钟源只能是低速的 LSI 时钟</li><li><strong>B RTC时钟源</strong>：RTC的时钟源可以选择LSI，LSE，以及HSE分频后的时钟，HSE 分频系数为2~31</li><li><strong>C MCO1 MCO2输出时钟</strong>：MCO1是向芯片的PA8引脚输出时钟，它有四个时钟来源分别为：HSI，LSE，HSE，和PLL时钟；MCO2是向芯片的PC9输出时钟，它同样有四个时钟来源分别为：HSE，PLL，SYSCLK以及PLLI2S时钟；MCO输出时钟频率最大不超过100MHz</li><li><strong>D 系统时钟</strong>：SYSCLK系统时钟来源有三个方面：HSI，HSE，和PLL，在我们实际应用中，因为对时钟速度要求都比较高我们才会选用STM32F4这种高性能处理器，所以一般情况下，都是采用PLL作为SYSCLK时钟源</li><li><strong>E 以太网PTP时钟 AHB时钟 APB2高速时钟 APB1低速时钟</strong>：这些时钟都是来源于 SYSCLK系统时钟，其中以太网PTP时钟是使用系统时钟，AHB，APB2，和APB1时钟是经过SYSCLK时钟分频得来，这里大家记住，AHB最大时钟为168MHz，APB2高速时钟最大频率为84MHz，而APB1低速时钟最大频率为42MHz</li><li><strong>F PLLI2S_R时钟</strong>：可以作为I2S时钟源</li><li><strong>G PLLI2S_Q时钟</strong>：可以作为SAI1_A和SAI1_B时钟来源</li><li><strong>H PLLSAI_Q时钟</strong>：可以作为SAI1_A和SAI1_B时钟来源</li><li><strong>I PLLSAI_R时钟</strong>：LCD-TFT ( LTDC ) 接口时钟唯一来源</li><li><strong>J 以太网MAC时钟</strong>：对于MII接口来说，必须向外部PHY芯片提供25Mhz的时钟，这个时钟，可以由PHY芯片外接晶振，或者使用STM32F4的MCO输出来提供，然后，PHY芯片再给STM32F4提供ETH_MII_TX_CLK和ETH_MII_RX_CLK时钟，对于RMII接口来说，外部必须提供50Mhz的时钟驱动PHY和STM32F4的 ETH_RMII_REF_CLK，这个50Mhz时钟可以来自PHY，有源晶振，或者STM32F4的MCO</li><li><strong>K USB OTG HS时钟</strong>：指外部PHY提供的USB OTG HS ( 60MHZ ) 时钟</li></ul><h2 id="2-0-如何配置Clock-Tree？"><a href="#2-0-如何配置Clock-Tree？" class="headerlink" title="2.0 如何配置Clock Tree？"></a>2.0 如何配置Clock Tree？</h2><ul><li>配置方式<ul><li><strong>STM32CubeMX</strong>静态调控</li><li>函数动态调控（RM暂时用不上，这部分不讲解）</li></ul></li><li><strong>STM32CubeMX</strong><ul><li><strong>Input frequency</strong>改为12MHz</li><li><strong>PLL Source Mux</strong>选择HSE，因为HSE比HSI的精确性和最大频率高得多</li><li><strong>System Clock Mux</strong>选择PLLCLK，因为即便选择HSE，频率依然不足，而PLLCLK可以成倍增加频率</li><li>最后，在<strong>Ethernet PTP clock</strong>那里，输入168MHz，回车，STM32CubeMX会自动配置剩下的东西，到这一步，iRM2018的Clock Tree就已经配置完成了！</li><li>可能到这一步，<strong>I2S source Mux</strong>不是48MHz，并且是灰色，无法修改，那就暂时不用动了</li></ul></li></ul><p>如果你成功了，将会看到下面这个配置</p><p><img src="https://i.loli.net/2020/03/19/Jt8nEB7XNkK4ljf.jpg" alt="iRM 2018 Clock Tree.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进阶篇 IV [DMA]</title>
    <link href="/posts/90d72de/"/>
    <url>/posts/90d72de/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="1-0-什么是DMA"><a href="#1-0-什么是DMA" class="headerlink" title="1.0 什么是DMA"></a>1.0 什么是DMA</h2><h3 id="1-1-DMA的定义"><a href="#1-1-DMA的定义" class="headerlink" title="1.1 DMA的定义"></a>1.1 DMA的定义</h3><blockquote><p><strong>Direct Memory Access</strong>：直接存储器访问 是所有现代计算设备的重要特色，它允许不同速度的硬件装置来沟通，而不需要依赖于CPU的大量中断负载。否则，CPU需要从来源把每一片段的资料复制到暂存器，然后把它们再次写回到新的地方。在这个时间中，CPU对于其他的工作来说就无法使用。DMA传输将数据从一个地址空间复制到另外一个地址空间。当CPU初始化这个传输动作，传输动作本身是由DMA控制器来实行和完成。典型的例子就是移动一个外部内存的区块到芯片内部更快的内存区。像是这样的操作并没有让处理器工作拖延，反而可以被重新排程去处理其他的工作。DMA传输是高效能嵌入式系统算法和网络最关键的部分。</p><p><img src="https://i.loli.net/2020/03/18/azCv1BIboh3pqRw.png" alt="DMA and CPU.png"></p><p>从上图可以看出，DMA和CPU是同等地位的，CPU能进行的数据转移操作，DMA都能做，或者说，DMA就是只能做数据转移操作的迷你CPU。</p><p><strong>如果要简单理解的话，DMA就是CPU小弟，当CPU觉得把一大串数据转移到另一个地方这种任务太麻烦，还有更重要的事情需要做的时候，就可以把这个任务丢给DMA去干，DMA干完或者出问题了跟CPU说一声就行了。</strong></p></blockquote><h3 id="1-2-DMA的内部结构"><a href="#1-2-DMA的内部结构" class="headerlink" title="1.2 DMA的内部结构"></a>1.2 DMA的内部结构</h3><p><img src="https://i.loli.net/2020/03/18/EdXKJHMpeFGIYCq.png" alt="DMA detail.png"></p><ul><li><strong>STM32 –&gt; DMA –&gt; Stream –&gt; Channel</strong><ul><li>STM32F4家族拥有两个DMA，其中只有DMA2能够进行M2M操作（稍后会讲）。</li><li>每个DMA一般拥有8个Stream。</li><li>每个Stream有多个Channel选项，但是一次只能进行一个Channel的传输，具体的配置与选项请参考芯片对应的数据手册。</li></ul></li></ul><p><img src="https://i.loli.net/2020/03/18/rvAE1LUcOy4iVTH.png" alt="Stream and Channel.png"></p><h2 id="2-0-什么情况下使用DMA？"><a href="#2-0-什么情况下使用DMA？" class="headerlink" title="2.0 什么情况下使用DMA？"></a>2.0 什么情况下使用DMA？</h2><h3 id="2-1-UART"><a href="#2-1-UART" class="headerlink" title="2.1 UART"></a>2.1 UART</h3><ul><li>这是最常见的使用情况，当有大量的数据从UART读入或者写入的时候，DMA将CPU解放出来，然后自己单干，让CPU处理更重要的事情。</li></ul><h3 id="2-2-ADC"><a href="#2-2-ADC" class="headerlink" title="2.2 ADC"></a>2.2 ADC</h3><ul><li>一般在需要ADC时的通道扫描模式下，需要DMA来处理，本章不讲解这部分，放到后面专门讲ADC的篇章。</li></ul><h3 id="2-3-SD"><a href="#2-3-SD" class="headerlink" title="2.3 SD"></a>2.3 SD</h3><ul><li>需要大量往SD里面读写数据的时候一般也用DMA来处理，本章不讲解这部分。</li></ul><h2 id="3-0-DMA的使用方法"><a href="#3-0-DMA的使用方法" class="headerlink" title="3.0 DMA的使用方法"></a>3.0 DMA的使用方法</h2><h3 id="3-1-传输方向"><a href="#3-1-传输方向" class="headerlink" title="3.1 传输方向"></a>3.1 传输方向</h3><ul><li>P2P<ul><li><em>Peripheral to Peripheral</em>：从外设到外设 在RM中暂时用不上，不讲解</li></ul></li><li><strong>P2M</strong><ul><li><em>Peripheral to Memory</em>：从外设到内存 当传感器从UART传来数据的时候用</li></ul></li><li><strong>M2P</strong><ul><li><em>Memory to Peripheral</em>：从内存到外设 从UART传出数据控制执行器的时候用</li></ul></li><li><strong>M2M</strong><ul><li><em>Memory to Memory</em>：从内存到内存 MCU内部的数据转移，常见于Buffer之间互相转移数据，或者从Buffer读写数据</li><li>只有DMA2能够执行M2M操作。</li></ul></li></ul><h3 id="3-2-特殊选项"><a href="#3-2-特殊选项" class="headerlink" title="3.2 特殊选项"></a>3.2 特殊选项</h3><ul><li><strong>First In First Out</strong>是STM32里面的DMA的特殊功能，但是一般来说，RM就算不用FIFO，DMA也能完美处理数据，所以暂时不需要，也同样不讲解。</li></ul><h3 id="3-3-传输模式"><a href="#3-3-传输模式" class="headerlink" title="3.3 传输模式"></a>3.3 传输模式</h3><h4 id="3-3-1-Normal-Mode"><a href="#3-3-1-Normal-Mode" class="headerlink" title="3.3.1 Normal Mode"></a>3.3.1 Normal Mode</h4><ul><li>常用的默认模式，在该模式下，任务完成后就停止DMA，如果还需要用到DMA，需要再次手动启动。</li></ul><h4 id="3-3-2-Circular-Mode-Continuous-Mode"><a href="#3-3-2-Circular-Mode-Continuous-Mode" class="headerlink" title="3.3.2 Circular Mode / Continuous Mode"></a>3.3.2 Circular Mode / Continuous Mode</h4><ul><li>可选模式，在该模式下，任务完成后，DMA的Buffer清零，再次执行任务。也就是说，永远重复执行下去，除非手动停止。</li></ul><h3 id="3-4-传输方式"><a href="#3-4-传输方式" class="headerlink" title="3.4 传输方式"></a>3.4 传输方式</h3><h4 id="3-4-1-DMA泛用方法（需要用到寄存器）"><a href="#3-4-1-DMA泛用方法（需要用到寄存器）" class="headerlink" title="3.4.1 DMA泛用方法（需要用到寄存器）"></a>3.4.1 DMA泛用方法（需要用到寄存器）</h4><h5 id="3-4-1-1-Polling"><a href="#3-4-1-1-Polling" class="headerlink" title="3.4.1.1 Polling"></a>3.4.1.1 Polling</h5><blockquote><p>需要注意的是，DMA的Polling其实根本毫无意义，因为在这个过程中，CPU还是全程参与了，并没有解放CPU，所以，虽然这种方法我还是列出来了，但是除了Debug时可能会用到，其他情况下建议不要用。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_DMA_Start</span><span class="hljs-params">(DMA_HandleTypeDef *hdma, <span class="hljs-keyword">uint32_t</span> SrcAddress, <span class="hljs-keyword">uint32_t</span>DstAddress, <span class="hljs-keyword">uint32_t</span> DataLength)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hdma</code>：指向DMA Stream配置结构体</li><li><code>SrcAddress</code>：需要传输的数据的地址</li><li><code>DstAddress</code>：数据传输到的目标地址</li><li><code>DataLength</code>：传输的数据大小</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输配置成功，返回<code>HAL_OK</code>；如果该DMA Stream正在被占用，返回<code>HAL_BUSY</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">huart.Instance-&gt;CR3|=USART_CR3_DMAT;<br></code></pre></td></tr></table></figure><ul><li>通过修改CR3寄存器对应的bit，开启DMA传输</li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_DMA_PollForTransfer</span><span class="hljs-params">(DMA_HandleTypeDef *hdma, HAL_DMA_LevelCompleteTypeDef CompleteLevel, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hdma</code>：指向DMA Stream配置结构体</li><li><code>CompleteLevel</code>：指定DMA的完成程度</li><li><code>Timeout</code>：传输的最大时限</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输成功，返回<code>HAL_OK</code>；如果传输出错，返回<code>HAL_ERROR</code>；如果传输超过最大时限，返回<code>HAL_TIMEOUT</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">huart.Instance-&gt;CR3&amp;=~USART_CR3_DMAT;<br></code></pre></td></tr></table></figure><ul><li>通过修改CR3寄存器对应的bit，结束DMA传输</li></ul><h5 id="3-4-1-2-Interrupt"><a href="#3-4-1-2-Interrupt" class="headerlink" title="3.4.1.2 Interrupt"></a>3.4.1.2 Interrupt</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_DMA_Start_IT</span><span class="hljs-params">(DMA_HandleTypeDef *hdma, <span class="hljs-keyword">uint32_t</span> SrcAddress, <span class="hljs-keyword">uint32_t</span>DstAddress, <span class="hljs-keyword">uint32_t</span> DataLength)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>hdma</code>：指向DMA Stream配置结构体</li><li><code>SrcAddress</code>：需要传输的数据的地址</li><li><code>DstAddress</code>：数据传输到的目标地址</li><li><code>DataLength</code>：传输的数据大小</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输配置成功，返回<code>HAL_OK</code>；如果该DMA Stream正在被占用，则返回<code>HAL_BUSY</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">huart.Instance-&gt;CR3|=USART_CR3_DMAT;<br></code></pre></td></tr></table></figure><ul><li>通过修改CR3寄存器对应的bit，开启DMA传输</li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">XferCpltCallback</span><span class="hljs-params">(DMA_HandleTypeDef *hdma)</span></span>&#123;<br>    ......<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>XferCpltCallback</code>函数</li><li>在该函数中填写DMA传输结束后，需要执行的代码</li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">huart.Instance-&gt;CR3&amp;=~USART_CR3_DMAT;<br></code></pre></td></tr></table></figure><ul><li>通过修改CR3寄存器对应的bit，结束DMA传输</li></ul><h4 id="3-4-2-UART特化方法（全HAL库实现）"><a href="#3-4-2-UART特化方法（全HAL库实现）" class="headerlink" title="3.4.2 UART特化方法（全HAL库实现）"></a>3.4.2 UART特化方法（全HAL库实现）</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Transmit_DMA</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>huart</code>：指向UART引脚配置结构体</li><li><code>pData</code>：指向需要传输的数据</li><li><code>Size</code>：传输数据的大小</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输配置成功，返回<code>HAL_OK</code>；如果传输出错，返回<code>HAL_ERROR</code>；如果该DMA Stream正在被占用，则返回<code>HAL_BUSY</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Receive_DMA</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>huart</code>：指向UART引脚配置结构体</li><li><code>pData</code>：指向需要传输的数据</li><li><code>Size</code>：传输数据的大小</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输配置成功，返回<code>HAL_OK</code>；如果传输出错，返回<code>HAL_ERROR</code>；如果该DMA Stream正在被占用，则返回<code>HAL_BUSY</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_TxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span>&#123;<br>......<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>HAL_UART_TxCpltCallback</code>函数</li><li>在该函数中填写UART发送结束后，需要执行的代码</li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_RxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span>&#123;<br>......<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>HAL_UART_RxCpltCallback</code>函数</li><li>在该函数中填写UART接收结束后，需要执行的代码</li></ul><h2 id="4-0-练习项目"><a href="#4-0-练习项目" class="headerlink" title="4.0 练习项目"></a>4.0 练习项目</h2><h3 id="4-1-项目简介"><a href="#4-1-项目简介" class="headerlink" title="4.1 项目简介"></a>4.1 项目简介</h3><ul><li><strong>一键发送信息</strong>：按下用户自定义按钮，就从UART发送出预先设定好的信息，完成后在板子上亮红灯0.2s。</li><li><strong>键盘回响</strong>：按下键盘，从STM32返回对应的字符，完成后在板子上亮绿灯0.2s。然后，再加上上面一键发送信息的功能。</li></ul><h3 id="4-2-项目代码"><a href="#4-2-项目代码" class="headerlink" title="4.2 项目代码"></a>4.2 项目代码</h3><blockquote><p>完整的工程文件可以在<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">这里</a>找到！</p></blockquote><h4 id="4-2-1-一键发送信息"><a href="#4-2-1-一键发送信息" class="headerlink" title="4.2.1 一键发送信息"></a>4.2.1 一键发送信息</h4><ul><li><strong>DMA泛用方法 Polling</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;string.h&quot;</span></span><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>UART_HandleTypeDef huart7;<br>DMA_HandleTypeDef hdma_uart7_tx;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><span class="hljs-keyword">char</span> msg[]=<span class="hljs-string">&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      .(&amp;@&amp;,        &amp;@@@@@@@%        *@@&amp;(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   %@@@@@@@@%%&amp;@@@@@@@@@@@@@@@@@@@&amp;%&amp;@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;           ,.    .&amp;@@@@@@@@@@@@@&amp;(.           ,(&amp;@@@@@@@@@@@@@&amp;.    .,\r\n&quot;</span><br>           <span class="hljs-string">&quot;          &amp;@@@@&amp;@@@@@@@@@@@&amp;,   ###%#%%%%#%%%####   *&amp;@@@@@@@@@@@&amp;@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;        /@@@@@@@@@@@@@@@&amp;          ,@@@@@@@@&amp;.         .&amp;@@@@@@@@@@@@@@@,\r\n&quot;</span><br>           <span class="hljs-string">&quot;       (&amp;@@@@@@@@@@@@@#             (@@@@@@@/             %@@@@@@@@@@@@@&amp;*\r\n&quot;</span><br>           <span class="hljs-string">&quot;           &amp;@@@@@@@@&amp;.        ,%@@@@&amp;@@@@@@@&amp;@@@&amp;%,        ,&amp;@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;          /@@@@@@@@%       #@@@@@(  *@@@@@@&amp;,  %@@@@&amp;(       &amp;@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@%      #@@@@@%    *@@@@@@&amp;,    &amp;@@@@@#      &amp;@@@@@@@&amp;.                #  \&quot;There is no truth in flesh,     only betrayal.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    ,%%%%&amp;@@@@@@@@*     &amp;@@@@@%     *@@@@@@&amp;,     %@@@@@%     ,@@@@@@@@&amp;%%%%            #  \&quot;There is no strength in flesh,  only weakness.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;.    #@@@@@@,     *@@@@@@&amp;,     ,@@@@@@(    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no constancy in flesh, only decay   .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;     %@@@@@@,     *@@@@@@&amp;,     ,@@@@@@#    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no certainty in flesh, but death    .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    *&amp;@@@@@@@@@@@&amp;,    .@@@@@@#     *@@@@@@&amp;,     %@@@@@&amp;     ,@@@@@@@@@@@@&amp;.           #                                 — Credo Omnissiah\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@#     .&amp;@@@@@(    *@@@@@@&amp;,    %@@@@@&amp;      %@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;          (@@@@@@@@(      ,&amp;@@@@&amp;.  *@@@@@@&amp;,  *&amp;@@@@%.      #@@@@@@@@(                 Welcome back to Adeptus Mechanicus, Alchemic Ronin!\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %@@@@@@@@%        .%@@@@&amp;%@@@@@@@%&amp;@@@@#.        %@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;       .(&amp;@@@@@@@@@@@@,            *%@@@@@@@%*            (@@@@@@@@@@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;        %@@@@@@@@@@@@@@@/         .(@@@@@@@@@(.         #@@@@@@@@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@@@@@@@@@@(    ,***************,    #&amp;@@@@@@@@@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %(    #@@@@@@@@@@@@@%*.             ./&amp;@@@@@@@@@@@@@/   .##\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   .&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%.\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   &amp;@@@@@@@@@&amp;@@@@@@@@@@@@@@@@@@@@@&amp;@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      /&amp;@@@/      .*&amp;@@@@@@@&amp;,.      (@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    .,,,,,,,.\r\n&quot;</span><br>           <span class="hljs-string">&quot;\r\n&quot;</span>;<br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_DMA_Init();<br>  MX_UART7_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port,LD_RED_Pin,GPIO_PIN_SET);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;<br>  RCC_OscInitStruct.HSIState = RCC_HSI_ON;<br>  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief UART7 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 1 */</span><br>  huart7.Instance = UART7;<br>  huart7.Init.BaudRate = <span class="hljs-number">115200</span>;<br>  huart7.Init.WordLength = UART_WORDLENGTH_8B;<br>  huart7.Init.StopBits = UART_STOPBITS_1;<br>  huart7.Init.Parity = UART_PARITY_NONE;<br>  huart7.Init.Mode = UART_MODE_TX_RX;<br>  huart7.Init.HwFlowCtl = UART_HWCONTROL_NONE;<br>  huart7.Init.OverSampling = UART_OVERSAMPLING_16;<br>  <span class="hljs-keyword">if</span> (HAL_UART_Init(&amp;huart7) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/** </span><br><span class="hljs-comment">  * Enable DMA controller clock</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* DMA controller clock enable */</span><br>  __HAL_RCC_DMA1_CLK_ENABLE();<br><br>  <span class="hljs-comment">/* DMA interrupt init */</span><br>  <span class="hljs-comment">/* DMA1_Stream1_IRQn interrupt configuration */</span><br>  HAL_NVIC_SetPriority(DMA1_Stream1_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(DMA1_Stream1_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/* EXTI interrupt init*/</span><br>  HAL_NVIC_SetPriority(EXTI2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(EXTI2_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span>&#123;<br><span class="hljs-keyword">if</span>(GPIO_Pin == Button_Pin)&#123;<br>HAL_Delay(<span class="hljs-number">500</span>);<br>HAL_DMA_Start(&amp;hdma_uart7_tx,(<span class="hljs-keyword">uint32_t</span>)msg,(<span class="hljs-keyword">uint32_t</span>)&amp;huart7.Instance-&gt;DR,<span class="hljs-built_in">strlen</span>(msg));<br>huart7.Instance-&gt;CR3|=USART_CR3_DMAT;<br>HAL_DMA_PollForTransfer(&amp;hdma_uart7_tx,HAL_DMA_FULL_TRANSFER,HAL_MAX_DELAY);<br>huart7.Instance-&gt;CR3&amp;=~USART_CR3_DMAT;<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>HAL_Delay(<span class="hljs-number">200</span>);<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>&#125;<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><ul><li><strong>DMA泛用方法 Interrupt</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;string.h&quot;</span></span><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>UART_HandleTypeDef huart7;<br>DMA_HandleTypeDef hdma_uart7_tx;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><span class="hljs-keyword">char</span> msg[]=<span class="hljs-string">&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      .(&amp;@&amp;,        &amp;@@@@@@@%        *@@&amp;(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   %@@@@@@@@%%&amp;@@@@@@@@@@@@@@@@@@@&amp;%&amp;@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;           ,.    .&amp;@@@@@@@@@@@@@&amp;(.           ,(&amp;@@@@@@@@@@@@@&amp;.    .,\r\n&quot;</span><br>           <span class="hljs-string">&quot;          &amp;@@@@&amp;@@@@@@@@@@@&amp;,   ###%#%%%%#%%%####   *&amp;@@@@@@@@@@@&amp;@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;        /@@@@@@@@@@@@@@@&amp;          ,@@@@@@@@&amp;.         .&amp;@@@@@@@@@@@@@@@,\r\n&quot;</span><br>           <span class="hljs-string">&quot;       (&amp;@@@@@@@@@@@@@#             (@@@@@@@/             %@@@@@@@@@@@@@&amp;*\r\n&quot;</span><br>           <span class="hljs-string">&quot;           &amp;@@@@@@@@&amp;.        ,%@@@@&amp;@@@@@@@&amp;@@@&amp;%,        ,&amp;@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;          /@@@@@@@@%       #@@@@@(  *@@@@@@&amp;,  %@@@@&amp;(       &amp;@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@%      #@@@@@%    *@@@@@@&amp;,    &amp;@@@@@#      &amp;@@@@@@@&amp;.                #  \&quot;There is no truth in flesh,     only betrayal.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    ,%%%%&amp;@@@@@@@@*     &amp;@@@@@%     *@@@@@@&amp;,     %@@@@@%     ,@@@@@@@@&amp;%%%%            #  \&quot;There is no strength in flesh,  only weakness.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;.    #@@@@@@,     *@@@@@@&amp;,     ,@@@@@@(    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no constancy in flesh, only decay   .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;     %@@@@@@,     *@@@@@@&amp;,     ,@@@@@@#    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no certainty in flesh, but death    .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    *&amp;@@@@@@@@@@@&amp;,    .@@@@@@#     *@@@@@@&amp;,     %@@@@@&amp;     ,@@@@@@@@@@@@&amp;.           #                                 — Credo Omnissiah\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@#     .&amp;@@@@@(    *@@@@@@&amp;,    %@@@@@&amp;      %@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;          (@@@@@@@@(      ,&amp;@@@@&amp;.  *@@@@@@&amp;,  *&amp;@@@@%.      #@@@@@@@@(                 Welcome back to Adeptus Mechanicus, Alchemic Ronin!\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %@@@@@@@@%        .%@@@@&amp;%@@@@@@@%&amp;@@@@#.        %@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;       .(&amp;@@@@@@@@@@@@,            *%@@@@@@@%*            (@@@@@@@@@@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;        %@@@@@@@@@@@@@@@/         .(@@@@@@@@@(.         #@@@@@@@@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@@@@@@@@@@(    ,***************,    #&amp;@@@@@@@@@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %(    #@@@@@@@@@@@@@%*.             ./&amp;@@@@@@@@@@@@@/   .##\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   .&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%.\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   &amp;@@@@@@@@@&amp;@@@@@@@@@@@@@@@@@@@@@&amp;@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      /&amp;@@@/      .*&amp;@@@@@@@&amp;,.      (@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    .,,,,,,,.\r\n&quot;</span><br>           <span class="hljs-string">&quot;\r\n&quot;</span>;<br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_DMA_Init();<br>  MX_UART7_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port,LD_RED_Pin,GPIO_PIN_SET);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;<br>  RCC_OscInitStruct.HSIState = RCC_HSI_ON;<br>  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief UART7 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 1 */</span><br>  huart7.Instance = UART7;<br>  huart7.Init.BaudRate = <span class="hljs-number">115200</span>;<br>  huart7.Init.WordLength = UART_WORDLENGTH_8B;<br>  huart7.Init.StopBits = UART_STOPBITS_1;<br>  huart7.Init.Parity = UART_PARITY_NONE;<br>  huart7.Init.Mode = UART_MODE_TX_RX;<br>  huart7.Init.HwFlowCtl = UART_HWCONTROL_NONE;<br>  huart7.Init.OverSampling = UART_OVERSAMPLING_16;<br>  <span class="hljs-keyword">if</span> (HAL_UART_Init(&amp;huart7) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/** </span><br><span class="hljs-comment">  * Enable DMA controller clock</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* DMA controller clock enable */</span><br>  __HAL_RCC_DMA1_CLK_ENABLE();<br><br>  <span class="hljs-comment">/* DMA interrupt init */</span><br>  <span class="hljs-comment">/* DMA1_Stream1_IRQn interrupt configuration */</span><br>  HAL_NVIC_SetPriority(DMA1_Stream1_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(DMA1_Stream1_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/* EXTI interrupt init*/</span><br>  HAL_NVIC_SetPriority(EXTI2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(EXTI2_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span>&#123;<br><span class="hljs-keyword">if</span>(GPIO_Pin == Button_Pin)&#123;<br>HAL_Delay(<span class="hljs-number">500</span>);<br>HAL_DMA_Start_IT(&amp;hdma_uart7_tx,(<span class="hljs-keyword">uint32_t</span>)msg,(<span class="hljs-keyword">uint32_t</span>)&amp;huart7.Instance-&gt;DR,<span class="hljs-built_in">strlen</span>(msg));<br>huart7.Instance-&gt;CR3|=USART_CR3_DMAT;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">XferCpltCallback</span><span class="hljs-params">(DMA_HandleTypeDef *hdma)</span></span>&#123;<br><span class="hljs-keyword">if</span>(hdma-&gt;Instance == DMA1_Stream1)&#123;<br>huart7.Instance-&gt;CR3&amp;=~USART_CR3_DMAT;<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>HAL_Delay(<span class="hljs-number">200</span>);<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>&#125;<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><ul><li><strong>UART特化方法</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;string.h&quot;</span></span><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>UART_HandleTypeDef huart7;<br>DMA_HandleTypeDef hdma_uart7_tx;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><span class="hljs-keyword">char</span> msg[]=<span class="hljs-string">&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      .(&amp;@&amp;,        &amp;@@@@@@@%        *@@&amp;(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   %@@@@@@@@%%&amp;@@@@@@@@@@@@@@@@@@@&amp;%&amp;@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;           ,.    .&amp;@@@@@@@@@@@@@&amp;(.           ,(&amp;@@@@@@@@@@@@@&amp;.    .,\r\n&quot;</span><br>           <span class="hljs-string">&quot;          &amp;@@@@&amp;@@@@@@@@@@@&amp;,   ###%#%%%%#%%%####   *&amp;@@@@@@@@@@@&amp;@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;        /@@@@@@@@@@@@@@@&amp;          ,@@@@@@@@&amp;.         .&amp;@@@@@@@@@@@@@@@,\r\n&quot;</span><br>           <span class="hljs-string">&quot;       (&amp;@@@@@@@@@@@@@#             (@@@@@@@/             %@@@@@@@@@@@@@&amp;*\r\n&quot;</span><br>           <span class="hljs-string">&quot;           &amp;@@@@@@@@&amp;.        ,%@@@@&amp;@@@@@@@&amp;@@@&amp;%,        ,&amp;@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;          /@@@@@@@@%       #@@@@@(  *@@@@@@&amp;,  %@@@@&amp;(       &amp;@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@%      #@@@@@%    *@@@@@@&amp;,    &amp;@@@@@#      &amp;@@@@@@@&amp;.                #  \&quot;There is no truth in flesh,     only betrayal.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    ,%%%%&amp;@@@@@@@@*     &amp;@@@@@%     *@@@@@@&amp;,     %@@@@@%     ,@@@@@@@@&amp;%%%%            #  \&quot;There is no strength in flesh,  only weakness.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;.    #@@@@@@,     *@@@@@@&amp;,     ,@@@@@@(    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no constancy in flesh, only decay   .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;     %@@@@@@,     *@@@@@@&amp;,     ,@@@@@@#    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no certainty in flesh, but death    .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    *&amp;@@@@@@@@@@@&amp;,    .@@@@@@#     *@@@@@@&amp;,     %@@@@@&amp;     ,@@@@@@@@@@@@&amp;.           #                                 — Credo Omnissiah\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@#     .&amp;@@@@@(    *@@@@@@&amp;,    %@@@@@&amp;      %@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;          (@@@@@@@@(      ,&amp;@@@@&amp;.  *@@@@@@&amp;,  *&amp;@@@@%.      #@@@@@@@@(                 Welcome back to Adeptus Mechanicus, Alchemic Ronin!\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %@@@@@@@@%        .%@@@@&amp;%@@@@@@@%&amp;@@@@#.        %@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;       .(&amp;@@@@@@@@@@@@,            *%@@@@@@@%*            (@@@@@@@@@@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;        %@@@@@@@@@@@@@@@/         .(@@@@@@@@@(.         #@@@@@@@@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@@@@@@@@@@(    ,***************,    #&amp;@@@@@@@@@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %(    #@@@@@@@@@@@@@%*.             ./&amp;@@@@@@@@@@@@@/   .##\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   .&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%.\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   &amp;@@@@@@@@@&amp;@@@@@@@@@@@@@@@@@@@@@&amp;@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      /&amp;@@@/      .*&amp;@@@@@@@&amp;,.      (@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    .,,,,,,,.\r\n&quot;</span><br>           <span class="hljs-string">&quot;\r\n&quot;</span>;<br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_DMA_Init();<br>  MX_UART7_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port,LD_RED_Pin,GPIO_PIN_SET);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;<br>  RCC_OscInitStruct.HSIState = RCC_HSI_ON;<br>  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief UART7 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 1 */</span><br>  huart7.Instance = UART7;<br>  huart7.Init.BaudRate = <span class="hljs-number">115200</span>;<br>  huart7.Init.WordLength = UART_WORDLENGTH_8B;<br>  huart7.Init.StopBits = UART_STOPBITS_1;<br>  huart7.Init.Parity = UART_PARITY_NONE;<br>  huart7.Init.Mode = UART_MODE_TX_RX;<br>  huart7.Init.HwFlowCtl = UART_HWCONTROL_NONE;<br>  huart7.Init.OverSampling = UART_OVERSAMPLING_16;<br>  <span class="hljs-keyword">if</span> (HAL_UART_Init(&amp;huart7) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/** </span><br><span class="hljs-comment">  * Enable DMA controller clock</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* DMA controller clock enable */</span><br>  __HAL_RCC_DMA1_CLK_ENABLE();<br><br>  <span class="hljs-comment">/* DMA interrupt init */</span><br>  <span class="hljs-comment">/* DMA1_Stream1_IRQn interrupt configuration */</span><br>  HAL_NVIC_SetPriority(DMA1_Stream1_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(DMA1_Stream1_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/* EXTI interrupt init*/</span><br>  HAL_NVIC_SetPriority(EXTI2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(EXTI2_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span>&#123;<br><span class="hljs-keyword">if</span>(GPIO_Pin == Button_Pin)&#123;<br>HAL_Delay(<span class="hljs-number">500</span>);<br>HAL_UART_Transmit_DMA(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)msg,<span class="hljs-built_in">strlen</span>(msg));<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_TxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span>&#123;<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>HAL_Delay(<span class="hljs-number">200</span>);<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h4 id="4-2-2-键盘回响"><a href="#4-2-2-键盘回响" class="headerlink" title="4.2.2 键盘回响"></a>4.2.2 键盘回响</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;string.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;stdbool.h&quot;</span></span><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>UART_HandleTypeDef huart7;<br>DMA_HandleTypeDef hdma_uart7_rx;<br>DMA_HandleTypeDef hdma_uart7_tx;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><span class="hljs-keyword">char</span> msg[]=<span class="hljs-string">&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      .(&amp;@&amp;,        &amp;@@@@@@@%        *@@&amp;(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   %@@@@@@@@%%&amp;@@@@@@@@@@@@@@@@@@@&amp;%&amp;@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;           ,.    .&amp;@@@@@@@@@@@@@&amp;(.           ,(&amp;@@@@@@@@@@@@@&amp;.    .,\r\n&quot;</span><br>           <span class="hljs-string">&quot;          &amp;@@@@&amp;@@@@@@@@@@@&amp;,   ###%#%%%%#%%%####   *&amp;@@@@@@@@@@@&amp;@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;        /@@@@@@@@@@@@@@@&amp;          ,@@@@@@@@&amp;.         .&amp;@@@@@@@@@@@@@@@,\r\n&quot;</span><br>           <span class="hljs-string">&quot;       (&amp;@@@@@@@@@@@@@#             (@@@@@@@/             %@@@@@@@@@@@@@&amp;*\r\n&quot;</span><br>           <span class="hljs-string">&quot;           &amp;@@@@@@@@&amp;.        ,%@@@@&amp;@@@@@@@&amp;@@@&amp;%,        ,&amp;@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;          /@@@@@@@@%       #@@@@@(  *@@@@@@&amp;,  %@@@@&amp;(       &amp;@@@@@@@@/\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@%      #@@@@@%    *@@@@@@&amp;,    &amp;@@@@@#      &amp;@@@@@@@&amp;.                #  \&quot;There is no truth in flesh,     only betrayal.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    ,%%%%&amp;@@@@@@@@*     &amp;@@@@@%     *@@@@@@&amp;,     %@@@@@%     ,@@@@@@@@&amp;%%%%            #  \&quot;There is no strength in flesh,  only weakness.\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;.    #@@@@@@,     *@@@@@@&amp;,     ,@@@@@@(    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no constancy in flesh, only decay   .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    /@@@@@@@@@@@@&amp;     %@@@@@@,     *@@@@@@&amp;,     ,@@@@@@#    .&amp;@@@@@@@@@@@&amp;,           #  \&quot;There is no certainty in flesh, but death    .\&quot;\r\n&quot;</span><br>           <span class="hljs-string">&quot;    *&amp;@@@@@@@@@@@&amp;,    .@@@@@@#     *@@@@@@&amp;,     %@@@@@&amp;     ,@@@@@@@@@@@@&amp;.           #                                 — Credo Omnissiah\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@#     .&amp;@@@@@(    *@@@@@@&amp;,    %@@@@@&amp;      %@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;          (@@@@@@@@(      ,&amp;@@@@&amp;.  *@@@@@@&amp;,  *&amp;@@@@%.      #@@@@@@@@(                 Welcome back to Adeptus Mechanicus, Alchemic Ronin!\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %@@@@@@@@%        .%@@@@&amp;%@@@@@@@%&amp;@@@@#.        %@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;       .(&amp;@@@@@@@@@@@@,            *%@@@@@@@%*            (@@@@@@@@@@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;        %@@@@@@@@@@@@@@@/         .(@@@@@@@@@(.         #@@@@@@@@@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;         .&amp;@@@@@@@@@@@@@@@@(    ,***************,    #&amp;@@@@@@@@@@@@@@@&amp;.\r\n&quot;</span><br>           <span class="hljs-string">&quot;           %(    #@@@@@@@@@@@@@%*.             ./&amp;@@@@@@@@@@@@@/   .##\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   .&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%.\r\n&quot;</span><br>           <span class="hljs-string">&quot;                    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(\r\n&quot;</span><br>           <span class="hljs-string">&quot;                   &amp;@@@@@@@@@&amp;@@@@@@@@@@@@@@@@@@@@@&amp;@@@@@@@@@%\r\n&quot;</span><br>           <span class="hljs-string">&quot;                      /&amp;@@@/      .*&amp;@@@@@@@&amp;,.      (@@@&amp;/\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    %@@@@@@@#\r\n&quot;</span><br>           <span class="hljs-string">&quot;                                    .,,,,,,,.\r\n&quot;</span><br>           <span class="hljs-string">&quot;\r\n&quot;</span>;<br><span class="hljs-keyword">uint8_t</span> data[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">bool</span> flag=<span class="hljs-literal">false</span>;<br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_DMA_Init();<br>  MX_UART7_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>HAL_GPIO_WritePin(LD_RED_GPIO_Port,LD_RED_Pin,GPIO_PIN_SET);<br>HAL_GPIO_WritePin(LD_GREEN_GPIO_Port,LD_GREEN_Pin,GPIO_PIN_SET);<br>HAL_UART_Receive_DMA(&amp;huart7,data,<span class="hljs-number">1</span>);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>&#123;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>&#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;<br>  RCC_OscInitStruct.HSIState = RCC_HSI_ON;<br>  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief UART7 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 1 */</span><br>  huart7.Instance = UART7;<br>  huart7.Init.BaudRate = <span class="hljs-number">115200</span>;<br>  huart7.Init.WordLength = UART_WORDLENGTH_8B;<br>  huart7.Init.StopBits = UART_STOPBITS_1;<br>  huart7.Init.Parity = UART_PARITY_NONE;<br>  huart7.Init.Mode = UART_MODE_TX_RX;<br>  huart7.Init.HwFlowCtl = UART_HWCONTROL_NONE;<br>  huart7.Init.OverSampling = UART_OVERSAMPLING_16;<br>  <span class="hljs-keyword">if</span> (HAL_UART_Init(&amp;huart7) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/** </span><br><span class="hljs-comment">  * Enable DMA controller clock</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_DMA_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* DMA controller clock enable */</span><br>  __HAL_RCC_DMA1_CLK_ENABLE();<br><br>  <span class="hljs-comment">/* DMA interrupt init */</span><br>  <span class="hljs-comment">/* DMA1_Stream1_IRQn interrupt configuration */</span><br>  HAL_NVIC_SetPriority(DMA1_Stream1_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(DMA1_Stream1_IRQn);<br>  <span class="hljs-comment">/* DMA1_Stream3_IRQn interrupt configuration */</span><br>  HAL_NVIC_SetPriority(DMA1_Stream3_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(DMA1_Stream3_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br>  __HAL_RCC_GPIOF_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_GREEN_GPIO_Port, LD_GREEN_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_GREEN_Pin */</span><br>  GPIO_InitStruct.Pin = LD_GREEN_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_GREEN_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/* EXTI interrupt init*/</span><br>  HAL_NVIC_SetPriority(EXTI2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(EXTI2_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span>&#123;<br><span class="hljs-keyword">if</span>(GPIO_Pin == Button_Pin)&#123;<br>HAL_Delay(<span class="hljs-number">500</span>);<br>flag=<span class="hljs-literal">true</span>;<br>HAL_UART_Transmit_DMA(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)msg,<span class="hljs-built_in">strlen</span>(msg));<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_TxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span>&#123;<br><span class="hljs-keyword">if</span>(flag==<span class="hljs-literal">true</span>)&#123;<br>flag=<span class="hljs-literal">false</span>;<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>HAL_Delay(<span class="hljs-number">200</span>);<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>HAL_GPIO_TogglePin(LD_GREEN_GPIO_Port, LD_GREEN_Pin);<br>HAL_Delay(<span class="hljs-number">200</span>);<br>HAL_GPIO_TogglePin(LD_GREEN_GPIO_Port, LD_GREEN_Pin);<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_RxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span>&#123;<br>HAL_UART_Transmit_DMA(&amp;huart7,data,<span class="hljs-number">1</span>);<br>HAL_UART_Receive_DMA(&amp;huart7,data,<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br><span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h3 id="4-3-效果展示"><a href="#4-3-效果展示" class="headerlink" title="4.3 效果展示"></a>4.3 效果展示</h3><ul><li>因为按键回响已经包含了一键发送信息的功能，所以视频部分就只录了按键回响的效果</li></ul><iframe height=500 width=100% src="//player.bilibili.com/player.html?aid=97217251&cid=165950467&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进阶篇 III [UART &amp; USART]</title>
    <link href="/posts/b4c69a89/"/>
    <url>/posts/b4c69a89/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="1-0-什么是UART和USART？有什么区别嘛？"><a href="#1-0-什么是UART和USART？有什么区别嘛？" class="headerlink" title="1.0 什么是UART和USART？有什么区别嘛？"></a>1.0 什么是UART和USART？有什么区别嘛？</h2><h3 id="1-1-UART定义"><a href="#1-1-UART定义" class="headerlink" title="1.1 UART定义"></a>1.1 UART定义</h3><blockquote><p><strong>Universal Asynchronous Receiver/Transmitter</strong>：通用异步收发传输器，是一种串行异步收发协议，应用十分广泛。UART工作原理是将数据的二进制位一位一位的进行传输。在UART通讯协议中信号线上的状态位高电平代表’1’低电平代表’0’。当然两个设备使用UART串口通讯时，必须先约定好传输速率和一些数据位。分类属于并行传输，通常1字节数据的8位同时传输，结束后再继续传第2个字节，如同波浪一般，一波一波传输。</p></blockquote><h3 id="1-2-UART与USART的区别"><a href="#1-2-UART与USART的区别" class="headerlink" title="1.2 UART与USART的区别"></a>1.2 UART与USART的区别</h3><ul><li><strong>UART</strong></li></ul><p><img src="https://i.loli.net/2020/03/15/NMuPGgE5svz7Jjc.png" alt="UART.png"></p><p>​    从图上可以看出整个传输过程。首先，在没有数据传输任务的时候，互相之间都是高电平 ( 1 ) ，然后，在有传输任务的时候，有1.5字节宽的起始信号，然后开始传输真正的信号，结束任务后，再给1.5字节宽的结束信号，最后回归没有数据传输的高电平。</p><ul><li><strong>USART</strong> &lt;– Universal Synchronous/Asynchronous Receiver/Transmitter 通用同步异步接收发送器</li></ul><p><img src="https://i.loli.net/2020/03/15/dxVptRJaU821NGW.png" alt="USART.png"></p><p>​    USART是UART的升级版，区别在于多了CLK线，在CLK没有信号的时候，就表明没有数据传输任务，有CLK信号的时候，就是正在传输信号，并且CLK提供了时钟同步功能，效验也更精确。但在实际使用的时候，其实并不会感觉UART和USART有很大的区别，除非接触非常底层的东西。</p><h2 id="2-0-UART和USART在哪里？"><a href="#2-0-UART和USART在哪里？" class="headerlink" title="2.0 UART和USART在哪里？"></a>2.0 UART和USART在哪里？</h2><p><img src="https://i.loli.net/2020/03/15/BPUMDFvnOqmri1G.jpg" alt="RM A detail.jpg"></p><p><img src="https://i.loli.net/2020/03/15/KSXJQwLsVlCYocO.png" alt="UART detail.png"></p><ul><li><p><strong>UART</strong></p><ul><li>UART7</li></ul><blockquote><p>尽管大疆第一个图中标明的是USART7，但是其实只能使用异步通讯，也就是普通的UART。</p></blockquote><ul><li>UART8</li></ul><blockquote><p>尽管大疆第一个图中标明的是USART8，但是其实只能使用异步通讯，也就是普通的UART。</p></blockquote></li><li><p><strong>USART</strong></p><ul><li>USART6</li></ul></li><li><p><strong>DJI ON BOARD SDK</strong></p><ul><li>USART3</li></ul><blockquote><p>这个是大疆预留的官方接口，与一般的USART的接线不同，不能直接使用，也不推荐使用。</p></blockquote></li></ul><h2 id="3-0-UART和USART有啥用？"><a href="#3-0-UART和USART有啥用？" class="headerlink" title="3.0 UART和USART有啥用？"></a>3.0 UART和USART有啥用？</h2><ol><li><p><strong>与PC端通讯</strong></p><p>可以作为Debug的一种手段，或者监控数据流通的方法。</p></li><li><p><strong>与其他设备通讯</strong></p><p>比如两个MCU互相通讯，也就是作为主从机来使用。</p></li></ol><h2 id="4-0-UART和USART的两种不同使用模式"><a href="#4-0-UART和USART的两种不同使用模式" class="headerlink" title="4.0 UART和USART的两种不同使用模式"></a>4.0 UART和USART的两种不同使用模式</h2><h3 id="4-1-Polling"><a href="#4-1-Polling" class="headerlink" title="4.1 Polling"></a>4.1 Polling</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Transmit</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>huart</code>：指向UART引脚配置结构体</li><li><code>pData</code>：指向需要传输的字符串</li><li><code>Size</code>：传输数据的字节大小</li><li><code>Timeout</code>：最大等待完成时限，单位为毫秒，也可以用<code>HAL_MAX_DELAY</code>来直接无限等待</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输完成，返回<code>HAL_OK</code>；如果没有在时限内完成，返回<code>HAL_TIMEOUT</code>；如果在传输出错，返回<code>HAL_ERROR</code>；如果该UART正在被占用，返回<code>HAL_BUSY</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Receive</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>huart</code>：指向UART引脚配置结构体</li><li><code>pData</code>：指向需要传输的字符串</li><li><code>Size</code>：传输数据的字节大小</li><li><code>Timeout</code>：最大等待完成时限，单位为毫秒，也可以用<code>HAL_MAX_DELAY</code>来直接无限等待</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输完成，返回<code>HAL_OK</code>；如果没有在时限内完成，返回<code>HAL_TIMEOUT</code>；如果在传输出错，返回<code>HAL_ERROR</code>；如果该UART正在被占用，返回<code>HAL_BUSY</code></li></ul></li></ul><h3 id="4-2-Interrupt"><a href="#4-2-Interrupt" class="headerlink" title="4.2 Interrupt"></a>4.2 Interrupt</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Transmit_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>huart</code>：指向UART引脚配置结构体</li><li><code>pData</code>：指向需要传输的字符串</li><li><code>Size</code>：传输数据的字节大小</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输完成，返回<code>HAL_OK</code>；如果在传输出错，返回<code>HAL_ERROR</code>；如果该UART正在被占用，返回<code>HAL_BUSY</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Receive_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span>;<br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>huart</code>：指向UART引脚配置结构体</li><li><code>pData</code>：指向需要传输的字符串</li><li><code>Size</code>：传输数据的字节大小</li></ul></li><li><strong>返回值</strong><ul><li><code>HAL_StatusTypeDef</code>：如果传输完成，返回<code>HAL_OK</code>；如果在传输出错，返回<code>HAL_ERROR</code>；如果该UART正在被占用，返回<code>HAL_BUSY</code></li></ul></li></ul><blockquote><p>这里的函数并不是直接接收数据，而是表明开启UART的Interrupt模式<br>接收完数据后，该UART的Interrupt模式会自动关闭，需要再手动开启</p></blockquote><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_TxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span> </span>&#123;<br>......<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>HAL_UART_TxCpltCallback</code>函数</li><li>在该函数中填写UART发送结束后，需要执行的代码</li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_RxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span> </span>&#123;<br>......<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>HAL_UART_RxCpltCallback</code>函数</li><li>在该函数中填写UART接收结束后，需要执行的代码</li></ul><h2 id="5-0-练习项目"><a href="#5-0-练习项目" class="headerlink" title="5.0 练习项目"></a>5.0 练习项目</h2><h3 id="5-1-项目简介"><a href="#5-1-项目简介" class="headerlink" title="5.1 项目简介"></a>5.1 项目简介</h3><ul><li><strong>电脑控制LED灯</strong>：在电脑上按下r，反转红色LED状态，按下g，反转绿色LED状态，按下1～8，反转对应的LED1～8的状态，并且返回打印反转的LED灯号</li></ul><h3 id="5-2-芯片配置"><a href="#5-2-芯片配置" class="headerlink" title="5.2 芯片配置"></a>5.2 芯片配置</h3><ul><li><strong>芯片视角</strong></li></ul><p><img src="https://i.loli.net/2020/03/15/KOHEygm1h37IfXD.png" alt="Chip for RM03.png"></p><ul><li><strong>GPIO配置列表</strong></li></ul><p><img src="https://i.loli.net/2020/03/15/jgoq5FY9KJsQhIM.png" alt="GPIO for RM03.png"></p><ul><li><strong>NVIC配置列表</strong></li></ul><p><img src="https://i.loli.net/2020/03/15/ce6lLHWIy4KrJXj.png" alt="NVIC for RM03.png"></p><h3 id="5-3-项目代码"><a href="#5-3-项目代码" class="headerlink" title="5.3 项目代码"></a>5.3 项目代码</h3><ul><li><p>我只放了<code>main.c</code>，完整的工程文件可以在<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">这里</a>找到！</p></li><li><p><code>Src/main.c</code></p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;string.h&quot;</span></span><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br>UART_HandleTypeDef huart7;<br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><span class="hljs-keyword">char</span> readBuf[<span class="hljs-number">1</span>];<br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  MX_UART7_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br>  HAL_UART_Receive_IT(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)readBuf,<span class="hljs-number">1</span>);<br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;<br>  RCC_OscInitStruct.HSIState = RCC_HSI_ON;<br>  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief UART7 Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_UART7_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 1 */</span><br>  huart7.Instance = UART7;<br>  huart7.Init.BaudRate = <span class="hljs-number">115200</span>;<br>  huart7.Init.WordLength = UART_WORDLENGTH_8B;<br>  huart7.Init.StopBits = UART_STOPBITS_1;<br>  huart7.Init.Parity = UART_PARITY_NONE;<br>  huart7.Init.Mode = UART_MODE_TX_RX;<br>  huart7.Init.HwFlowCtl = UART_HWCONTROL_NONE;<br>  huart7.Init.OverSampling = UART_OVERSAMPLING_16;<br>  <span class="hljs-keyword">if</span> (HAL_UART_Init(&amp;huart7) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/* USER CODE BEGIN UART7_Init 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END UART7_Init 2 */</span><br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOG_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br>  __HAL_RCC_GPIOF_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(GPIOG, LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_GREEN_GPIO_Port, LD_GREEN_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pins : LD8_Pin LD7_Pin LD6_Pin LD5_Pin </span><br><span class="hljs-comment">                           LD4_Pin LD3_Pin LD2_Pin LD1_Pin */</span><br>  GPIO_InitStruct.Pin = LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(GPIOG, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_GREEN_Pin */</span><br>  GPIO_InitStruct.Pin = LD_GREEN_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_GREEN_GPIO_Port, &amp;GPIO_InitStruct);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_RxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *UartHandle)</span></span>&#123;<br><span class="hljs-keyword">switch</span>(readBuf[<span class="hljs-number">0</span>])&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;r&#x27;</span>:<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED_RED!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED_RED!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;g&#x27;</span>:<br>HAL_GPIO_TogglePin(LD_GREEN_GPIO_Port,LD_GREEN_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED_GREEN!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED_GREEN!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br>HAL_GPIO_TogglePin(LD1_GPIO_Port,LD1_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED1!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED1!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br>HAL_GPIO_TogglePin(LD2_GPIO_Port,LD2_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED2!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED2!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:<br>HAL_GPIO_TogglePin(LD3_GPIO_Port,LD3_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED3!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED3!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br>HAL_GPIO_TogglePin(LD4_GPIO_Port,LD4_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED4!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED4!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:<br>HAL_GPIO_TogglePin(LD5_GPIO_Port,LD5_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED5!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED5!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:<br>HAL_GPIO_TogglePin(LD6_GPIO_Port,LD6_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED6!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED6!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:<br>HAL_GPIO_TogglePin(LD7_GPIO_Port,LD7_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED7!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED7!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;8&#x27;</span>:<br>HAL_GPIO_TogglePin(LD8_GPIO_Port,LD8_Pin);<br>HAL_UART_Transmit(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">&quot;LED8!\r\n&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;LED8!\r\n&quot;</span>),HAL_MAX_DELAY);<br><span class="hljs-keyword">break</span>;<br>&#125;<br>HAL_UART_Receive_IT(&amp;huart7,(<span class="hljs-keyword">uint8_t</span>*)readBuf,<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h3 id="5-4-效果展示"><a href="#5-4-效果展示" class="headerlink" title="5.4 效果展示"></a>5.4 效果展示</h3><iframe height=500 width=100% src="//player.bilibili.com/player.html?aid=96401006&cid=164568509&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进阶篇 II [Interrupt]</title>
    <link href="/posts/ff6aca34/"/>
    <url>/posts/ff6aca34/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="1-0-什么是Interrupt？"><a href="#1-0-什么是Interrupt？" class="headerlink" title="1.0 什么是Interrupt？"></a>1.0 什么是Interrupt？</h2><blockquote><p>中断是指计算机运行过程中，出现某些意外情况需主机干预时，机器能自动停止正在运行的程序并转入处理新情况的程序，处理完毕后又返回原被暂停的程序继续运行。</p></blockquote><ul><li>Interrupt在STM32中大致分为两种，一种就是普通的Interrupt，由外部的外设来打断MCU，另一种名为Exception，是由内部的软件程序自行打断MCU。</li><li>要大致理解Interrupt，我们需要了解一下整个运行周期<ol><li>首先是，MCU接收到打断信号，但是还没有对该信号做出反应</li><li>然后，当MCU运行完当前的指令后，在fetch下一个指令前，停止当前程序，进入中断</li><li>保存被打断的程序的状态到系统栈，把发起中断的程序的预备状态载入到系统栈，进入该程序</li><li>执行发起中断的程序</li><li>完成后，再把被打断的程序的状态从系统栈加载回来，然后继续执行被打断的程序（<em>全当做无事发生.JPG</em>）</li></ol></li></ul><h2 id="2-0-为什么需要Interrupt？"><a href="#2-0-为什么需要Interrupt？" class="headerlink" title="2.0 为什么需要Interrupt？"></a>2.0 为什么需要Interrupt？</h2><ul><li>在将Interrupt前，必须提一下Polling。我打个比方，比如有个快递要今天送过来，但你现在正在做RoboMaster，而快递小哥也不知道你长啥样，如果在他来的时候没来人拿，那他就走了，包裹就没了（这个传来的数据是即时的，数据可不会等你）。</li><li>如果是Polling，那就是，你一直时不时盯着小区门口，看快递小哥来没来，结果可想而知，可能一整天都没做多少RoboMaster，甚至可能在做的时候，正好小哥来了又走了，结果快递也没拿到。</li><li>那有没有办法，可以既能够放心做RoboMaster，又不用担心错过快递呢？这就是Interrupt登场的时候了，方法也很简单，让快递小哥在快递送到的时候给你打个电话（中断信号），你放下手中的RoboMaster任务（被中断），去门口拿快递（执行中断程序），拿完后继续做RoboMaster（继续被中断的任务）就行了。</li></ul><h2 id="3-0-STM32内部实现线路-amp-NVIC"><a href="#3-0-STM32内部实现线路-amp-NVIC" class="headerlink" title="3.0 STM32内部实现线路 &amp; NVIC"></a>3.0 STM32内部实现线路 &amp; NVIC</h2><p><img src="https://i.loli.net/2020/03/14/s2KiBmwZfVlXhq4.png" alt="Interrupt Routine.png"></p><blockquote><p><strong>NVIC</strong>全称为Nested Vectored Interrupt Controller，是STM32专门划分独立出来的模块，专门负责Interrupt事宜，其中技术细节和使用细节非常冗杂，但是实际在RoboMaster中能使用到的部分却是比较简单的，所以本文也不展开细说。</p></blockquote><ul><li>从上图中我们可以看到，NVIC并不是和每个GPIO有单独的线路相连，而是将GPIO分组的，这里与GPIO自己的外设分组不同，并不是PA0，PA1，PA2……为一组，而是PA0，PB0，PC0……为一组，每组共用一根Interrupt信号线，而且更为复杂和迷惑的是，有些特殊情况，比如EXTI10和EXTI15居然在NVIC里面是合并的，但这不用担心，因为就算合并了，STM32也是能分辨具体是从那个组发出的（HAL_GPIO_EXTI_Callback函数能够区分是那个组）。你很可能也猜到了，NVIC是没法分辨每个组内部是那个引脚发出的Interrupt信号，所以在设置芯片的时候，每个组只能有一个引脚能够使用Interrupt。</li></ul><h2 id="4-0-Interrupt的生命周期"><a href="#4-0-Interrupt的生命周期" class="headerlink" title="4.0 Interrupt的生命周期"></a>4.0 Interrupt的生命周期</h2><ul><li><p>要谈这个，避免不了要讲讲Priority 优先级</p><blockquote><p>为使系统能及时响应并处理发生的所有中断，系统根据引起中断事件的重要性和紧迫程度，硬件将中断源分为若干个级别，称作中断优先级。</p><p>在实际系统中，常常遇到多个中断源同时请求中断的情况，这时MCU必须确定首先为哪一个中断源服务，以及服务的次序。解决的方法是中断优先排队，即根据中断源请求的轻重缓急，排好中断处理的优先次序即优先级( Priority )，又称优先权，先响应优先级最高的中断请求。另外，当MCU正在处理某一中断时，要能响应另一个优先级更高的中断请求，而屏蔽掉同级或较低级的中断请求，形成中断嵌套。</p></blockquote></li><li><p>中断优先级原则</p><ol><li>CPU首先响应高优先级的中断请求；</li><li>如果优先级相同，MCU按查询次序响应排在前面的中断；</li><li>正在进行的中断过程不能被新的同级或低优先级的中断请求所中断；</li><li>正在进行的低优先级中断过程，能被高优先级中断请求所中断。</li></ol></li><li><p>而在STM32中，又有两种不同的优先级</p><ul><li>Preempt Priority<ul><li>也就是我们最常说的常用的Priority，优先级小，越优先，比如优先级如果为负，那就是系统自己的系统中断，比任何用户代码的优先级都高，而用户能够设置的最高的优先级就是0级，其次是1级，2级……</li></ul></li><li>Subpriority<ul><li>主要针对当Preempt Priority相同的情况。</li><li>比如，当某个0级程序正在运行时，有1个2级程序发出中断信号，但是因为2级程序的优先级比0级低，所以被Pending 延迟处理了，在0级程序还没运行完的时候，又有一个2级程序发出中断信号，因为同样的原因，也被Pending了，问题来了，当0级程序处理完后，请问先执行那个2级程序呢？当然是，子优先级小的那个。</li></ul></li></ul></li></ul><h2 id="5-0-如何使用Interrupt"><a href="#5-0-如何使用Interrupt" class="headerlink" title="5.0 如何使用Interrupt"></a>5.0 如何使用Interrupt</h2><ul><li>首先是要在配置芯片的时候，给引脚选择EXTI模式</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span>&#123;<br>......<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>在写代码的时候，在<code>main.c</code>中创建<code>HAL_GPIO_EXTI_Callback</code>函数</li><li>在该函数中填写如果被中断，需要执行的代码</li></ul><blockquote><p>在<code>&lt;项目&gt;/Drivers/STM32F4xx_HAL_Driver/Src</code>的<code>stm32f4xx_hal_gpio.c</code>文件中，我们可以看到其定义</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Prevent unused argument(s) compilation warning */</span><br>  UNUSED(GPIO_Pin);<br>  <span class="hljs-comment">/* <span class="hljs-doctag">NOTE:</span> This function Should not be modified, when the callback is needed,</span><br><span class="hljs-comment">           the HAL_GPIO_EXTI_Callback could be implemented in the user file</span><br><span class="hljs-comment">   */</span><br>&#125;<br></code></pre></td></tr></table></figure><p>这里的<code>__weak</code>指明了，该函数如果没被用户创建，就使用上面的代码被默认创建，而如果用户在<code>main.c</code>中自主创建该函数，则用户创建的函数覆盖默认定义的函数。</p></blockquote><ul><li>值得注意的一点是，<code>HAL_GPIO_EXTI_Callback</code>中的<code>uint16_t GPIO_Pin</code>是给用户说明了发出中断信号的是哪个组，正如3.0里面所说，就算EXTI10和EXTI15在NVIC里面是合并的，这个参数也能区分到底是EXTI10还是EXTI15发出的信号，所以不用担心合并后无法区分的问题。</li></ul><h2 id="6-0-练习项目"><a href="#6-0-练习项目" class="headerlink" title="6.0 练习项目"></a>6.0 练习项目</h2><h3 id="6-1-项目简介"><a href="#6-1-项目简介" class="headerlink" title="6.1 项目简介"></a>6.1 项目简介</h3><ul><li>与<code>从STM32开始的RoboMaster生活：进阶篇 I [GPIO]</code>里面的项目相同，但是用Interrupt来实现，<a href="https://alchemicronin.github.io/posts/4b155d4.html">链接地址</a></li></ul><h3 id="6-2-芯片配置"><a href="#6-2-芯片配置" class="headerlink" title="6.2 芯片配置"></a>6.2 芯片配置</h3><ul><li><strong>芯片视角</strong></li></ul><p><img src="https://i.loli.net/2020/03/11/cbXkZP7GRwnOVfF.png" alt="Chip.png"></p><ul><li><strong>GPIO配置列表</strong></li></ul><p><img src="https://i.loli.net/2020/03/14/CQUVdjuSPHM961m.png" alt="GPIO for RM02.png"></p><ul><li><strong>NVIC配置列表</strong></li></ul><p><img src="https://i.loli.net/2020/03/14/HzUVJLd8gQxs5n3.png" alt="NVIC for RM02.png"></p><h3 id="6-3-项目代码"><a href="#6-3-项目代码" class="headerlink" title="6.3 项目代码"></a>6.3 项目代码</h3><ul><li><p>我只放了<code>main.c</code>，完整的工程文件可以在<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">这里</a>找到！</p></li><li><p><code>Src/main.c</code></p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;<br>  RCC_OscInitStruct.HSIState = RCC_HSI_ON;<br>  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOG_CLK_ENABLE();<br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br>  __HAL_RCC_GPIOF_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(GPIOG, LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_GREEN_GPIO_Port, LD_GREEN_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pins : LD8_Pin LD7_Pin LD6_Pin LD5_Pin </span><br><span class="hljs-comment">                           LD4_Pin LD3_Pin LD2_Pin LD1_Pin */</span><br>  GPIO_InitStruct.Pin = LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(GPIOG, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_GREEN_Pin */</span><br>  GPIO_InitStruct.Pin = LD_GREEN_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_GREEN_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/* EXTI interrupt init*/</span><br>  HAL_NVIC_SetPriority(EXTI2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  HAL_NVIC_EnableIRQ(EXTI2_IRQn);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span> </span>&#123;<br><span class="hljs-keyword">if</span>(GPIO_Pin == Button_Pin)&#123;<br>HAL_Delay(<span class="hljs-number">500</span>);<br>HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD_GREEN_GPIO_Port,LD_GREEN_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD1_GPIO_Port,LD1_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD2_GPIO_Port,LD2_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD3_GPIO_Port,LD3_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD4_GPIO_Port,LD4_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD5_GPIO_Port,LD5_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD6_GPIO_Port,LD6_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD7_GPIO_Port,LD7_Pin);<br>HAL_Delay(<span class="hljs-number">100</span>);<br>HAL_GPIO_TogglePin(LD8_GPIO_Port,LD8_Pin);<br>&#125;<br>&#125;<br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h3 id="6-4-效果展示"><a href="#6-4-效果展示" class="headerlink" title="6.4 效果展示"></a>6.4 效果展示</h3><ul><li>效果与<code>从STM32开始的RoboMaster生活：进阶篇 I [GPIO]</code>里面展示的相同，<a href="https://alchemicronin.github.io/posts/4b155d4.html">链接地址</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>进阶篇 I [GPIO]</title>
    <link href="/posts/4b155d4/"/>
    <url>/posts/4b155d4/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="0-0-一点点声明"><a href="#0-0-一点点声明" class="headerlink" title="0.0 一点点声明"></a>0.0 一点点声明</h2><ul><li>本文以及以后的所有属于RoboMaster主题STM32系列的文章，均以<strong>RoboMaster开发板A型</strong>为说明和测试目标，其芯片代号为<strong>STM32F427IIHx</strong>，如果您的芯片代号不同，则不能直接使用本教程代码和引脚配置，请酌情修改！</li></ul><h2 id="1-0-什么是GPIO？"><a href="#1-0-什么是GPIO？" class="headerlink" title="1.0 什么是GPIO？"></a>1.0 什么是GPIO？</h2><ul><li>General Purpose Input Output  通用输入/输出端口</li></ul><blockquote><p>GPIO接脚可以供使用者由程控自由使用，PIN脚依现实考量可作为通用输入 ( GPI ) 或通用输出 ( GPO ) 或通用输入与输出 ( GPIO ) 。在嵌入式系统中，经常需要控制许多结构简单的外部设备或者电路，这些设备有的需要通过CPU控制，有的需要CPU提供输入信号。对设备的控制，使用传统的串口或者并口就显得比较复杂，所以，在嵌入式微控制器上通常提供了一种“通用可编程I/O端口”，也就是GPIO。一个GPIO端口至少需要两个寄存器，一个做控制用的“通用IO端口控制寄存器”，还有一个是存放数据的“通用I/O端口数据寄存器”。数据寄存器的每一位是和GPIO的硬件引脚对应的，而数据的传递方向是通过控制寄存器设置的，通过控制寄存器可以设置每一位引脚的数据流向。</p></blockquote><h2 id="2-0-GPIO在哪里？"><a href="#2-0-GPIO在哪里？" class="headerlink" title="2.0 GPIO在哪里？"></a>2.0 GPIO在哪里？</h2><ol><li>在开发板A型中，提供了18个用户自定义GPIO</li></ol><p><img src="https://i.loli.net/2020/03/11/3HRykqAVfwa2ng5.jpg" alt="RoboMaster-_A_-11.jpg"></p><p>​    上图中，26即为GPIO，位于开发板A型的中间位置</p><p><img src="https://i.loli.net/2020/03/11/2CW5rYOqiARvo9d.png" alt="GPIO Pin.png"></p><p>​    这是GPIO的具体引脚图，在配置芯片引脚时请务必核实引脚号是否正确</p><ol><li>RoboMaster同样也非常体贴地预先将一些GPIO接到了用户自定义LED上，在2.1图中的位置为10和18，10的LED×8皆为绿色，而18的LED×2则是一绿一红，在用户自定义按键附近。只能设置为GPIO_Output模式。</li></ol><p><img src="https://i.loli.net/2020/03/11/fgDRBQVn6vHyx9J.png" alt="GPIO LED.png"></p><ol><li>用户自定义按键（白色按键，黑色按键是STM32重启按键）。可以设置为GPIO_Input模式，或者GPIO_EXTI2模式（用于Interrupt 中断，现在不用理解这个，下个教程会讲）</li></ol><p><img src="https://i.loli.net/2020/03/11/I89YxqeuBpKRQLT.png" alt="GPIO Button.png"></p><h2 id="3-0-如何使用GPIO？"><a href="#3-0-如何使用GPIO？" class="headerlink" title="3.0 如何使用GPIO？"></a>3.0 如何使用GPIO？</h2><blockquote><p>在下文中，几乎任何HAL函数的参数都需要外设和引脚，但是在比如Arduino的平台上，只需要引脚即可。其原因在于，对于STM32，一个外设可以连接众多引脚，在配置的时候，这些引脚都使用同一份外设配置，但是实际使用的时候，可以分别控制。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">GPIO_PinState <span class="hljs-title">HAL_GPIO_ReadPin</span><span class="hljs-params">(GPIO_TypeDef *GPIOx, <span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span><br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>GPIOx</code>：想要读取的GPIO所属的外设</li><li><code>GPIO_Pin</code>：想要读取的GPIO的引脚</li></ul></li><li><strong>返回值</strong><ul><li><code>GPIO_PinState</code>：当I/O为低 ( 0 ) 时，返回<code>GPIO_PIN_RESET</code>；当I/O为高 ( 1 ) 时，返回<code>GPIO_PIN_SET</code></li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_WritePin</span><span class="hljs-params">(GPIO_TypeDef *GPIOx, <span class="hljs-keyword">uint16_t</span> GPIO_Pin, GPIO_PinState PinState)</span></span><br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>GPIOx</code>：想要写入的GPIO所属的外设</li><li><code>GPIO_Pin</code>：想要写入的GPIO的引脚</li><li><code>PinState</code>：想要写入的GPIO状态【<code>GPIO_PIN_RESET</code> / <code>GPIO_PIN_SET</code>】</li></ul></li></ul><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_TogglePin</span><span class="hljs-params">(GPIO_TypeDef *GPIOx, <span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span><br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>GPIOx</code>：想要反转的GPIO所属的外设</li><li><code>GPIO_Pin</code>：想要反转的GPIO的引脚</li></ul></li></ul><blockquote><p>如果GPIO状态为<code>GPIO_PIN_RESET</code>，则改为<code>GPIO_PIN_SET</code>；<br>如果GPIO状态为<code>GPIO_PIN_SET</code>，则改为<code>GPIO_PIN_RESET</code>。</p></blockquote><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_GPIO_LockPin</span><span class="hljs-params">(GPIO_TypeDef *GPIOx, <span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span></span><br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>GPIOx</code>：想要锁死的GPIO所属的外设</li><li><code>GPIO_Pin</code>：想要锁死的GPIO的引脚</li></ul></li></ul><blockquote><p>锁死的是该GPIO的配置，而不是状态。任何尝试修改其配置的操作都会失败，除非重置GPIO。</p></blockquote><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_DeInit</span><span class="hljs-params">(GPIO_TypeDef *GPIOx, <span class="hljs-keyword">uint32_t</span> GPIO_Pin)</span></span><br></code></pre></td></tr></table></figure><ul><li><strong>参数</strong><ul><li><code>GPIOx</code>：想要重置的GPIO所属的外设</li><li><code>GPIO_Pin</code>：想要重置的GPIO的引脚</li></ul></li></ul><blockquote><p>重置GPIO到默认的配置（Input Floating模式）。用于当我们不再使用某个外设时，节约电量，避免额外的消耗。</p></blockquote><h2 id="4-0-练习项目"><a href="#4-0-练习项目" class="headerlink" title="4.0 练习项目"></a>4.0 练习项目</h2><h3 id="4-1-项目简介"><a href="#4-1-项目简介" class="headerlink" title="4.1 项目简介"></a>4.1 项目简介</h3><ul><li><strong>按键版流水灯</strong>：按下白色按键后，依次让自带的LED灯按顺序亮起，或者依次熄灭</li></ul><h3 id="4-2-芯片配置"><a href="#4-2-芯片配置" class="headerlink" title="4.2 芯片配置"></a>4.2 芯片配置</h3><ul><li><strong>芯片视角</strong></li></ul><p><img src="https://i.loli.net/2020/03/11/cbXkZP7GRwnOVfF.png" alt="Chip.png"></p><ul><li><strong>GPIO配置列表</strong></li></ul><p><img src="https://i.loli.net/2020/03/11/NUafpOxlEuqTJCS.png" alt="Config.png"></p><h3 id="4-3-项目代码"><a href="#4-3-项目代码" class="headerlink" title="4.3 项目代码"></a>4.3 项目代码</h3><ul><li><p><strong>一点有必要的说明</strong>：</p><ul><li><p>主要看<code>Src/main.c</code>中<code>int main(void)</code>函数里<code>while (1)</code>部分的代码，其余部分没看懂不用担心，不是本篇章的重点</p></li><li><p>我只放了<code>main.c</code>，完整的工程文件可以在<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">这里</a>找到！</p></li><li><p>完整的工程目录</p></li></ul></li></ul><p><img src="https://i.loli.net/2020/03/14/UIlsO6y1tmnGhRi.png" alt="RM01Tree.png"></p><ul><li><code>Src/main.c</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* USER CODE BEGIN Header */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @file           : main.c</span><br><span class="hljs-comment">  * @brief          : Main program body</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  * @attention</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2020 STMicroelectronics.</span><br><span class="hljs-comment">  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * This software component is licensed by ST under BSD 3-Clause license,</span><br><span class="hljs-comment">  * the &quot;License&quot;; You may not use this file except in compliance with the</span><br><span class="hljs-comment">  * License. You may obtain a copy of the License at:</span><br><span class="hljs-comment">  *                        opensource.org/licenses/BSD-3-Clause</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  ******************************************************************************</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* USER CODE END Header */</span><br><br><span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;main.h&quot;</span></span><br><br><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN Includes */</span><br><br><span class="hljs-comment">/* USER CODE END Includes */</span><br><br><span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PTD */</span><br><br><span class="hljs-comment">/* USER CODE END PTD */</span><br><br><span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PD */</span><br><span class="hljs-comment">/* USER CODE END PD */</span><br><br><span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN PM */</span><br><br><span class="hljs-comment">/* USER CODE END PM */</span><br><br><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span><br><br><span class="hljs-comment">/* USER CODE BEGIN PV */</span><br><br><span class="hljs-comment">/* USER CODE END PV */</span><br><br><span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-comment">/* USER CODE BEGIN PFP */</span><br><br><span class="hljs-comment">/* USER CODE END PFP */</span><br><br><span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span><br><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><br><br><span class="hljs-comment">/* USER CODE END 0 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  The application entry point.</span><br><span class="hljs-comment">  * @retval int</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 1 */</span><br><br>  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span><br><br>  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br>  HAL_Init();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN Init */</span><br><br>  <span class="hljs-comment">/* USER CODE END Init */</span><br><br>  <span class="hljs-comment">/* Configure the system clock */</span><br>  SystemClock_Config();<br><br>  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span><br><br>  <span class="hljs-comment">/* USER CODE END SysInit */</span><br><br>  <span class="hljs-comment">/* Initialize all configured peripherals */</span><br>  MX_GPIO_Init();<br>  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span><br><br>  <span class="hljs-comment">/* USER CODE END 2 */</span><br><br>  <span class="hljs-comment">/* Infinite loop */</span><br>  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>  <span class="hljs-keyword">if</span>(HAL_GPIO_ReadPin(Button_GPIO_Port,Button_Pin) == GPIO_PIN_SET)&#123;<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  HAL_GPIO_TogglePin(LD_RED_GPIO_Port,LD_RED_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD_GREEN_GPIO_Port,LD_GREEN_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD1_GPIO_Port,LD1_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD2_GPIO_Port,LD2_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD3_GPIO_Port,LD3_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD4_GPIO_Port,LD4_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD5_GPIO_Port,LD5_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD6_GPIO_Port,LD6_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD7_GPIO_Port,LD7_Pin);<br>  HAL_Delay(<span class="hljs-number">100</span>);<br>  HAL_GPIO_TogglePin(LD8_GPIO_Port,LD8_Pin);<br>  &#125;<br>    <span class="hljs-comment">/* USER CODE END WHILE */</span><br><br>    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span><br>  &#125;<br>  <span class="hljs-comment">/* USER CODE END 3 */</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief System Clock Configuration</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br>  RCC_ClkInitTypeDef RCC_ClkInitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/** Configure the main internal regulator output voltage </span><br><span class="hljs-comment">  */</span><br>  __HAL_RCC_PWR_CLK_ENABLE();<br>  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE3);<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;<br>  RCC_OscInitStruct.HSIState = RCC_HSI_ON;<br>  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;<br>  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;<br>  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks </span><br><span class="hljs-comment">  */</span><br>  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK<br>                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;<br>  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;<br>  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;<br>  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;<br>  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;<br><br>  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)<br>  &#123;<br>    Error_Handler();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief GPIO Initialization Function</span><br><span class="hljs-comment">  * @param None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MX_GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="hljs-number">0</span>&#125;;<br><br>  <span class="hljs-comment">/* GPIO Ports Clock Enable */</span><br>  __HAL_RCC_GPIOG_CLK_ENABLE();<br>  __HAL_RCC_GPIOB_CLK_ENABLE();<br>  __HAL_RCC_GPIOE_CLK_ENABLE();<br>  __HAL_RCC_GPIOF_CLK_ENABLE();<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(GPIOG, LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_RED_GPIO_Port, LD_RED_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pin Output Level */</span><br>  HAL_GPIO_WritePin(LD_GREEN_GPIO_Port, LD_GREEN_Pin, GPIO_PIN_RESET);<br><br>  <span class="hljs-comment">/*Configure GPIO pins : LD8_Pin LD7_Pin LD6_Pin LD5_Pin </span><br><span class="hljs-comment">                           LD4_Pin LD3_Pin LD2_Pin LD1_Pin */</span><br>  GPIO_InitStruct.Pin = LD8_Pin|LD7_Pin|LD6_Pin|LD5_Pin <br>                          |LD4_Pin|LD3_Pin|LD2_Pin|LD1_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(GPIOG, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : Button_Pin */</span><br>  GPIO_InitStruct.Pin = Button_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  HAL_GPIO_Init(Button_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_RED_Pin */</span><br>  GPIO_InitStruct.Pin = LD_RED_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_RED_GPIO_Port, &amp;GPIO_InitStruct);<br><br>  <span class="hljs-comment">/*Configure GPIO pin : LD_GREEN_Pin */</span><br>  GPIO_InitStruct.Pin = LD_GREEN_Pin;<br>  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;<br>  GPIO_InitStruct.Pull = GPIO_NOPULL;<br>  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;<br>  HAL_GPIO_Init(LD_GREEN_GPIO_Port, &amp;GPIO_InitStruct);<br><br>&#125;<br><br><span class="hljs-comment">/* USER CODE BEGIN 4 */</span><br><br><span class="hljs-comment">/* USER CODE END 4 */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function is executed in case of error occurrence.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span><br><br>  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Reports the name of the source file and the source line number</span><br><span class="hljs-comment">  *         where the assert_param error has occurred.</span><br><span class="hljs-comment">  * @param  file: pointer to the source file name</span><br><span class="hljs-comment">  * @param  line: assert_param error line source number</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span><br>  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,</span><br><span class="hljs-comment">     tex: printf(&quot;Wrong parameters value: file %s on line %d\r\n&quot;, file, line) */</span><br>  <span class="hljs-comment">/* USER CODE END 6 */</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span><br><br><span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span><br><br></code></pre></td></tr></table></figure><h3 id="4-4-效果展示"><a href="#4-4-效果展示" class="headerlink" title="4.4 效果展示"></a>4.4 效果展示</h3><iframe height=500 width=100% src="//player.bilibili.com/player.html?aid=95347547&cid=162774978&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从STM32开始的RoboMaster生活：入门篇</title>
    <link href="/posts/e8b315d3/"/>
    <url>/posts/e8b315d3/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=26625301&auto=1&height=66"></iframe><p><strong>项目&amp;教程仓库</strong>：<a href="https://github.com/AlchemicRonin/-STM32-RoboMaster-">-STM32-RoboMaster-</a></p><hr><h2 id="1-0-STM32是什么"><a href="#1-0-STM32是什么" class="headerlink" title="1.0 STM32是什么"></a>1.0 STM32是什么</h2><h3 id="1-1-定义"><a href="#1-1-定义" class="headerlink" title="1.1 定义"></a>1.1 定义</h3><p><img src="https://i.loli.net/2020/03/09/DcPTBMuVNs9d4QF.jpg" alt="STM32.jpg"></p><ul><li><strong>ST + M + 32 = STM32</strong></li></ul><blockquote><p><strong>ST</strong>: SGS-Thomson 法意半导体</p><p><strong>M</strong>: Microelectronics 微控制器 <del>微处理器</del></p><p><strong>32</strong>: 32位</p></blockquote><blockquote><p>–&gt; <strong>STM32</strong>: 法意半导体所设计制造的32位微控制器系列产品</p></blockquote><h3 id="1-2-背景"><a href="#1-2-背景" class="headerlink" title="1.2 背景"></a>1.2 背景</h3><ul><li><strong>RISC –&gt; ARM –&gt; Cortex-M –&gt; STM32</strong></li></ul><blockquote><p>精简指令集 <strong>RISC</strong>: Reduce Instruction Set Computer</p><p>复杂指令集 CISC ：Complex Instruction Set Computer</p><p><img src="https://i.loli.net/2020/03/09/kqxNz1BS89lMdCa.png" alt="ARM.png"></p><p>精简指令集并非简单的比复杂指令集简单，而是其高效快速便宜，强调效率和价格，所以，常见的嵌入式设备，手机等等均为精简指令集。接下来的ARM架构就是基于精简指令集的。</p><p><img src="https://i.loli.net/2020/03/09/zTOGClxud7ZYAbm.jpg" alt="x86.jpg"></p><p>而复杂指令集，强调指令的多样性和复杂性，常见于电脑和大型服务器，以往的Intel英特尔的x86 (IA-32) ，新起的x86-64 (AMD64) 均为复杂指令集。</p></blockquote><blockquote><p><strong>ARM</strong>:  Advanced RISC Machines 高级精简指令集机器</p><p>ARM处理器是英国Acorn有限公司设计的低功耗成本的第一款RISC微处理器。但实际上，真正的ARM是一个32位处理器框架，而Acorn自己从不生产处理器，而是搞处理器框架授权的，怎么实现其架构完全取决于客户自己，所以很多时候同为ARM架构的厂家互相之间的代码却不能直接套用。STM就是Acorn授权客户之一，所以STM大部分产品都是基于ARM架构的。</p><p>ARM处理器的三大特点是：耗电少功能强，16位/32位双指令集，和合作伙伴众多（所有手机都是ARM架构）。</p></blockquote><blockquote><p>目前ARM分为三大系列：Cortex-A，Cortex-R，<strong>Cortex-M</strong></p><p><code>Cortex-A (Application)</code>: 适用于应用领域，支持 ARM和Thumb指令集，并支持虚拟地址和内存管</p><p><code>Cortex-R (Real-Time)</code>: 适用于高实时性领域，支持 ARM和Thumb指令集，只支持物理地址，并支持内存管理。</p><p><code>Cortex-M (eMbedded)</code>: 适用于微处理器领域，只支持Thumb指令集。</p><p>为我们接下来要讲的就是STM32系列就是基于Cortex-M架构的</p></blockquote><h3 id="1-3-系列"><a href="#1-3-系列" class="headerlink" title="1.3 系列"></a>1.3 系列</h3><p><img src="https://i.loli.net/2020/03/09/3TeA9kvpCFyiOVc.jpg" alt="STM full.jpg"></p><p>整个STM家族是非常庞大而繁杂的，当然，这里要是全部讨论比较一番，估计已经可以出几本书了www，所以，我们主要分析一下STM32系列下的MCU微控制器（左边的MPU才是微处理器）</p><p><img src="https://i.loli.net/2020/03/09/4XJ6CSONHD2TQZj.png" alt="STM full detail.png"></p><p><img src="https://i.loli.net/2020/03/09/34EWqTy8uSboszk.png" alt="STM detail.png"></p><p>我来简单概括一下，一共有4个分支</p><ol><li><strong>High-performance MCU</strong>: 高性能微处理器，是以CPU高度集成和多媒体应用为目的开发的，基于Cortex-M3/4/7，频率从120MHz (F2) 到400MHz (H7) 不等。该系列均配备ART^TM^加速器，能够从Flash中0延迟加载数据。</li><li><strong>Mainstream MCU</strong>: 主流微控制器，是专门为对价格比较挑剔的产品开发的，成本要求甚至苛刻到一片1$以下，空间也非常受限。在这个类别下，有基于Cortex-M0/3/4框架的，频率从48MHz (F0) 到72MHz (F1/F3) 不等。</li><li><strong>Wireless MCU</strong>: 无线微控制器，是STM32微控制器家族新的双核成员，集成2.4GHz的通讯模块，可以用于无线和蓝牙应用。其中基于Cortex-M0+的核心（网络处理器）是用于通讯管理，而另外一个基于Cortex-M4的核心（应用处理器）是用于主要的嵌入式开发。</li><li><strong>Ultra Low-Power MCU</strong>: 超低功耗微控制器，该系列为低功耗应用而生，用于电池驱动的设备，从整体降低电池消耗来延迟电池使用时间。在这个系列中，我们可以找到针对低价客户的基于Cortex-M0的微控制器，和基于Cortex-M4F的带有<em>动态电压调节 (DVS)</em> 功能的微控制器，能够根据频率变化来最优化内部CPU电压。</li></ol><p>如果各位需要购入，请务必详细阅读每个微控制器的详细数据，再根据项目要求来谨慎购买。推荐阅读：<a href="https://www.st.com/content/ccc/resource/sales_and_marketing/promotional_material/brochure/f0/93/da/5c/6b/31/4a/96/brstm32.pdf/files/brstm32.pdf/jcr:content/translations/en.brstm32.pdf">官方选材手册</a>。</p><h2 id="2-0-为什么选择STM32，抛弃Arduino？"><a href="#2-0-为什么选择STM32，抛弃Arduino？" class="headerlink" title="2.0 为什么选择STM32，抛弃Arduino？"></a>2.0 为什么选择STM32，抛弃Arduino？</h2><p>这是个艰难的选择，我们有无数的理由选择Arduino，放弃STM32，比如Arduino简单易学开发迅速支持强大BUG少，STM32复杂难懂开发缓慢支持受限BUG多，但是很多时候我们不得不承认，现实就是，几乎没有真的用Arduino做产品开发的，而最流行的专业的嵌入式开发，STM32就是绕不开的一条路。说白了：<strong>Arduino就是玩具，给兴趣爱好者玩的；STM32才是真正的嵌入式，远远比Arduino强大几个量级，是开发电子产品的必备技能</strong>。</p><p>下面我们再详细的列举一下抛弃Arduino，选择STM32的理由</p><ol><li><p>STM32在硬件上比Arduino更强大</p><p><img src="https://i.loli.net/2020/03/09/Lc9T3pXQfuAyBPO.png" alt="STMvsArduino.png"></p><p>我们可以看出，STM32中常用的F103和Arduino中常用的ATmega328相比，在各种硬件指标上彻底完爆，甚至在价格上STM32还比Arduino便宜一点点？！(震惊)</p></li><li><p>STM32有专门的低功耗系列，电量消耗是产品最重要的指标之一，消耗甚至比Arduino Nano在深度睡眠模式还要低很多？！(二次震惊)</p></li><li><p>没有高级封装的函数供你使用，也许很多人会说，这不正是STM32的缺陷吗？Arduino正是因为有这些函数，所以开发迅速，简单吗？是这样，没错。但是，正是因为STM32足够底层，足够复杂，所以相对应的，把所有的控制权和自由都交给了工程师，可以做到所有Arduino能做到的事情和其所有不能做到的事情。这和“为什么搞前端后端开发的为啥爱用Linux不用Windows呢？”一样，要举个例子说明的话，请问，您觉得建设帝国大厦，是用乐高呢？还是钢筋水泥呢？www</p></li><li><p>可以跑真正的操作系统，比如FreeRTOS，多任务处理不再是梦？！(三回啊三回)</p></li><li><p>专业应用的广泛。STM32甚至可以直接跑AI，而Arduino不行（只能外接模块），STM32可以运行IoT系统，而Arduino虽然可以，但是是没法发挥IoT真正的实力的。</p></li><li><p>STM32是ARM下的一个分支，而所有的手机芯片基本都是ARM架构的，所以学会STM32对ARM下的其他分支开发，比如手机硬件开发等，都大有帮助，或者说是入门的必经之路</p></li><li><p><strong>“我是搞STM32开发的”听起来就很帅～～，而“我是玩Arduino项目的”则有些黯然失色</strong>。</p></li></ol><h2 id="3-0-STM32上手难度如何？"><a href="#3-0-STM32上手难度如何？" class="headerlink" title="3.0 STM32上手难度如何？"></a>3.0 STM32上手难度如何？</h2><p>这部分我就直说了吧，难，非常难，资料少不说，数不尽的坑一定要自己全部踩过一遍才能熟悉开发环境。光是配置开发环境就花了我2周，就算要想做个最简单的LED流水灯，点亮个LED，也是要深入理解STM32的各种底层，芯片引脚设置才行的，这也是新手最劝退的地方，你能想象，至少要枯燥无聊地花一周阅读300页的手册才能点亮一个简单的LED吗？是不是有点兴致全无？但是，一但越过这个门槛，你就会打开STM32的大门，真正进入嵌入式的殿堂，深入地理解计算机内部的任何细节，无论软件还是硬件上的，你将会感觉自己身处一片智慧的汪洋什么都不懂，但同时又即将成为这片汪洋的新君主，感觉能通过计算机做到任何事情！！！</p><h2 id="4-0-RoboMaster是什么？"><a href="#4-0-RoboMaster是什么？" class="headerlink" title="4.0 RoboMaster是什么？"></a>4.0 RoboMaster是什么？</h2><p>言归正题，肯定很多人读到这里，会疑惑，“这该死的家伙搞了这么一堆东西，先推销STM32，又使劲劝退，结果半天了连RoboMaster都没解释一下”。别慌，诸位客官，这不正要讲嘛</p><blockquote><p>全国大学生机器人大赛RoboMaster 机甲大师赛是由共青团中央、全国学联、深圳市人民政府联合主办，DJI 大疆创新发起并承办……</p></blockquote><p>哦我的天哪，无聊死了，我们还是直接一点，看看实际的比赛</p><iframe height=500 width=610 src="//player.bilibili.com/player.html?aid=76130870&cid=130230429&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><h2 id="5-0-RoboMaster仓库-amp-教程安排"><a href="#5-0-RoboMaster仓库-amp-教程安排" class="headerlink" title="5.0 RoboMaster仓库 &amp; 教程安排"></a>5.0 RoboMaster仓库 &amp; 教程安排</h2><p><img src="https://i.loli.net/2020/03/09/XwhsFln6xEMbTe4.png" alt="iRM.png"></p><p><strong>UIUC RoboMaster 校队仓库</strong>：<a href="https://github.com/illini-robomaster">Illini RoboMaster</a></p><p>我首先会写个入门篇，介绍一下STM32和RoboMaster（就是本片内容），然后进入进阶篇，详细说明STM32所有的外设，并给出代码和配置，最后在比赛篇带着各位逐行解析上面仓库里面的所有代码，并说明实际硬件的一些配置和使用事项，比赛篇我会从<a href="https://github.com/illini-robomaster/iRM_Embedded_2018">iRM_Embedded_2018</a>开始讲起，本教程暂且不谈AI图像处理和机械设计，专注于STM32的入门事宜。</p><h2 id="6-0-你所需要的知识储备"><a href="#6-0-你所需要的知识储备" class="headerlink" title="6.0 你所需要的知识储备"></a>6.0 你所需要的知识储备</h2><p>在阅读后面教程前，需要一定的基础和技能，如果在一下列表中有你不会或者没有达到要求标准的知识，请按照下文对应的链接来阅读对应资料的对应章节，并练习直至达到全部要求标准，请务必不要嫌麻烦。以下书籍作者皆研读过，所以不用担心浪费时间，勾画的都是必要内容。</p><ol><li><strong>C语言基础</strong>（按照<em>C Primer Plus</em>的目录来，缺失的知识按照这本教材对应章节来学）<ul><li><input disabled="" type="checkbox"> Getting Ready</li><li><input checked="" disabled="" type="checkbox"> Introducing C</li><li><input checked="" disabled="" type="checkbox"> Data and C</li><li><input checked="" disabled="" type="checkbox"> Character Strings and Formatted Input/Output</li><li><input checked="" disabled="" type="checkbox"> Operators, Expressions, and Statements</li><li><input checked="" disabled="" type="checkbox"> C Control Statements: Looping</li><li><input checked="" disabled="" type="checkbox"> C Control Statements: Branching and Jumps</li><li><input checked="" disabled="" type="checkbox"> Character Input/Output and Input Validation</li><li><input checked="" disabled="" type="checkbox"> Functions</li><li><input checked="" disabled="" type="checkbox"> Arrays and Pointers</li><li><input checked="" disabled="" type="checkbox"> Character Strings and String Functions</li><li><input disabled="" type="checkbox"> Storage Classes, Linkage, and Memory Management</li><li><input disabled="" type="checkbox"> File Input/Output</li><li><input checked="" disabled="" type="checkbox"> Structures and Other Data Forms</li><li><input disabled="" type="checkbox"> Bit Fiddling</li><li><input checked="" disabled="" type="checkbox"> The C Preprocessor and the C Library</li><li><input disabled="" type="checkbox"> Advanced Data Representation</li></ul></li><li><strong>STM32基础背景知识</strong>（按照<em>Mastering STM32</em>的Introduction章节的目录来，缺失的知识按照这本教材对应章节来学）<ul><li><input disabled="" type="checkbox"> Introduction to STM32 MCU Portfolio</li><li><input checked="" disabled="" type="checkbox"> Setting-Up the Tool-Chain</li><li><input disabled="" type="checkbox"> Hello, Nucleo!</li><li><input checked="" disabled="" type="checkbox"> STM32CubeMX Tool</li><li><input disabled="" type="checkbox"> Introduction to Debugging</li></ul></li><li><strong>计算机工程基础</strong>（选修，可以不会，最好会，有了计算机硬件基础，理解STM32起来会快很多，但是我觉得不会有多少人能沉下心来钻研这部分（笑:-D））（按照*Introduction to Computing Systems [Third Edition]*的目录来，缺失的知识按照这本教材对应章节来学）<ul><li><input checked="" disabled="" type="checkbox"> Welcome Aboard</li><li><input checked="" disabled="" type="checkbox"> Bits, Data Types, and Operations</li><li><input checked="" disabled="" type="checkbox"> Digital Logic Structures</li><li><input checked="" disabled="" type="checkbox"> The von Neumann Model</li><li><input checked="" disabled="" type="checkbox"> The LC-3</li><li><input checked="" disabled="" type="checkbox"> Programming</li><li><input checked="" disabled="" type="checkbox"> Assembly Language</li><li><input checked="" disabled="" type="checkbox"> Data Structures</li><li><input checked="" disabled="" type="checkbox"> I/O</li><li><input checked="" disabled="" type="checkbox"> A Calculator</li><li><input disabled="" type="checkbox"> Introduction to C/C++ Programming</li><li><input disabled="" type="checkbox"> Variables and Operators</li><li><input disabled="" type="checkbox"> Control Structures</li><li><input disabled="" type="checkbox"> Functions</li><li><input disabled="" type="checkbox"> Testing and Debugging</li><li><input disabled="" type="checkbox"> Pointers and Arrays</li><li><input disabled="" type="checkbox"> Recursion</li><li><input disabled="" type="checkbox"> I/O in C</li><li><input disabled="" type="checkbox"> Dynamic Data Structures in C</li><li><input disabled="" type="checkbox"> Introduction to C++</li></ul></li></ol><h2 id="7-0-你所需要的硬件"><a href="#7-0-你所需要的硬件" class="headerlink" title="7.0 你所需要的硬件"></a>7.0 你所需要的硬件</h2><ul><li><p><strong>方案1</strong>：</p><p><img src="https://i.loli.net/2020/03/09/iwdMkjLfpZyRcvQ.png" alt="TypeA.png"></p><ul><li><input checked="" disabled="" type="checkbox"> <a href="https://www.robomaster.com/zh-CN/products/components/general">RoboMaster开发板A型 / B型 / C型</a></li><li><input checked="" disabled="" type="checkbox"> ST-Link V2 仿真&amp;烧录器（各大电商均有售卖，我就不打广告写店名了）</li></ul></li><li><p><strong>方案2</strong>：</p><p><img src="https://i.loli.net/2020/03/09/3PntcgQz1EUS8uW.jpg" alt="Nucleo.jpg"></p><ul><li><input checked="" disabled="" type="checkbox"> <a href="https://www.st.com/en/evaluation-tools/stm32-nucleo-boards.html">Nucleo开发板</a></li></ul><blockquote><p>Nucleo是ST官方的板子，而且支持Arduino的扩展板，是Arduino的引脚排布，自带烧录器，不需要额外的仿真&amp;烧录设备，适合想从Arduino平滑过渡到STM32的看官，但是如果要打RoboMaster比赛，请务必使用RoboMaster专用的开发板</p></blockquote></li></ul><h2 id="8-0-你所需要的软件"><a href="#8-0-你所需要的软件" class="headerlink" title="8.0 你所需要的软件"></a>8.0 你所需要的软件</h2><ul><li><input checked="" disabled="" type="checkbox"> <a href="https://www.deepin.org/">Linux系统</a>（虽然在MacOS和Win下面开发也没问题，但是直接在Linux下开发会方便很多，首推Deepin）</li><li><input checked="" disabled="" type="checkbox"> <a href="https://www.jetbrains.com/clion/">CLion</a>（非常强大的C/C++ IDE，用起来很顺手）</li><li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/texane/stlink">STM Stlink Tools</a>（烧录需要的软件）</li><li><input checked="" disabled="" type="checkbox"> <a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads">GNU Arm Embedded Tool-chain</a>（跨平台交叉编译需要的工具链）</li><li><input checked="" disabled="" type="checkbox"> <a href="https://www.st.com/content/st_com/zh/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-configurators-and-code-generators/stm32cubemx.html#tools-software">STM32CubeMX</a>（配置芯片引脚和外设，以及生成基本的控制框架）</li></ul><blockquote><p>关于如何配置开发环境，请善用（？）百度娘和谷歌姬，这部分因系统而异，因板子而异，甚至因人而异，所以作者便不再熬述～</p></blockquote><h2 id="9-0-后话"><a href="#9-0-后话" class="headerlink" title="9.0 后话"></a>9.0 后话</h2><p>接下来我会写进阶篇 I，是关于基本的GPIO设置与代码，随后其他进阶篇很快就会出，将介绍各种外设和其使用方法，诸位将很快在教程的指引下完成你的第一个STM32程序，怎么样，想想是不是有些小激动呢？～～</p><h2 id="10-0-UIUC-Open-Lab的冰山一脚（试图吸引点新人-）"><a href="#10-0-UIUC-Open-Lab的冰山一脚（试图吸引点新人-）" class="headerlink" title="10.0 UIUC Open Lab的冰山一脚（试图吸引点新人 :) ）"></a>10.0 UIUC Open Lab的冰山一脚（试图吸引点新人 :) ）</h2><p><img src="https://i.loli.net/2020/03/09/USfVzQcZAEBb8jJ.jpg" alt="RM01.jpg"></p><p><img src="https://i.loli.net/2020/03/09/XqgQPM1tUJsWcCV.jpg" alt="RM02.jpg"></p><p><img src="https://i.loli.net/2020/03/09/jwHQAFxlervmZGD.jpg" alt="RM03.jpg"></p><p><img src="https://i.loli.net/2020/03/09/Tu5vRqBY4JEhsWU.jpg" alt="RM04.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>机械神教</category>
      
    </categories>
    
    
    <tags>
      
      <tag>STM32</tag>
      
      <tag>RoboMaster</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[2019-08-23] 游戏结算</title>
    <link href="/posts/8e5c957/"/>
    <url>/posts/8e5c957/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=28563214&auto=1&height=66"></iframe><h2 id="游戏计划"><a href="#游戏计划" class="headerlink" title="游戏计划"></a>游戏计划</h2><ul><li>  [ ] 【07:30–08:00】起床，洗脸，刷牙，测体重（记得记录SAN值）</li><li>  [ ] 【08:00–08:40】早餐（记得记录SAN值）</li><li>  [ ] 【番茄工作法】【08:40–09:30】写Quad Day名单（记得记录SAN值）</li><li>  [ ] 【番茄工作法】【09:30–10:30】查看邮件</li><li>  [ ] 【番茄工作法】【10:30–12:00】复习微积分</li><li>  [ ] 【12:00–12:40】午餐</li><li>  [ ] 【12:40–02:00】登记自行车，复习微积分</li><li>  [ ] 【02:00–03:00】去买iclicker【Teamoji】</li><li>  [ ] 【番茄工作法】【03:00–05:00】复习微积分</li><li>  [ ] 【05:00–05:40】晚餐</li><li>  [ ] 【番茄工作法】【05:40–06:30】复习微积分</li><li>  [ ] 【06:30–09:00】ARC健身房</li><li>  [ ] 【09:00–09:30】回寝室</li><li>  [ ] 【09:30–10:30】休息，摸鱼</li><li>  [ ] 【10:30–11:10】总结，写计划（加入健康数值记录）</li><li>  [ ] 【11:10–11:20】休息，摸鱼</li><li>  [ ] 【11:20–11:30】睡觉</li></ul>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>每日计划</tag>
      
      <tag>计划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【Oracle创始人】【曾经的世界首富】埃里森在耶鲁大学的演讲</title>
    <link href="/posts/86773d1c/"/>
    <url>/posts/86773d1c/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=31010566&auto=1&height=66"></iframe><h2 id="人物简介"><a href="#人物简介" class="headerlink" title="人物简介"></a>人物简介</h2><p><img src="https://i.loli.net/2019/08/18/ToUjsBPmO4Q1V5K.jpg" alt="埃里森"></p><blockquote><p>  <strong>拉里·埃里森（Larry Ellison）</strong>是世界上最大数据库软件公司<a href="https://baike.baidu.com/item/%E7%94%B2%E9%AA%A8%E6%96%87/471435"><strong>甲骨文</strong></a>的老板，他的产品遍布全世界。他是陌生的人，但谁都似乎无法离开他。埃里森在32岁以前还一事无成。读了三个大学，没获得一个学位文凭，换了十几家公司，老婆也离他而去。开始创业时只有1200美元，却使得Oracle公司连续12年销售额每年翻一番，成为世界上第二大软件公司也被媒体称为最佳和利润最高的公司之一，他自己也成为硅谷首富。但只有少数人知道，这期间他经历了多么漫长的人生奋斗历程。32岁的他一无所有，到20年后的硅谷首富，外界对这个商业奇才的评价也是毁誉参半。</p></blockquote><hr><h2 id="记忆碎片"><a href="#记忆碎片" class="headerlink" title="记忆碎片"></a>记忆碎片</h2><blockquote><p>  &#160; &#160; &#160; &#160; 1974年，芝加哥，一个下着雪的冬天，清冷的街道上。一个头发留得长长的男子跟在一个女子后面，苦苦地解释着：昆妮，别抛下我，好吗？我现在什么也不要求，我只要你能跟着我。我会成为百万富翁的，只要你和我在一起，我一定会的。你要知道，我现在正在……<br>  &#160; &#160; &#160; &#160; 女人截断的他的话：够了，拉里，你已经向我保证过一万遍了，你说你会有一份好工作，你能挣到大钱。你已经30岁了，可到现在我发现你除了会吹牛和做白日梦之外，看不出你还有其他的长处。<br>  &#160; &#160; &#160; &#160; 你这样讲不公平，昆妮，我会做出来给你看到的，就在不远的未来。但你要有耐心。<br>  &#160; &#160; &#160; &#160; 不远的未来？你承诺不远的次数太多了。我真看不出你的未来在哪？成天里晃来晃去的，连没有一份稳定的工作都没有。而你却一天到晚在说，你总会有一份很棒的工作的。说实在的，你能找到工作吗？我怀疑！在学校里混了那么多年，连一个正经的学历没有拿到。<br>  &#160; &#160; &#160; &#160; 可我和你解释多少次了，那些学历对我来讲，没有多少意义？<br>  &#160; &#160; &#160; &#160; 好吧，拉里，你永远是对的，我不想和你争了。昆妮指着远方密执安湖南岸深处的一片教学大楼说道：你说学历没有用，那么那些大楼有用吗？<br>  &#160; &#160; &#160; &#160; 男人无言。<br>  &#160; &#160; &#160; &#160; 女人转身离去。<br>  &#160; &#160; &#160; &#160; 男人站在默默地站在街头，眼里噙着孤独而痛苦的泪水。那一刻里，他在心中深处狠狠在骂了一声。那一刻，谁也没有听到他嘴中的那个诅咒，但在寒冷中抚摸着他头发的风听到了，拉里没有骂那个曾经给了他无限美好回忆的女人，没有骂上帝，没有骂任何人，他骂了那个曾经并且仍将创造着种种学历的制度。</p><p>  &#160; &#160; &#160; &#160; 20多年后，五月里，一个阳光明媚的春日。在近年来接连为美利坚合众国输送了两位总统的耶鲁大学校园里，一个趾高气扬的家伙和一位衣冠楚楚的绅士，走进了那个挤满了穿着学位袍的年轻人的校园礼堂。全美著名的伍尔西大礼堂很快安静了下来，绅士用一种极为敬仰的口吻介绍道：在今天的毕业典礼中，我们很荣幸地请到了当今美国商界最著名的甲骨文公司创始人、董事会主席拉里埃里森先生为我们今年的毕业典礼做一个有关职业生涯设计的讲演。大家知道，埃里森先生于1977年创立了他的公司。6年后埃里森设计并开始运营他的VAX模式数据库，这是人类第一个完全用Ｃ语言编写的便于移植的数据库，为此甲骨文公司为人类的信息业做出了不可估量的贡献。在埃里森先生一生中，有两个时刻很有意思，一次发生是在1986年的一天里，那一天他领导着甲骨文公司挂牌纳斯达克，其时拉里个人身价高达9300万美金，做了一天美国最年轻的首富，遗憾的是，仅仅一天之后，比他年轻11岁的比尔盖茨先生带领着他的团队上市，按市值，盖茨先生个人资产达到3亿多美元，迅速地结束了拉里有关首富而伴随的神话；第二次发生在今年的4月28日，那天整个华尔街都了解到了一个消息，由于微软在打击网景公司一事上涉嫌垄断，联邦司法部的雷诺女士提出了分拆微软的详细方案，那天刚好是个星期五，下午4点收盘时，微软的股价跌到了69.75美元。当晚，一位《福布斯》杂志的编辑在媒体上评论道，握有本公司7.4亿多股的比尔·盖茨先生，个人总资产跌至517亿美元，人们相信比尔会永远地记住这个黑色的星期五的；而此刻站在我们面前的这位先生，他的甲骨文公司股价当天上涨至每股79.94美元，由于个人拥有公司6.6亿多股股票，埃里森名下的资产一下子升水至530亿美元，也就是在这一天里，埃里森的头上第二次地戴上了世界首富的桂冠。这就是市场，这就是财富，这就是今天将辉煌带到我们耶鲁大学的拉里埃里森先生。除了计算机与数据库之外，我们知道，埃里森先生也一直在与各种人打交道，从客户到竞争对手，从资深的高管到刚刚开始职业生涯的学生，他一生经营企业，在做事、用人、工作、学习等方面有着很多独特的见解，下面我们就请拉里埃里森先生就他个人的一些管理经验与学习智慧给我们今天的毕业典礼做一个精彩的讲演，有请，埃里森先生。<br>  &#160; &#160; &#160; &#160; 埃里森走上在讲台，左顾右盼了一会儿，开始了他的演讲…</p></blockquote><hr><h2 id="演讲原文"><a href="#演讲原文" class="headerlink" title="演讲原文"></a>演讲原文</h2><p>&#160; &#160; &#160; &#160; 耶鲁的毕业生们，我想请你们为我做一件事。请你好好看一看周围，看一看站在你左边的同学，看一看站在你右边的同学。请你设想这样的情况：从现在起5年之后，10年之后，或30年之后，今天站在你左边的这个人会是一个失败者；右边的这个人，同样，也是个失败者。而你，站在中间的家伙，你以为会怎样？一样是失败者。失败的经历。失败的优等生。说实话，今天我站在这里，并没有看到一千个毕业生的灿烂未来。我没有看到一千个行业的一千名卓越领导者，我只看到了一千个失败者。你们感到沮丧，这是可以理解的。为什么，我，埃里森，一个退学生，竟然在美国最具声望的学府里这样厚颜地散布异端？我来告诉你原因。因为，</p><p>&#160; &#160; &#160; &#160; <strong>我，埃里森，这个行星上第二富有的人，是个退学生，而你不是。因为比尔盖茨，这个行星上最富有的人，就目前而言，是个退学生，而你不是。因为艾伦，这个行星上第三富有的人，也退了学，而你没有。再来一点证据吧，因为戴尔，这个行星上第九富有的人，他的排位还在不断上升，也是个退学生。</strong></p><p>&#160; &#160; &#160; &#160; 而你，不是。你们非常沮丧，这是可以理解的。你们将来需要这些有用的工作习惯。你将来需要这种“治疗”。你需要它们，因为你没辍学，所以你永远不会成为世界上最富有的人。哦，当然，你可以，也许，以你的方式进步到第10位，第11位，就像史蒂夫.鲍尔默。不过，我没有告诉你他在为谁工作，是吧？根据记载，他是研究生时辍的学，开化得稍晚了些。现在，我猜想你们中间很多人，也许是绝大多数人，正在琢磨，我能做什么？我究竟有没有前途？当然没有。太晚了，你们已经吸收了太多东西，以为自己懂得太多。你们再也不是19岁了。你们有了内置的帽子，哦，我指的可不是你们脑袋上的学位帽。嗯，你们已经非常沮丧啦。这是可以理解的。所以，现在可能是讨论实质的时候啦，绝不是为了你们，毕业生先生们。你们已经被报销，不予考虑了。我想，你们就偷偷摸摸去干那年薪20万的可怜工作吧，在那里，工资单是由你两年前辍学的同班同学签字开出来的。事实上，我是寄希望于眼下还没有毕业的同学。我要对他们说，离开这里。收拾好你的东西，带着你的点子，别再回来。退学吧，开始行动。我要告诉你，一顶帽子一套学位服必然要让你沦落。</p><hr><h2 id="然后…"><a href="#然后…" class="headerlink" title="然后…"></a>然后…</h2><blockquote><p>  这时，脸色苍白的绅士带着两个保安来到了拉里埃里森身边，全场一片混乱……</p><p>  后来，有位中国的财经作家写到：那一天，拉里痛快地颠覆了美国的教育体制，他的批判是如此的严厉，又是如此的深刻，以至我们人类不得不再次回想起，从童年起就不断被提及的那个童话，安徒生笔下的那位皇帝很像我们现实当中的一些陈旧观念，而甲骨文的埃里森无疑充当了那个指出皇帝身上漂亮衣服的勇敢儿童。</p><p>  我们都在不自觉地维护着一个神话般的泡沫体制。</p></blockquote><hr><h2 id="人物传记"><a href="#人物传记" class="headerlink" title="人物传记"></a>人物传记</h2><blockquote><p>  用于私藏，已经绝版</p></blockquote><ul><li><strong>《上帝与拉里·埃里森之间的不同》</strong><ul><li>  <a href="https://mega.nz/#!5eBWxQKY!nMpT2DwtbXOWDaK61Uas_nzixp0VbtDqlnaFU6jClNs">MEGA</a></li><li>  <a href="https://uillinoisedu-my.sharepoint.com/:b:/g/personal/guangy2_illinois_edu/EVYG0yYDyypIjC5H2AFzHZMBJhgOCvDnL3h0lGH0BLxyVA?e=TDrgey">OneDrive</a></li><li>  <a href="https://uofi.box.com/s/gxts54o8ne2qg9yju715ymaf2pjxmvfp">Dropbox</a></li><li>  <a href="https://pan.baidu.com/s/1udhRQk-nqcQtwNlYeo2Gnw">百度网盘</a> 提取码: k4pu</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>创业海盗</category>
      
    </categories>
    
    
    <tags>
      
      <tag>埃里森</tag>
      
      <tag>人物</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PROU术式系统【1.0.0】</title>
    <link href="/posts/dac2dbc5/"/>
    <url>/posts/dac2dbc5/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=1326987219&auto=1&height=66"></iframe><p><img src="https://i.loli.net/2019/08/16/ToUBYnkPGd2uh5Z.jpg" alt="PROU术式系统"></p><h2 id="系统正式发布简介"><a href="#系统正式发布简介" class="headerlink" title="系统正式发布简介"></a>系统正式发布简介</h2><ul><li><strong>术式系统开发目标</strong><ol><li> 自动化，程序化学习流程</li><li> 让知识不再是混乱的，而是有体系的，可溯源的</li><li> 让完全不相关的知识也能联系在一起，也就是跨学科的能力，你所学的一切都是关于这个世界的一个整体，知识是一张网，而不是一个个盒子</li><li> 记忆不再是亡羊补牢式，而是自适应式设计，学了一次后只要按照PROU术式流程走，就一辈子绝对不会忘记，不是大学4年，而是一辈子，成为终生学习者</li><li> <strong>用方法论虐爆一切天赋！！</strong></li></ol></li><li>  这个系统项目已经酝酿很久了，参考了众多书目和资料，花了1年时间来总结提纯，最近2个月来测试，并在大学开学就取得了<strong>GPA4.0</strong>的成绩，分别为微积分 <strong>A+**（满分4.0平均分2.73，A+为满分以上），Professional Development **A</strong>，等等，现在正式公开出来。以上成绩并没有完全使用所有PROU术式系统包含的所有术式，基本只用了<strong>R分支</strong>的术式，这也是最核心的技术内幕之一</li><li>  这个项目实在太过庞大，所以这里就不一一解释术式了，想仔细了解就去看下面的PDF分享文件链接，然后把参考书目全部看一遍，就完全懂了。要我在博客里解释每一项技术恐怕一个星期就没了……所以，自己决定吧！</li><li>参考书目<ul><li>  《<strong>绝非天赋</strong>》</li><li>  《<strong>刻意练习</strong>》</li><li>  《<strong>如何高效记忆</strong>》</li><li>  《<strong>如何高效学习</strong>》</li><li>  《<strong>如何高效阅读</strong>》</li><li>  《<strong>学习之道</strong>》</li><li>  《<strong>学习的科学</strong>》</li><li>  《<strong>专注力</strong>》</li><li>  《<strong>自控力</strong>》</li></ul></li><li>  术式大纲<img src="https://i.loli.net/2019/08/16/bX7F6yInEqP8jDL.png" alt="PROU术式系统草稿"></li></ul><hr><h2 id="项目详细资料分享链接"><a href="#项目详细资料分享链接" class="headerlink" title="项目详细资料分享链接"></a>项目详细资料分享链接</h2><ul><li>  <a href="https://mega.nz/#!1aZVwCJY!I75ODNA9AuizdCKiCv1V7BncJsNhKlp429seZaJVk9s">MEGA</a></li><li>  <a href="https://uillinoisedu-my.sharepoint.com/:b:/g/personal/guangy2_illinois_edu/Edum8Y4nURNMtvM6wjtsbJMB7I9fjB7dbXU_i9ObwL75_w?e=vZhcE9">OneDrive</a></li><li>  <a href="https://uofi.box.com/s/gmf4yknlway7aj1i7jmyucv5y5qwntza">Dropbox</a></li><li>  <a href="https://pan.baidu.com/s/1YtF3zpB6gRGV9_d-kGtq1A">百度网盘</a> 提取码: q2k2</li></ul>]]></content>
    
    
    <categories>
      
      <category>游戏系统设计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PROU术式</tag>
      
      <tag>UIUC学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Samurai术式系统【0.9.0 Beta】</title>
    <link href="/posts/5573ce0e/"/>
    <url>/posts/5573ce0e/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=1326987219&auto=1&height=66"></iframe><p><img src="https://i.loli.net/2019/08/15/NFgji6tPBUEJeHq.png" alt="Samurai术式系统.png"></p><h2 id="系统正式发布简介"><a href="#系统正式发布简介" class="headerlink" title="系统正式发布简介"></a>系统正式发布简介</h2><ul><li>  目前还有点乱，尚未完全<strong>整合一体化</strong>，在经过了一段时间的测试，调参，以及基本部署后，再发布正式版本1.0.0，以下只是大纲，更详细的细节就太多了就不写了</li><li>  草稿<img src="https://i.loli.net/2019/08/15/IqpLjr94H3XRC6N.jpg" alt="Samurai术式系统草稿"></li><li>  <strong>触媒</strong>：利用外界媒体（音乐，文字，视频片段等等媒介）来强行改写意志</li><li>  <strong>刻印</strong>：指一旦完成搭建，便会在需要的时候自动触发，自动运行，不依赖个体的本身意志</li><li>  关键概念：SAN值，安排，安排安排，时间VS结果导向，时间压缩率，时间偏差率，时间清晰度，时间控制率</li><li>  目前已经完成<strong>SAN值轮询系统</strong>和<strong>触媒刻印系统</strong>的耦合，耦合思想采用了23种<strong>代码设计模式</strong>中的<strong>观察者模式</strong>，使两者尽可能解耦，stand alone，方便后期<strong>异步迭代</strong>和调参，方便确认系统出错时的问题位置</li><li>主要由<strong>2个系统</strong>，<strong>3个轮回阶段</strong>组成<ul><li>2个系统<ul><li>  SAN值轮询系统</li><li>  触媒刻印系统</li></ul></li><li>3个轮回阶段<ul><li>  制定计划</li><li>  执行术式</li><li>  反馈调参</li></ul></li></ul></li></ul><hr><h2 id="2个系统"><a href="#2个系统" class="headerlink" title="2个系统"></a>2个系统</h2><h3 id="SAN值轮询系统"><a href="#SAN值轮询系统" class="headerlink" title="SAN值轮询系统"></a>SAN值轮询系统</h3><ul><li>SAN值&amp;触媒能耗表（待制作，需要长期维护）<ul><li>  纯消耗类</li><li>  纯充能类</li><li>  自沉迷类</li></ul></li><li>SAN值方法分类<ul><li>充能<ul><li>  固定（无论SAN值如何，都会固定充能）</li><li>  机动（依据SAN值，如果过低，则额外补充）</li></ul></li><li>消耗<ul><li>  固定（无论SAN值如何，都会固定消耗）</li><li>  机动（依据SAN值，如果还有剩余，则用于完成额外任务）</li></ul></li></ul></li><li>  SAN值轮询对照表（待制作，需要长期维护）</li></ul><h3 id="触媒刻印系统"><a href="#触媒刻印系统" class="headerlink" title="触媒刻印系统"></a>触媒刻印系统</h3><ul><li><p>两种行为干涉思想</p><ul><li>【长期】奖惩机制（培养习惯）<ul><li>  改变事件本身的能耗，非常缓慢，但是没有数量限制，潜力无限</li></ul></li><li>【即时】触媒刻印（强行改写）<ul><li>  暂时立即改变执行者本身，效果显著而短暂有限</li></ul></li></ul></li><li><p>SAN值&amp;触媒能耗表（待制作，需要长期维护）</p><blockquote><p>  注意：触媒本身不一定具有充能效果，甚至可能有损耗，而且即便是同类型的触媒，其背后的原理也大相径庭</p></blockquote></li></ul><hr><h2 id="3个轮回阶段"><a href="#3个轮回阶段" class="headerlink" title="3个轮回阶段"></a>3个轮回阶段</h2><h3 id="制定计划"><a href="#制定计划" class="headerlink" title="制定计划"></a>制定计划</h3><ul><li>  计划3要素：游戏，休息，弹性时间</li><li>  日计划一旦确定提交，必须全部执行，并进入奖惩机制</li><li>  周计划可以无限大胆，相当于任务领取栏，不可能全部完成</li><li>任务领取栏要点<ul><li>两类任务<ul><li>  长期累积任务（可能多达数月）</li><li>  时效性突发任务（可能来自于备忘录）</li></ul></li></ul></li><li>  <del>每天的固定环节应当有长期追踪</del></li><li>  如何让安排安排能够不忘且执行</li><li>  休息是时间导向，还是应该结果导向</li><li>  备忘录的转化执行机制</li><li>任务栏标签子系统<ul><li>  习惯 / 突发</li><li>  低耗 / 中耗 / 高耗</li><li>  沉迷</li><li>  …</li></ul></li><li>  <del>SAN值能耗表的制作</del></li></ul><h3 id="执行术式"><a href="#执行术式" class="headerlink" title="执行术式"></a>执行术式</h3><ul><li>  番茄工作法的执行细节问题（很多时候不可能完全执行，需要加入适当的灵活性）</li><li>  与PROU系统耦合</li><li>  SAN值的时刻监测（长期培养出敏感度）并记录</li></ul><h3 id="反馈调参"><a href="#反馈调参" class="headerlink" title="反馈调参"></a>反馈调参</h3><ul><li>  每天固定报告格式</li><li>  奖惩机制的执行确保（可计算公式化）</li><li>  每天的固定环节应当有长期追踪</li><li>参数<ul><li>时间压缩率<ul><li>  游戏时间 / 总时间</li></ul></li><li>时间偏差率<ul><li>  每项时间波动的绝对值之和 / 每项时间之和</li><li>  不包含未执行项</li></ul></li><li>时间清晰度<ul><li>  12分制，需要自我评估</li><li>  计划是否足够清晰明确，记录是否清晰准确</li></ul></li><li>时间控制度<ul><li>  完成项数 / 总项数</li></ul></li></ul></li></ul><hr><h2 id="整个系统的执行流程"><a href="#整个系统的执行流程" class="headerlink" title="整个系统的执行流程"></a>整个系统的执行流程</h2><ul><li>计划<ol start="0"><li> 星期天写任务领取栏</li><li> 日计划，除日常任务外，添加突发任务，额外领取任务</li><li> 任务贴上标签，预估损耗（是否为番茄工作法）</li><li> 按照4个参数，制定奖惩标准</li></ol></li><li>执行 &amp; 记录<ol><li> 每次开始任务，结束任务时，或者一轮番茄后均自测SAN</li><li> 记每次的开始时间，结束时间，任务详细内容，沉迷度</li><li> 触媒的剂量，使用效果</li></ol></li><li>统计总结<ol><li> 4参数计算</li><li> 固定环节长期追踪</li><li> 触媒剂量报告，关键新数据录入到数据库</li><li> 难度评估（12分制）+质量评估（12分制）+总结反思报告（自我评分，120分制，(难度评估×质量评估)×(120/120)）</li></ol></li></ul><hr><h2 id="系统上线过渡计划"><a href="#系统上线过渡计划" class="headerlink" title="系统上线过渡计划"></a>系统上线过渡计划</h2><ol><li> 首先，SAN值轮询记录，计划制定先上线，触媒刻印也会有，但前期主要靠直觉和经验来自由发挥，尚且未完全量化，公式化，自动化</li><li> 慢慢细化，复杂化，把以上所有细节要点全部囊括落实，最终完整上线触媒刻印系统</li><li> 与PROU或者其他后续的系统深度耦合，所有理论参数量化公式化</li></ol>]]></content>
    
    
    <categories>
      
      <category>游戏系统设计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>每日计划</tag>
      
      <tag>每周任务</tag>
      
      <tag>Samurai术式</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于Samurai术式系统【0.9.0 Beta版本】的发布公告</title>
    <link href="/posts/681d4a8e/"/>
    <url>/posts/681d4a8e/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=1326987219&auto=1&height=66"></iframe><h2 id="公告"><a href="#公告" class="headerlink" title="公告"></a>公告</h2><ul><li>  目前已经完成<strong>SAN值轮询系统</strong>和<strong>触媒刻印系统</strong>的耦合，采用了23种<strong>代码设计模式</strong>中的<strong>观察者模式</strong>，使两者尽可能解耦，stand alone，方便后期<strong>异步迭代</strong>和调参，方便确认系统出错时的问题位置</li><li>  明天把草稿再稍微完善后就录入，然后正式发布<strong>0.9.0Beta</strong>版本</li></ul>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
      <category>游戏系统设计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>每日计划</tag>
      
      <tag>每周任务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[2019-08-15] 游戏计划</title>
    <link href="/posts/b093909f/"/>
    <url>/posts/b093909f/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=28563214&auto=1&height=66"></iframe><h2 id="游戏计划"><a href="#游戏计划" class="headerlink" title="游戏计划"></a>游戏计划</h2><ul><li>  [ ] 【07:30–08:00】起床，洗脸，刷牙，测体重（记得记录SAN值）</li><li>  [ ] 【08:00–08:30】早餐（记得记录SAN值）</li><li>  [ ] 【番茄工作法】【08:30–10:30】正式在博客上发布触媒刻印术式系统（记得记录SAN值）</li><li>  [ ] 【番茄工作法】【10:30–12:30】正式在博客上发布PROU刻印术式系统</li><li>  [ ] 【12:30–01:00】午餐</li><li>  [ ] 【01:00–01:30】休息，摸鱼</li><li>  [ ] 【01:30–02:30】去理发</li><li>  [ ] 【02:30–04:30】买自行车</li><li>  [ ] 【04:30–05:00】给商学院的学生发邮件</li><li>  [ ] 【05:00–06:00】晚餐，购买早餐午餐</li><li>  [ ] 【06:00–06:40】去ARC健身房</li><li>  [ ] 【06:40–09:00】健身</li><li>  [ ] 【09:00–09:30】回寝室</li><li>  [ ] 【09:30–10:10】总结，写计划（加入健康数值记录）</li><li>  [ ] 【10:10–10:50】看项目代码</li><li>  [ ] 【10:50–11:20】休息，嗨</li><li>  [ ] 【11:20–11:30】睡觉</li></ul><h2 id="备忘录"><a href="#备忘录" class="headerlink" title="备忘录"></a>备忘录</h2><ul><li>  理发</li><li>  买自行车</li><li>  给商学院某某发邮件</li><li>  在每日总结里面加入健康数值记录</li></ul>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>每日计划</tag>
      
      <tag>计划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>前端高质量资源大全</title>
    <link href="/posts/837ea377/"/>
    <url>/posts/837ea377/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=441102360&auto=1&height=66"></iframe><h2 id="前端资源清单"><a href="#前端资源清单" class="headerlink" title="前端资源清单"></a>前端资源清单</h2><h3 id="技术博客"><a href="#技术博客" class="headerlink" title="技术博客"></a>技术博客</h3><ul><li>  <a href="http://www.ruanyifeng.com/blog"><strong>阮一峰的网络日志</strong></a></li><li>  <a href="https://www.zhangxinxu.com/wordpress"><strong>张鑫旭博客</strong></a></li></ul><h3 id="学习路线"><a href="#学习路线" class="headerlink" title="学习路线"></a>学习路线</h3><ul><li>  <a href="https://github.com/qianguyihao/Web"><strong>前端入门和进阶学习笔记</strong></a></li><li>  <a href="https://github.com/qianguyihao/Web/blob/master/17-%E5%89%8D%E7%AB%AF%E7%BB%BC%E5%90%88/01-2019%E5%B9%B4Web%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8%E8%87%AA%E5%AD%A6%E8%B7%AF%E7%BA%BF.md"><strong>2019年Web前端入门自学路线</strong></a></li><li>  <a href="https://github.com/qiu-deqing/FE-learning"><strong>结合个人经历总结的前端入门方法</strong></a></li><li>  <a href="https://zhuanlan.zhihu.com/p/21935921"><strong>前端学习路径</strong></a></li></ul><h3 id="技术归档"><a href="#技术归档" class="headerlink" title="技术归档"></a>技术归档</h3><ul><li>  <a href="https://github.com/qianguyihao/Web/blob/master/17-%E5%89%8D%E7%AB%AF%E7%BB%BC%E5%90%88/02-2019%E5%B9%B4Web%E5%89%8D%E7%AB%AF%E6%9C%80%E6%96%B0%E5%AF%BC%E8%88%AA.md"><strong>2019年Web前端最新导航</strong></a></li><li>  <a href="https://github.com/helloqingfeng/Awsome-Front-End-learning-resource"><strong>GitHub最全的前端资源汇总仓库</strong></a></li><li>  <a href="https://www.cnblogs.com/xinggood/p/9187531.html"><strong>前端资源网址大集合</strong></a></li><li>  <a href="https://developer.mozilla.org/zh-CN/docs/Web"><strong>MDN文档库</strong></a></li><li>  <a href="https://medium.com/dailyjs"><strong>Daily JS</strong></a></li></ul><h3 id="书籍汇总"><a href="#书籍汇总" class="headerlink" title="书籍汇总"></a>书籍汇总</h3><ul><li>  <a href="https://github.com/JacksonTian/fks"><strong>前端技能&amp;书籍汇总</strong></a></li><li>  <a href="https://github.com/jobbole/awesome-programming-books"><strong>经典编程书籍大全</strong></a></li></ul><h3 id="GitHub项目"><a href="#GitHub项目" class="headerlink" title="GitHub项目"></a>GitHub项目</h3><ul><li>  <a href="https://github.com/wesbos/JavaScript30"><strong>JavaScript30</strong></a></li><li>  <a href="https://github.com/SUNNERCMS/30daysJavascript"><strong>JavaScript 30天解析</strong></a></li><li>  <a href="https://github.com/carbon-app/carbon"><strong>Carbon</strong></a></li></ul>]]></content>
    
    
    <categories>
      
      <category>技术情报</category>
      
    </categories>
    
    
    <tags>
      
      <tag>代码 &amp; 项目</tag>
      
      <tag>书单</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Markdown Previewer</title>
    <link href="/posts/489af90f/"/>
    <url>/posts/489af90f/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=441102360&auto=1&height=66"></iframe><h2 id="前端工程展示页"><a href="#前端工程展示页" class="headerlink" title="前端工程展示页"></a>前端工程展示页</h2><h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><blockquote><ul><li>  <strong>freeCodeCamp</strong>上的证书题目7</li><li>  Link：<a href="https://learn.freecodecamp.org/front-end-libraries/front-end-libraries-projects/build-a-markdown-previewer">Front End Libraries Projects - Build a Markdown Previewer</a></li></ul></blockquote><h3 id="源代码-效果图"><a href="#源代码-效果图" class="headerlink" title="源代码 + 效果图"></a>源代码 + 效果图</h3><iframe frameborder="0" width="100%" height="500px" src="https://repl.it/@MaverickNone/Markdown-Previewer?lite=1&outputonly=1"></iframe><p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="js,result" data-user="MaverickNone" data-slug-hash="pozgaLx" data-preview="true" style="height: 500px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Challenges [07]">  <span>See the Pen <a href="https://codepen.io/MaverickNone/pen/pozgaLx/">  Challenges [07]</a> by MaverickNone (<a href="https://codepen.io/MaverickNone">@MaverickNone</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script><br><blockquote><p>  <strong>如果客官您觉得不够大，看着不太爽！</strong>请点击<a href="https://markdown-previewer--mavericknone.repl.co/"><strong>这里</strong></a>或者<a href="https://codepen.io/MaverickNone/full/pozgaLx"><strong>这边</strong></a>~</p></blockquote><hr><h2 id="源代码解构"><a href="#源代码解构" class="headerlink" title="源代码解构"></a>源代码解构</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-meta">!!! 5</span><br><span class="hljs-tag">%<span class="hljs-selector-tag">html</span>(<span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> )</span><br><span class="hljs-tag">  %<span class="hljs-selector-tag">head</span></span><br><span class="hljs-tag">    %<span class="hljs-selector-tag">meta</span>(<span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> )</span><br><span class="hljs-tag">    %<span class="hljs-selector-tag">title</span></span><br>      Test [07]<br><span class="hljs-tag">    %<span class="hljs-selector-tag">script</span>(<span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://kit.fontawesome.com/83ef1fc2b2.js&quot;</span> )</span><br><span class="hljs-tag">    %<span class="hljs-selector-tag">link</span>(<span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;style.css&quot;</span> )</span><br><span class="hljs-tag">  %<span class="hljs-selector-tag">body</span></span><br>    #app<br><span class="hljs-tag">    %<span class="hljs-selector-tag">script</span>(<span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/react/16.9.0/umd/react.production.min.js&quot;</span> )</span><br><span class="hljs-tag">    %<span class="hljs-selector-tag">script</span>(<span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.8.6/umd/react-dom.production.min.js&quot;</span> )</span><br><span class="hljs-tag">    %<span class="hljs-selector-tag">script</span>(<span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/marked/0.7.0/marked.min.js&quot;</span> )</span><br><span class="hljs-tag">    %<span class="hljs-selector-tag">script</span>(<span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js&quot;</span> )</span><br><span class="hljs-tag">    %<span class="hljs-selector-tag">script</span>(<span class="hljs-attr">src</span>=<span class="hljs-string">&quot;script.js&quot;</span> )</span><br></code></pre></td></tr></table></figure><ul><li>  本代码由<strong>Haml</strong>编写</li><li>  添加库的时候，同时把<strong>React</strong>和<strong>React-DOM</strong>都加上</li><li>  这次渲染Markdown使用了GitHub上的<a href="https://github.com/markedjs/marked"><strong>Marked</strong></a>项目</li><li>  倒数第二个是<strong>freeCodeCamp</strong>的项目测评库</li><li>  其他没啥可讲的，都是基本功</li></ul><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@import</span> url(<span class="hljs-string">&quot;https://fonts.googleapis.com/css?family=Russo+One&quot;</span>);<br><span class="hljs-keyword">@import</span> url(<span class="hljs-string">&quot;https://fonts.font.im/css?family=Quantico&quot;</span>);<br><br><span class="hljs-variable">$darkAccent</span>: <span class="hljs-number">#09d5da</span>;<br><span class="hljs-variable">$lightAccent</span>: <span class="hljs-number">#2cda9d</span>;<br><span class="hljs-variable">$backgroundBase</span>: <span class="hljs-number">#5368a4</span>;<br><br><span class="hljs-variable">$shadow</span>: <span class="hljs-number">1px</span> <span class="hljs-number">1px</span> <span class="hljs-number">15px</span> <span class="hljs-number">8px</span> darken(<span class="hljs-variable">$backgroundBase</span>, <span class="hljs-number">20%</span>);<br><span class="hljs-variable">$default-border</span>: <span class="hljs-number">1px</span> solid darken(<span class="hljs-variable">$backgroundBase</span>, <span class="hljs-number">35%</span>);<br><br><span class="hljs-selector-tag">body</span> &#123;<br>    <span class="hljs-attribute">background</span>: url(<span class="hljs-string">&quot;https://i.loli.net/2019/08/14/GSTWDn2sqt3YL17.jpg&quot;</span>) fixed;<br>    <span class="hljs-attribute">background-size</span>: <span class="hljs-number">100%</span>;<br>&#125;<br><br><span class="hljs-selector-class">.colorScheme</span> &#123;<br>    <span class="hljs-attribute">background-color</span>: lighten(<span class="hljs-variable">$backgroundBase</span>, <span class="hljs-number">30%</span>);<br>    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-variable">$shadow</span>;<br>    <span class="hljs-attribute">border-top-style</span>: none;<br>&#125;<br><br><span class="hljs-selector-class">.toolbar</span> &#123;<br>    <span class="hljs-attribute">position</span>: relative;<br>    <span class="hljs-attribute">background-color</span>: lighten(<span class="hljs-variable">$darkAccent</span>, <span class="hljs-number">25%</span>);<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">4px</span> <span class="hljs-number">3px</span> <span class="hljs-number">3px</span>;<br>    <span class="hljs-attribute">border</span>: <span class="hljs-variable">$default-border</span>;<br>    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-variable">$shadow</span>;<br>    <span class="hljs-attribute">font-family</span>: Russo One, sans-serif;<br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">15px</span>;<br>    <span class="hljs-selector-tag">i</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">25px</span>;<br>        <span class="hljs-attribute">color</span>: black;<br>        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">5px</span>;<br>    &#125;<br>    <span class="hljs-selector-class">.fa-compress</span>,<br>    <span class="hljs-selector-class">.fa-expand</span> &#123;<br>        <span class="hljs-attribute">position</span>: absolute;<br>        <span class="hljs-attribute">right</span>: -<span class="hljs-number">5px</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-selector-class">.fa-compress</span>,<br><span class="hljs-selector-class">.fa-expand</span> &#123;<br>    &amp;<span class="hljs-selector-pseudo">:hover</span> &#123;<br>        <span class="hljs-attribute">animation</span>: btn <span class="hljs-number">0.5s</span>;<br>        <span class="hljs-attribute">animation-fill-mode</span>: forwards;<br>        <span class="hljs-attribute">cursor</span>: pointer;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">@keyframes</span> btn &#123;<br>    100% &#123;<br>        <span class="hljs-attribute">color</span>: lighten(<span class="hljs-variable">$lightAccent</span>, <span class="hljs-number">10%</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-selector-class">.fa-chess</span> &#123;<br>    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">3px</span>;<br>&#125;<br><br><span class="hljs-selector-class">.editorWrap</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">18px</span> auto;<br>    <span class="hljs-selector-class">.toolbar</span> &#123;<br>        <span class="hljs-attribute">position</span>: relative;<br>        <span class="hljs-attribute">right</span>: <span class="hljs-number">18px</span>;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>        <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">36px</span>;<br>        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>    &#125;<br>    <span class="hljs-selector-tag">textarea</span> &#123;<br>        <span class="hljs-keyword">@extend</span> .colorScheme;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">98.5%</span>;<br>        <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">1vw</span>;<br>        <span class="hljs-attribute">min-height</span>: <span class="hljs-number">60vh</span>;<br>        <span class="hljs-attribute">margin-bottom</span>: -<span class="hljs-number">5px</span>;<br>        <span class="hljs-attribute">resize</span>: vertical;<br>        <span class="hljs-attribute">outline</span>: none;<br>        <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">5px</span>;<br>        <span class="hljs-attribute">font-family</span>: Quantico, sans-serif;<br>        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">15px</span>;<br>        <span class="hljs-attribute">border-bottom-left-radius</span>: <span class="hljs-number">20px</span>;<br>        <span class="hljs-attribute">border-bottom-right-radius</span>: <span class="hljs-number">20px</span>;<br>        &amp;::-webkit-scrollbar &#123; width: <span class="hljs-number">0</span> &#125;;<br>    &#125;<br>&#125;<br><br><span class="hljs-selector-class">.previewWrap</span> &#123;<br>    <span class="hljs-keyword">@extend</span> .colorScheme;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">800px</span>;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> auto;<br>    <span class="hljs-attribute">overflow-wrap</span>: break-word;<br>    <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">20px</span>;<br>    <span class="hljs-attribute">border-bottom-left-radius</span>: <span class="hljs-number">25px</span>;<br>    <span class="hljs-attribute">border-bottom-right-radius</span>: <span class="hljs-number">25px</span>;<br>    <span class="hljs-selector-class">.toolbar</span> &#123;<br>        <span class="hljs-attribute">position</span>: relative;<br>        <span class="hljs-attribute">right</span>: <span class="hljs-number">12px</span>;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>        <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">36px</span>;<br>        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>    &#125;<br>    <span class="hljs-selector-id">#preview</span> &#123;<br>        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">5px</span>;<br>        <span class="hljs-attribute">margin-top</span>: -<span class="hljs-number">10px</span>;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">98.5%</span>;<br>        <span class="hljs-attribute">border-bottom-left-radius</span>: <span class="hljs-number">25px</span>;<br>        <span class="hljs-attribute">border-bottom-right-radius</span>: <span class="hljs-number">25px</span>;<br>        <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">1vw</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (max-width: <span class="hljs-number">850px</span>) &#123;<br>    <span class="hljs-selector-class">.previewWrap</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">630px</span>;<br>    &#125;<br>    <span class="hljs-selector-class">.editorWrap</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">550px</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-selector-class">.maximized</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">90%</span>;<br>    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">90vh</span>;<br>    <span class="hljs-attribute">margin</span>: auto;<br>    <span class="hljs-selector-tag">textarea</span> &#123;<br>        <span class="hljs-attribute">min-height</span>: <span class="hljs-number">90vh</span>;<br>        <span class="hljs-attribute">resize</span>: none;<br>    &#125;<br>&#125;<br><br><span class="hljs-selector-class">.hide</span> &#123;<br>    <span class="hljs-attribute">display</span>: none;<br>&#125;<br><br><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (max-width: <span class="hljs-number">650px</span>) &#123;<br>    <span class="hljs-selector-tag">body</span> &#123;<br>        <span class="hljs-attribute">margin</span>: <span class="hljs-number">5px</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-selector-class">.editorWrap</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">80vw</span>;<br>        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;<br>    &#125;<br>    <span class="hljs-selector-class">.maximized</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">90%</span>;<br>        <span class="hljs-attribute">margin</span>: auto;<br>    &#125;<br>    <span class="hljs-selector-class">.previewWrap</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">90vw</span>;<br>        <span class="hljs-selector-id">#preview</span> &#123;<br>            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>            <span class="hljs-selector-tag">img</span> &#123;<br>                <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// MARKDOWN STYLES</span><br><span class="hljs-selector-id">#preview</span> &#123;<br>    <span class="hljs-selector-tag">blockquote</span> &#123;<br>        <span class="hljs-attribute">border-left</span>: <span class="hljs-number">3px</span> solid <span class="hljs-number">#224b4b</span>;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#224b4b</span>;<br>        <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">5px</span>;<br>        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">25px</span>;<br>    &#125;<br><br>    <span class="hljs-selector-tag">code</span> &#123;<br>        <span class="hljs-attribute">background</span>: rgba(<span class="hljs-number">9</span>, <span class="hljs-number">250</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.31</span>);<br>        <span class="hljs-attribute">padding</span>: <span class="hljs-number">1px</span> <span class="hljs-number">4px</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span>;<br>        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;<br>        <span class="hljs-attribute">font-weight</span>: bold;<br>    &#125;<br><br>    <span class="hljs-selector-tag">pre</span> &#123;<br>        <span class="hljs-attribute">background</span>: white;<br>        <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-number">5px</span>;<br>    &#125;<br><br>    <span class="hljs-selector-tag">h1</span> &#123;<br>        <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-variable">$darkAccent</span>;<br>    &#125;<br><br>    <span class="hljs-selector-tag">h2</span> &#123;<br>        <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-variable">$darkAccent</span>;<br>    &#125;<br><br>    <span class="hljs-selector-tag">table</span> &#123;<br>        <span class="hljs-attribute">border-collapse</span>: collapse;<br>    &#125;<br><br>    <span class="hljs-selector-tag">td</span>,<br>    <span class="hljs-selector-tag">th</span> &#123;<br>        <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-variable">$darkAccent</span>;<br>        <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">5px</span>;<br>        <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">5px</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>  <code>&amp;::-webkit-scrollbar &#123; width: 0 &#125;;</code>这行代码<strong>隐藏了编辑框滚动条</strong>，该特性是<strong>非标准</strong>的，请尽量不要在生产环境中使用它！</li><li>  最后的Markdown预览框渲染的标签由<strong>Marked</strong>项目自动生成，这里只是添加了一点点渲染改进</li></ul><h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs react">marked.setOptions(&#123;<br>    breaks: true,<br>    smartLists: true<br>&#125;);<br>const placeholder &#x3D; &#96;# Welcome to my React Markdown Previewer!<br><br>## This is a sub-heading...<br>### And here&#39;s some other cool stuff:<br>  <br>Heres some code, \&#96;&lt;div&gt;&lt;&#x2F;div&gt;\&#96;, between 2 backticks.<br><br>\&#96;\&#96;\&#96;<br>&#x2F;&#x2F; this is multi-line code:<br><br>function anotherExample(firstLine, lastLine) &#123;<br>  if (firstLine &#x3D;&#x3D; &#39;\&#96;\&#96;\&#96;&#39; &amp;&amp; lastLine &#x3D;&#x3D; &#39;\&#96;\&#96;\&#96;&#39;) &#123;<br>    return multiLineCode;<br>  &#125;<br>&#125;<br>\&#96;\&#96;\&#96;<br>  <br>You can also make text **bold**... whoa!<br>Or _italic_.<br>Or... wait for it... **_both!_**<br>And feel free to go crazy ~~crossing stuff out~~.<br><br>There&#39;s also [links](https:&#x2F;&#x2F;www.freecodecamp.com), and<br>&gt; Block Quotes!<br><br>And if you want to get really crazy, even tables:<br><br>Wild Header | Crazy Header | Another Header?<br>------------ | ------------- | ------------- <br>Your content can | be here, and it | can be here....<br>And here. | Okay. | I think we get it.<br><br>- And of course there are lists.<br>  - Some are bulleted.<br>     - With different indentation levels.<br>        - That look like this.<br><br><br>1. And there are numbererd lists too.<br>1. Use just 1s if you want! <br>1. But the list goes on...<br>- Even if you use dashes or asterisks.<br>* And last but not least, let&#39;s not forget embedded images:<br><br>![React Logo w&#x2F; Text](https:&#x2F;&#x2F;goo.gl&#x2F;Umyytc)<br>&#96;;<br></code></pre></td></tr></table></figure><ul><li>  <code>marked.setOptions()</code>里面是<strong>Marked</strong>的配置代码</li><li>  <code>placeholder</code>里面是<strong>默认</strong>的输入待转化字符</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs react">const Toolbar &#x3D; (props) &#x3D;&gt; &#123;<br>  return (<br>      &lt;div className&#x3D;&quot;toolbar&quot;&gt;<br>          &lt;i className&#x3D;&quot;fas fa-chess&quot; &#x2F;&gt;<br>          &#123;props.text&#125;<br>          &lt;i onClick&#x3D;&#123;props.onClick&#125; className&#x3D;&#123;props.icon&#125; &#x2F;&gt;<br>      &lt;&#x2F;div&gt;<br>  );<br>&#125;;<br>const Editor &#x3D; (props) &#x3D;&gt; &#123;<br>    return (<br>        &lt;textarea<br>            id&#x3D;&quot;editor&quot;<br>            value&#x3D;&#123;props.markdown&#125;<br>            onChange&#x3D;&#123;props.onChange&#125;<br>        &#x2F;&gt;<br>    );<br>&#125;;<br>const Preview &#x3D; (props) &#x3D;&gt; &#123;<br>    return (<br>        &lt;div<br>            id&#x3D;&quot;preview&quot;<br>            dangerouslySetInnerHTML&#x3D;&#123;&#123;<br>                __html: marked(props.markdown)<br>            &#125;&#125;<br>        &#x2F;&gt;<br>    );<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>  这部分<strong>抽离</strong>了一些React组件</li><li>  <code>dangerouslySetInnerHTML={{ __html: marked(props.markdown) }}</code>因为不合时宜的使用<code>innerHTML</code>可能会导致**cross-site scripting (XSS)**攻击。 净化用户的输入来显示的时候，经常会出现错误，不合适的净化也是导致网页攻击的原因之一。所以，<code>dangerouslySetInnerHTML</code>这个 prop 的命名是故意这么设计的，以此来警告，它的<code>prop</code>值（ 一个对象而不是字符串 ）应该被用来表明净化后的数据</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs react">class App extends React.Component &#123;<br>    constructor(props) &#123;<br>        super(props);<br>        this.state &#x3D; &#123;<br>            markdown: placeholder,<br>            editorMaximized: false,<br>            previewMaximized: false<br>        &#125;;<br>        this.handleChange &#x3D; this.handleChange.bind(this);<br>        this.handleEditorMaximize &#x3D; this.handleEditorMaximize.bind(this);<br>        this.handlePreviewMaximize &#x3D; this.handlePreviewMaximize.bind(this);<br>    &#125;<br>    handleChange(e) &#123;<br>        this.setState(&#123;<br>            markdown: e.target.value<br>        &#125;);<br>    &#125;<br>    handleEditorMaximize() &#123;<br>        this.setState((prevState) &#x3D;&gt; &#123;<br>            return &#123;editorMaximized: !prevState.editorMaximized&#125;;<br>        &#125;);<br>    &#125;<br>    handlePreviewMaximize() &#123;<br>        this.setState((prevState) &#x3D;&gt; &#123;<br>            return &#123;previewMaximized: !prevState.previewMaximized&#125;;<br>        &#125;);<br>    &#125;<br>    render() &#123;<br>        const classes &#x3D; this.state.editorMaximized<br>            ? [&quot;editorWrap maximized&quot;, &quot;previewWrap hide&quot;, &quot;fas fa-compress&quot;]<br>            : this.state.previewMaximized<br>                ? [&quot;editorWrap hide&quot;, &quot;previewWrap maximized&quot;, &quot;fas fa-compress&quot;]<br>                : [&quot;editorWrap&quot;, &quot;previewWrap&quot;, &quot;fas fa-expand&quot;];<br>        return (<br>            &lt;div&gt;<br>                &lt;div className&#x3D;&#123;classes[0]&#125;&gt;<br>                    &lt;Toolbar<br>                        icon&#x3D;&#123;classes[2]&#125;<br>                        onClick&#x3D;&#123;this.handleEditorMaximize&#125;<br>                        text&#x3D;&quot;MaverickNone&#39;s Editor&quot;<br>                    &#x2F;&gt;<br>                    &lt;Editor<br>                        markdown&#x3D;&#123;this.state.markdown&#125;<br>                        onChange&#x3D;&#123;this.handleChange&#125;<br>                    &#x2F;&gt;<br>                &lt;&#x2F;div&gt;<br>                &lt;div className&#x3D;&#123;classes[1]&#125;&gt;<br>                    &lt;Toolbar<br>                        icon&#x3D;&#123;classes[2]&#125;<br>                        onClick&#x3D;&#123;this.handlePreviewMaximize&#125;<br>                        text&#x3D;&quot;MaverickNone&#39;s Previewer&quot;<br>                    &#x2F;&gt;<br>                    &lt;Preview markdown&#x3D;&#123;this.state.markdown&#125; &#x2F;&gt;<br>                &lt;&#x2F;div&gt;<br>            &lt;&#x2F;div&gt;<br>        );<br>    &#125;<br>&#125;<br><br>ReactDOM.render(&lt;App &#x2F;&gt;, document.getElementById(&quot;app&quot;));<br></code></pre></td></tr></table></figure><ul><li>  这里使用了<strong>三目运算符</strong>，根据React保存的状态来判断是隐藏还是显示某组件（通过选择<strong>class</strong>的方式），工具栏应该用什么<strong>图标</strong></li><li>  三目运算符后面的<strong>数组</strong>用的非常巧妙，应该注意一下</li></ul><hr><h2 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h2><ol><li> 这次项目深化了<strong>React</strong>的<strong>熟练度</strong>，以及如何配合React来<strong>动态渲染CSS</strong>（比如：如何隐藏组件）</li><li> 练习了React的代码风格之一，<strong>组件抽离</strong></li><li> 这次尝试使用了<a href="https://github.com/markedjs/marked"><strong>Marked</strong></a>项目，该项目非常好用，值得推荐和收藏</li><li> 学习了如何<strong>隐藏滚动条</strong></li></ol>]]></content>
    
    
    <categories>
      
      <category>技术情报</category>
      
    </categories>
    
    
    <tags>
      
      <tag>freeCodeCamp</tag>
      
      <tag>代码 &amp; 项目</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>freeCodeCamp Certification [02]</title>
    <link href="/posts/8c7a6033/"/>
    <url>/posts/8c7a6033/</url>
    
    <content type="html"><![CDATA[<h2 id="freeCodeCamp-JavaScript-Algorithms-and-Data-Structures-Developer-Certification"><a href="#freeCodeCamp-JavaScript-Algorithms-and-Data-Structures-Developer-Certification" class="headerlink" title="freeCodeCamp JavaScript Algorithms and Data Structures Developer Certification"></a>freeCodeCamp JavaScript Algorithms and Data Structures Developer Certification</h2><h3 id="证书图片"><a href="#证书图片" class="headerlink" title="证书图片"></a>证书图片</h3><p><img src="https://i.loli.net/2019/08/12/qJeBoy5MZK1ASY7.png" alt="freeCodeCamp [02]"></p><h3 id="证书链接"><a href="#证书链接" class="headerlink" title="证书链接"></a>证书链接</h3><blockquote><p>  <a href="https://www.freecodecamp.org/certification/mavericknone/javascript-algorithms-and-data-structures">https://www.freecodecamp.org/certification/mavericknone/javascript-algorithms-and-data-structures</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>freeCodeCamp</tag>
      
      <tag>证书</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>freeCodeCamp Certification [01]</title>
    <link href="/posts/a75733f0/"/>
    <url>/posts/a75733f0/</url>
    
    <content type="html"><![CDATA[<h2 id="freeCodeCamp-Responsive-Web-Design-Developer-Certification"><a href="#freeCodeCamp-Responsive-Web-Design-Developer-Certification" class="headerlink" title="freeCodeCamp Responsive Web Design Developer Certification"></a>freeCodeCamp Responsive Web Design Developer Certification</h2><h3 id="证书图片"><a href="#证书图片" class="headerlink" title="证书图片"></a>证书图片</h3><p><img src="https://i.loli.net/2019/08/12/dfC7Nr4knFTu5sQ.png" alt="freeCodeCamp [01]"></p><h3 id="证书链接"><a href="#证书链接" class="headerlink" title="证书链接"></a>证书链接</h3><blockquote><p>  <a href="https://www.freecodecamp.org/certification/mavericknone/responsive-web-design">https://www.freecodecamp.org/certification/mavericknone/responsive-web-design</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>freeCodeCamp</tag>
      
      <tag>证书</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>5个前端静态网站设计项目展示</title>
    <link href="/posts/631bf40e/"/>
    <url>/posts/631bf40e/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=441102360&auto=1&height=66"></iframe><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><ul><li>  整理了一下前些日子5个用于<strong>练习HTML，CSS，JavaScript基础</strong>的静态网页项目</li><li>  均来自于<strong>freeCodeCamp</strong>的证书题目1~5</li><li>Link：<ul><li>  <a href="https://learn.freecodecamp.org/responsive-web-design/responsive-web-design-projects/build-a-tribute-page">Responsive Web Design Projects - Build a Tribute Page</a></li><li>  <a href="https://learn.freecodecamp.org/responsive-web-design/responsive-web-design-projects/build-a-survey-form">Responsive Web Design Projects - Build a Survey Form</a></li><li>  <a href="https://learn.freecodecamp.org/responsive-web-design/responsive-web-design-projects/build-a-product-landing-page">Responsive Web Design Projects - Build a Product Landing Page</a></li><li>  <a href="https://learn.freecodecamp.org/responsive-web-design/responsive-web-design-projects/build-a-technical-documentation-page">Responsive Web Design Projects - Build a Technical Documentation Page</a></li><li>  <a href="https://learn.freecodecamp.org/responsive-web-design/responsive-web-design-projects/build-a-personal-portfolio-webpage">Responsive Web Design Projects - Build a Personal Portfolio Webpage</a></li></ul></li></ul></blockquote><hr><h2 id="成果展示"><a href="#成果展示" class="headerlink" title="成果展示"></a>成果展示</h2><h3 id="1-Build-a-Tribute-Page"><a href="#1-Build-a-Tribute-Page" class="headerlink" title="1. Build a Tribute Page"></a>1. Build a Tribute Page</h3><p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="html,result" data-user="MaverickNone" data-slug-hash="ZdadQz" data-preview="true" style="height: 500px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Challenges [01]">  <span>See the Pen <a href="https://codepen.io/MaverickNone/pen/ZdadQz/">  Challenges [01]</a> by MaverickNone (<a href="https://codepen.io/MaverickNone">@MaverickNone</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script><h3 id="2-Build-a-Survey-Form"><a href="#2-Build-a-Survey-Form" class="headerlink" title="2. Build a Survey Form"></a>2. Build a Survey Form</h3><p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="html,result" data-user="MaverickNone" data-slug-hash="QXQBwr" data-preview="true" style="height: 500px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Challenges [02]">  <span>See the Pen <a href="https://codepen.io/MaverickNone/pen/QXQBwr/">  Challenges [02]</a> by MaverickNone (<a href="https://codepen.io/MaverickNone">@MaverickNone</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script><h3 id="3-Build-a-Product-Landing-Page"><a href="#3-Build-a-Product-Landing-Page" class="headerlink" title="3. Build a Product Landing Page"></a>3. Build a Product Landing Page</h3><p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="html,result" data-user="MaverickNone" data-slug-hash="ydvqEW" data-preview="true" style="height: 500px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Challenges [03]">  <span>See the Pen <a href="https://codepen.io/MaverickNone/pen/ydvqEW/">  Challenges [03]</a> by MaverickNone (<a href="https://codepen.io/MaverickNone">@MaverickNone</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script><h3 id="4-Build-a-Technical-Documentation-Page"><a href="#4-Build-a-Technical-Documentation-Page" class="headerlink" title="4. Build a Technical Documentation Page"></a>4. Build a Technical Documentation Page</h3><p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="html,result" data-user="MaverickNone" data-slug-hash="EBppVo" data-preview="true" style="height: 500px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Challenges [04]">  <span>See the Pen <a href="https://codepen.io/MaverickNone/pen/EBppVo/">  Challenges [04]</a> by MaverickNone (<a href="https://codepen.io/MaverickNone">@MaverickNone</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script><h3 id="5-Build-a-Personal-Portfolio-Webpage"><a href="#5-Build-a-Personal-Portfolio-Webpage" class="headerlink" title="5. Build a Personal Portfolio Webpage"></a>5. Build a Personal Portfolio Webpage</h3><p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="html,result" data-user="MaverickNone" data-slug-hash="xoJJwW" data-preview="true" style="height: 500px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Challenges [05]">  <span>See the Pen <a href="https://codepen.io/MaverickNone/pen/xoJJwW/">  Challenges [05]</a> by MaverickNone (<a href="https://codepen.io/MaverickNone">@MaverickNone</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script>]]></content>
    
    
    <categories>
      
      <category>技术情报</category>
      
    </categories>
    
    
    <tags>
      
      <tag>freeCodeCamp</tag>
      
      <tag>代码 &amp; 项目</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>槙岛圣护的书单</title>
    <link href="/posts/324ffc0d/"/>
    <url>/posts/324ffc0d/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=29736010&auto=1&height=66"></iframe><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>  这是我自己整理的在<strong>哲学领域</strong>我比较感兴趣的书籍，主要从<strong>《心理测量者》</strong>中获得的灵感，我自己也私加了一些类似书籍。粗体标记的是在《心理测量者》中直接出现的书籍。</p></blockquote><hr><h2 id="书籍清单"><a href="#书籍清单" class="headerlink" title="书籍清单"></a>书籍清单</h2><h3 id="哲学-amp-政治-amp-社会-amp-经济-amp-心理"><a href="#哲学-amp-政治-amp-社会-amp-经济-amp-心理" class="headerlink" title="哲学 &amp; 政治 &amp; 社会 &amp; 经济 &amp; 心理"></a>哲学 &amp; 政治 &amp; 社会 &amp; 经济 &amp; 心理</h3><ul><li>  <strong>《善恶的彼岸》 尼采</strong></li><li>  《悲剧的诞生》 尼采</li><li>  《查拉图斯特拉如是说》 尼采</li><li>  《权力意志》 尼采</li><li>  <strong>《论人类不平等的起源》 卢梭</strong></li><li>  《社会契约论》 卢梭</li><li>  <strong>《思想录》 布莱兹·帕斯卡尔</strong></li><li>  <strong>《大众的反叛》 奥尔特加·加塞特</strong></li><li>  《经济与社会》 马克思·韦伯</li><li>  《道德与立法原理导论》 边沁</li><li>  《规训与惩罚》 米歇尔·福柯</li><li>  《探求真理的指导原则》 笛卡尔</li><li>  《哲学原理》 笛卡尔</li><li>  《致死的疾病》 索伦·克尔凯郭尔</li><li>  《被背叛的革命》 托洛茨基</li><li>  《乌合之众》 古斯塔夫·勒庞</li><li>  《非此即彼》索伦·克尔凯郭尔</li><li>  《纯粹理性批判》 伊曼努尔·康德</li><li>  《论法的精神》 孟德斯鸠</li><li>  《形而上学伦》 伏尔泰</li><li>  《拿破仑法典》拿破仑</li><li>  《资本论》 卡尔·马克思</li><li>  《规训与惩罚：监狱的诞生》 福柯</li><li>  《当尼采在哭泣》 欧文·亚隆</li><li>  《战争论》 卡尔·冯·克劳塞维茨</li><li>  <strong>《黑皮肤，白面具》 弗朗茨·法农</strong></li><li>  <strong>《全世界受苦的人》弗朗茨·法农</strong></li><li>  《追寻生命的意义》 维克多·E·弗兰克尔</li><li>  《恐惧与战栗》 基尔克果</li><li>  《存在与虚无》 让·保罗·萨特</li><li>  《萨德我的邻居》 皮埃尔·科罗索夫斯基</li><li>  《学术与政治》 马克斯·韦伯</li></ul><h3 id="反乌托邦政治文学"><a href="#反乌托邦政治文学" class="headerlink" title="反乌托邦政治文学"></a>反乌托邦政治文学</h3><ul><li>  <strong>《1984》 乔治·奥威尔</strong></li><li>  《动物农场》 乔治·奥威尔</li><li>  《美丽新世界》 赫胥黎</li><li>  《我们》 扎米亚京</li><li>  《这完美的一天》 艾拉·莱文</li></ul><h3 id="戏剧-amp-文学"><a href="#戏剧-amp-文学" class="headerlink" title="戏剧 &amp; 文学"></a>戏剧 &amp; 文学</h3><ul><li>  <strong>《第十二夜》 莎士比亚</strong></li><li>  <strong>《泰特斯·安德洛尼克斯》 莎士比亚</strong></li><li>  <strong>《麦克白》 莎士比亚</strong></li><li>  《哈姆雷特》 莎士比亚</li><li>  <strong>《苏格拉底之死—斐多篇》 柏拉图</strong></li><li>  《理想国》 柏拉图</li><li>  《黑暗的心》 康拉德</li><li>  <strong>《预先被背叛的革命》 岩上安身 （无中文版）</strong></li><li>  《少数派报告》 菲利普·迪克</li><li>  <strong>《仿生人会梦见电子羊吗》 菲利普·迪克</strong></li><li>  《高城堡里的人》 菲利普·迪克</li><li>  <strong>《神经漫游者》 威廉·吉布森</strong></li><li>  <strong>《捍卫机密》 威廉·吉布森</strong></li><li>  <strong>《格列佛游记》 乔纳森·斯威夫特</strong></li><li>  <strong>《追忆似水年华》 马塞尔·普鲁斯特</strong></li><li>  《克苏鲁神话》 霍华德·菲利普斯·洛夫克拉夫特</li><li>  《克苏鲁神话II》霍华德·菲利普斯·洛夫克拉夫特</li><li>  《克苏鲁神话III》霍华德·菲利普斯·洛夫克拉夫特</li><li>  <strong>《再见了，电影》 寺山修司</strong></li><li>  《幻想图书馆》 寺山修司</li><li>  《道林格雷的画像》 奥斯卡·王尔德</li><li>  《钢窟》 艾萨克·阿西莫夫</li><li>  《寂静的春天》 蕾切尔·卡森</li><li>  《忏悔录》 让·雅克·卢梭</li><li>  《和谐》 伊藤计划</li><li>  《尤利西斯》 詹姆斯·乔伊斯</li><li>  <strong>《群魔》 费奥多尔・陀思妥耶夫斯基</strong></li><li>  <strong>《罪与罚》 费奥多尔・陀思妥耶夫斯基</strong></li><li>  <strong>《悪徳の栄え》【恶德之荣耀（日译）美德的不幸（中多译） 萨德（当拿迪安·阿尔风斯·法兰高斯·迪·萨德）</strong></li><li>  《人间失格》 太宰治</li></ul><h3 id="宗教"><a href="#宗教" class="headerlink" title="宗教"></a>宗教</h3><ul><li>  《圣经》</li></ul>]]></content>
    
    
    <categories>
      
      <category>认知哲思</category>
      
    </categories>
    
    
    <tags>
      
      <tag>书单</tag>
      
      <tag>心理测量者</tag>
      
      <tag>哲学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[2019-08-11] 游戏计划</title>
    <link href="/posts/3aeff5fc/"/>
    <url>/posts/3aeff5fc/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=28563214&auto=1&height=66"></iframe><h2 id="游戏计划"><a href="#游戏计划" class="headerlink" title="游戏计划"></a>游戏计划</h2><ul><li>  [ ] 【10:30】 起床，洗脸，刷牙，测体重</li><li>  [ ] 【10:40–11:20】早餐</li><li>  [ ] 【番茄工作法】【11:20–12:00】写今日安排，写博客</li><li>  [ ] 【12:00–12:40】找餐馆吃午餐</li><li>  [ ] 【番茄工作法】【12:40–03:30】继续写博客，写技术分析文章，总结前端资源列表</li><li>  [ ] 【番茄工作法】【03:30–05:30】复习微积分Anki卡片</li><li>  [ ] 【05:30–06:20】找餐馆吃晚餐，购买明天的早餐</li><li>  [ ] 【06:20–06:50】去ARC健身房</li><li>  [ ] 【06:50–09:00】健身，无氧，有氧</li><li>  [ ] 【09:00–09:40】回寝室</li><li>  [ ] 【09:40–10:20】洗澡</li><li>  [ ] 【10:20–11:20】写博客，每日总结，明日计划</li><li>  [ ] 【11:30】睡觉</li></ul>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>每日计划</tag>
      
      <tag>计划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Random Quote Machine</title>
    <link href="/posts/6a923313/"/>
    <url>/posts/6a923313/</url>
    
    <content type="html"><![CDATA[<iframe    frameborder="no"    border="0"    marginwidth="0"    marginheight="0"    width="100%"    height="86"    src="https://music.163.com/outchain/player?type=2&id=441102360&auto=1&height=66"></iframe><h2 id="前端工程展示页"><a href="#前端工程展示页" class="headerlink" title="前端工程展示页"></a>前端工程展示页</h2><h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><blockquote><ul><li>  <strong>freeCodeCamp</strong>上的证书题目6</li><li>  Link：<a href="https://learn.freecodecamp.org/front-end-libraries/front-end-libraries-projects/build-a-random-quote-machine">Front End Libraries Projects - Build a Random Quote Machine</a></li></ul></blockquote><h3 id="源代码-效果图"><a href="#源代码-效果图" class="headerlink" title="源代码 + 效果图"></a>源代码 + 效果图</h3><iframe frameborder="0" width="100%" height="500px" src="https://repl.it/@MaverickNone/Random-Quote-Machine?lite=1&outputonly=1"></iframe><p class="codepen" data-height="500" data-theme-id="dark" data-default-tab="js,result" data-user="MaverickNone" data-slug-hash="NQOwVy" data-preview="true" style="height: 500px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Challenges [06]">  <span>See the Pen <a href="https://codepen.io/MaverickNone/pen/NQOwVy/">  Challenges [06]</a> by MaverickNone (<a href="https://codepen.io/MaverickNone">@MaverickNone</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://static.codepen.io/assets/embed/ei.js"></script><br><blockquote><p>  <strong>如果客官您觉得不够大，看着不太爽！</strong>请点击<a href="https://random-quote-machine--mavericknone.repl.co/"><strong>这里</strong></a>或者<a href="https://codepen.io/MaverickNone/full/NQOwVy"><strong>这边</strong></a>~</p></blockquote><hr><h2 id="源代码解构"><a href="#源代码解构" class="headerlink" title="源代码解构"></a>源代码解构</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Test [06]<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;style.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://kit.fontawesome.com/83ef1fc2b2.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;script.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br></code></pre></td></tr></table></figure><ol><li> jQuery的添加源可以从<strong>cdnjs</strong>里面找，大部分添加源都可以找到，非常方便</li><li> 因为涉及对HTML元素的控制，jQuery的<strong>UI组件包</strong>也要添加</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;wrapper&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;quote-box&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;quote-text&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fas fa-angle-double-left&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fas fa-angle-double-right&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;quote-author&quot;</span>&gt;</span><br>                - <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;author&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;buttons&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tweet-quote&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Tweet this quote!&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fab fa-twitter&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tumblr-quote&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Post this quote on tumblr!&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fab fa-tumblr&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;new-quote&quot;</span>&gt;</span>New quote<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer&quot;</span>&gt;</span><br>            By <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://mavericknone.github.io&quot;</span>&gt;</span>MaverickNone<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>稍微可以讲的也就两点<ol><li> <code>&lt;i&gt;</code>标签原本是作为斜体文本的标记，现在常常被用于<strong>标记图标</strong></li><li> <code>&lt;span&gt;</code>标签没有固定的格式表现，其中的文本与其他文本不会任何视觉上的差异。但是可以用于<strong>孤立文本</strong>方便CSS和JavaScript对于单独控制</li></ol></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>  <code>src</code>里面的内容是<strong>freeCodeCamp</strong>对项目的质量评测系统，如果在<code>&lt;/body&gt;</code>前添加，那么就会报错<code>Uncaught TypeError: Cannot read property &#39;appendChild&#39; of null</code>，因为HTML加载的时候是从上往下加载，也就是说，当评测系统开始评测已经加载完毕开始评测的时候，需要评测的内容尚未加载完毕，所以肯定报错</li></ul><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@import</span> url(https://fonts.googleapis.com/css?family=Raleway:<span class="hljs-number">400</span>,<span class="hljs-number">500</span>);<br><span class="hljs-selector-pseudo">:root</span> &#123;<br>    --black: <span class="hljs-number">#333</span>;<br>    --white: <span class="hljs-number">#fff</span>;<br>&#125;<br>* &#123;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">list-style</span>: none;<br>&#125;<br><br><span class="hljs-selector-tag">body</span> &#123;<br>    <span class="hljs-attribute">background-color</span>: var(--black);<br>    <span class="hljs-attribute">color</span>: var(--black);<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;Raleway&quot;</span>, sans-serif;<br>    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;<br>    <span class="hljs-attribute">display</span>: flex;<br>    <span class="hljs-attribute">justify-content</span>: center;<br>    <span class="hljs-attribute">align-items</span>: center;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;<br>&#125;<br><span class="hljs-selector-class">.footer</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">450px</span>;<br>    <span class="hljs-attribute">text-align</span>: center;<br>    <span class="hljs-attribute">display</span>: block;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">15px</span> auto <span class="hljs-number">0</span> auto;<br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8em</span>;<br>    <span class="hljs-attribute">color</span>: var(--white);<br>    <span class="hljs-selector-tag">a</span> &#123;<br>        <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;<br>        <span class="hljs-attribute">text-decoration</span>: none;<br>        <span class="hljs-attribute">color</span>: var(--white);<br>    &#125;<br>&#125;<br><span class="hljs-selector-id">#quote-box</span> &#123;<br>    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">450px</span>;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span> <span class="hljs-number">50px</span>;<br>    <span class="hljs-attribute">display</span>: table;<br>    <span class="hljs-attribute">background-color</span>: var(--white);<br>    <span class="hljs-selector-class">.quote-text</span> &#123;<br>        <span class="hljs-selector-tag">i</span> &#123;<br>            <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">0.4em</span>;<br>            <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">0.4em</span>;<br>        &#125;<br>        <span class="hljs-attribute">text-align</span>: center;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">450px</span>;<br>        <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;<br>        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.75em</span>;<br>    &#125;<br>    <span class="hljs-selector-class">.quote-author</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">450px</span>;<br>        <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">20px</span>;<br>        <span class="hljs-attribute">text-align</span>: right;<br>    &#125;<br>    <span class="hljs-selector-class">.buttons</span> &#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">450px</span>;<br>        <span class="hljs-attribute">margin</span>: auto;<br>        <span class="hljs-attribute">display</span>: block;<br>        <span class="hljs-selector-class">.button</span> &#123;<br>            <span class="hljs-attribute">height</span>: <span class="hljs-number">38px</span>;<br>            <span class="hljs-attribute">border</span>: none;<br>            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;<br>            <span class="hljs-attribute">color</span>: var(--white);<br>            <span class="hljs-attribute">background-color</span>: var(--black);<br>            <span class="hljs-attribute">outline</span>: none;<br>            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.85em</span>;<br>            <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">18px</span> <span class="hljs-number">6px</span> <span class="hljs-number">18px</span>;<br>            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;<br>            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;<br>            <span class="hljs-attribute">cursor</span>: pointer;<br>            &amp;<span class="hljs-selector-pseudo">:hover</span> &#123;<br>                <span class="hljs-attribute">animation</span>: toWhite <span class="hljs-number">0.5s</span>;<br>                <span class="hljs-attribute">animation-fill-mode</span>: forwards;<br>            &#125;<br>            <span class="hljs-keyword">@keyframes</span> toWhite &#123;<br>                100% &#123;<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>&#125;<br>            &#125;<br>            &amp;#tweet-quote,<br>            &amp;#tumblr-quote &#123;<br>                float: left;<br>                <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>                <span class="hljs-attribute">text-align</span>: center;<br>                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2em</span>;<br>                <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">5px</span>;<br>                <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;<br>                <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;<br>            &#125;<br>            &amp;<span class="hljs-selector-id">#new-quote</span> &#123;<br>                <span class="hljs-attribute">float</span>: right;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li> <code>&lt;body&gt; &#123; height: 100vh; &#125;</code>这里直接将页面高度设置为整个<strong>可视页面</strong></li><li> 对于<code>&lt;i&gt;</code>标签，控制其包含的<strong>图标大小</strong>是通过调控<code>font-size</code>来实现的</li><li> 在<code>Scss</code>中，<code>&amp;</code>字符用于选择<strong>父级选择器</strong></li><li> <code>outline: none;</code>用于消除<strong>聚焦</strong>于按钮时出现的很难看的<strong>默认边框</strong></li></ol><h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs react">let quotesData,<br>    currentQuote &#x3D; &quot;&quot;,<br>    currentAuthor &#x3D; &quot;&quot;;<br><br>let colors &#x3D; [<br>    &quot;#16a085&quot;,<br>    &quot;#27ae60&quot;,<br>    &quot;#2c3e50&quot;,<br>    &quot;#f39c12&quot;,<br>    &quot;#e74c3c&quot;,<br>    &quot;#9b59b6&quot;,<br>    &quot;#FB6964&quot;,<br>    &quot;#342224&quot;,<br>    &quot;#472E32&quot;,<br>    &quot;#BDBB99&quot;,<br>    &quot;#77B1A9&quot;,<br>    &quot;#73A857&quot;<br>];<br><br>function inIframe() &#123;<br>    try &#123;<br>        return window.self !&#x3D;&#x3D; window.top;<br>    &#125; catch (err) &#123;<br>        return true;<br>    &#125;<br>&#125;<br>function openURL(url) &#123;<br>    window.open(url);<br>&#125;<br><br>function getQuotes() &#123;<br>    return $.ajax(&#123;<br>        url: &quot;https:&#x2F;&#x2F;gist.githubusercontent.com&#x2F;camperbot&#x2F;5a022b72e96c4c9585c32bf6a75f62d9&#x2F;raw&#x2F;e3c6895ce42069f0ee7e991229064f167fe8ccdc&#x2F;quotes.json&quot;,<br>        success: function(jsonQuotes) &#123;<br>            quotesData &#x3D; JSON.parse(jsonQuotes);<br>            console.log(&quot;Successfully received and processed json object!!!&quot;);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><ol><li> <code>inIframe()</code>这个函数的作用是检查当前元素是否在<strong>窗口的最顶层</strong>（是否能被看到），如果没有该函数，<code>Twitter</code>和<code>Tumblr</code>的图标就会在加载完后立马被刷下去</li><li> 本来<code>&lt;a&gt;</code>元素本身自带打开窗口的功能，但是使用<code>inIframe()</code>后，图标的<strong>Link失效</strong>，需要用<code>openURL</code>来自己写个类似的功能来手动<strong>重新实现</strong></li><li> <code>getQuotes()</code>里面是<code>jQuery</code>自带的<code>Ajax</code><strong>异步数据接收函数</strong>，本来实现类似的功能需要写一堆代码，非常繁琐，现在简化了</li><li> 接收的<code>JSON</code><strong>字符串数据</strong>需要用<code>JSON.parse()</code>来转化成<code>JavaScript</code>能够处理的<code>Object</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs react">function getRandomQuote() &#123;<br>    let randomIndex &#x3D; Math.floor(Math.random() * quotesData.quotes.length);<br>    return quotesData.quotes[randomIndex];<br>&#125;<br>function getQuote() &#123;<br>    let randomQuote &#x3D; getRandomQuote();<br>    currentQuote &#x3D; randomQuote.quote;<br>    currentAuthor &#x3D; randomQuote.author;<br>    console.log(currentQuote);<br>    console.log(&#39;By &#39;+currentAuthor);<br><br>    if (inIframe()) &#123;<br>        $(&quot;#tweet-quote&quot;).attr(<br>            &quot;href&quot;,<br>            &quot;https:&#x2F;&#x2F;twitter.com&#x2F;intent&#x2F;tweet?hashtags&#x3D;quotes&amp;related&#x3D;freecodecamp&amp;text&#x3D;&quot; +<br>                encodeURIComponent(&#39;&quot;&#39; + currentQuote + &#39;&quot; &#39; + currentAuthor)<br>        );<br>        $(&quot;#tumblr-quote&quot;).attr(<br>            &quot;href&quot;,<br>            &quot;https:&#x2F;&#x2F;www.tumblr.com&#x2F;widgets&#x2F;share&#x2F;tool?posttype&#x3D;quote&amp;tags&#x3D;quotes,freecodecamp&amp;caption&#x3D;&quot; +<br>                encodeURIComponent(currentAuthor) +<br>                &quot;&amp;content&#x3D;&quot; +<br>                encodeURIComponent(currentQuote) +<br>                &quot;&amp;canonicalUrl&#x3D;https%3A%2F%2Fwww.tumblr.com%2Fbuttons&amp;shareSource&#x3D;tumblr_share_button&quot;<br>        );<br>    &#125;<br><br>    $(&quot;.quote-text&quot;).animate(&#123; opacity: 0 &#125;, 500, function() &#123;<br>        $(this).animate(&#123;<br>            opacity: 1<br>        &#125;, 500);<br>        $(&quot;#text&quot;).text(randomQuote.quote);<br>    &#125;);<br>    $(&quot;.quote-author&quot;).animate(&#123; opacity: 0 &#125;, 500, function() &#123;<br>        $(this).animate(&#123;<br>            opacity: 1<br>        &#125;, 500);<br>        $(&quot;#author&quot;).html(randomQuote.author);<br>    &#125;);<br><br>    let randomIndex &#x3D; Math.floor(Math.random() * colors.length);<br>    console.log(colors[randomIndex]);<br><br>    $(&quot;html body&quot;).animate(&#123;<br>        backgroundColor: colors[randomIndex],<br>        color: colors[randomIndex]<br>    &#125;, 1000);<br>    $(&quot;.button&quot;).animate(&#123;<br>        backgroundColor: colors[randomIndex]<br>    &#125;, 1000);<br>&#125;<br></code></pre></td></tr></table></figure><ol><li> 记住生成固定范围的<strong>随机数</strong>的方法</li><li> 如果分享按钮在<strong>顶层界面</strong>，就只动态替换分享的链接</li><li> <code>encodeURIComponent()</code>函数可把字符串作<strong>为 URI 进行编码</strong>，实现动态分享当前quote</li><li>现在我们来仔细分析一下动画的过程发生了什么<ul><li><strong>前0.5秒</strong>：<ul><li>  文字消失，从不透明到全透明，从颜色A变成透明</li><li>  <code>&lt;body&gt;</code>元素和3个按钮从颜色A转到过渡颜色（AB之间的颜色）</li></ul></li><li><strong>后0.5秒</strong>：<ul><li>  文字出现，从全透明到不透明，从透明变成颜色B</li><li>  <code>&lt;body&gt;</code>元素和3个按钮从过渡颜色转到颜色B</li></ul></li></ul></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs react">$(document).ready(function() &#123;<br>    getQuotes().then(() &#x3D;&gt; &#123;<br>        getQuote();<br>    &#125;);<br><br>    $(&quot;#new-quote&quot;).on(&quot;click&quot;, getQuote);<br><br>    $(&quot;#tweet-quote&quot;).on(&quot;click&quot;, function() &#123;<br>        if (!inIframe()) &#123;<br>            openURL(<br>                &quot;https:&#x2F;&#x2F;twitter.com&#x2F;intent&#x2F;tweet?hashtags&#x3D;quotes&amp;related&#x3D;freecodecamp&amp;text&#x3D;&quot; +<br>                    encodeURIComponent(&#39;&quot;&#39; + currentQuote + &#39;&quot; &#39; + currentAuthor)<br>            );<br>        &#125;<br>    &#125;);<br>    $(&quot;#tumblr-quote&quot;).on(&quot;click&quot;, function() &#123;<br>        if (!inIframe()) &#123;<br>            openURL(<br>                &quot;https:&#x2F;&#x2F;www.tumblr.com&#x2F;widgets&#x2F;share&#x2F;tool?posttype&#x3D;quote&amp;tags&#x3D;quotes,freecodecamp&amp;caption&#x3D;&quot; +<br>                    encodeURIComponent(currentAuthor) +<br>                    &quot;&amp;content&#x3D;&quot; +<br>                    encodeURIComponent(currentQuote) +<br>                    &quot;&amp;canonicalUrl&#x3D;https%3A%2F%2Fwww.tumblr.com%2Fbuttons&amp;shareSource&#x3D;tumblr_share_button&quot;<br>            );<br>        &#125;<br>    &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><ol><li> <code>then()</code>方法保证<code>getQuotes()</code><strong>先得到并处理数据</strong>，然后再通过<code>getQuote()</code>呈现数据</li><li> <code>on()</code>分别<strong>绑定了3次事件</strong>，一点new quote按钮，就呈现数据（新的quote，并随机变化颜色），一点<code>Twitter</code>或者<code>Tumblr</code>按钮就分别打开各自的动态分享页面</li><li> 如果分享按钮不在<strong>顶层界面</strong>，就手动打开<strong>新界面</strong>。如果在，就啥都不做，反正原来的点击就自带打开链接的功能</li></ol><hr><h2 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h2><ul><li>  对于<strong>jQuery</strong>的很多使用细节仍然还是<strong>一知半解</strong>，仍然需要找专业的书籍来进阶提升</li><li>  对于<strong>CSS</strong>的单一特效已经有了基本认知，但是对于父元素与子元素之间的<strong>特效的组合</strong>不甚了解，也需要找专业的书籍来打好基础</li><li>  这次也花了很长时间才弄懂怎么<strong>添加外源</strong>，不过这次算是一次性全部弄懂了</li><li>  这个项目也启发了在GitHub上的<strong>Gist板块保存只读JSON</strong>的想法，用Ajax技术来传输访问</li></ul>]]></content>
    
    
    <categories>
      
      <category>技术情报</category>
      
    </categories>
    
    
    <tags>
      
      <tag>freeCodeCamp</tag>
      
      <tag>代码 &amp; 项目</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>UIUC资源情报整理</title>
    <link href="/posts/fa742e84/"/>
    <url>/posts/fa742e84/</url>
    
    <content type="html"><![CDATA[<h2 id="技术组织"><a href="#技术组织" class="headerlink" title="技术组织"></a>技术组织</h2><hr><h3 id="iRobotics"><a href="#iRobotics" class="headerlink" title="iRobotics"></a>iRobotics</h3><ul><li><p>  官网：<a href="https://irobotics.illinois.edu/">https://irobotics.illinois.edu</a></p></li><li><p>Wiki：<a href="https://irobotics.illinois.edu/wiki">https://irobotics.illinois.edu/wiki</a></p></li><li><p>Email：<a href="mailto:&#x69;&#114;&#x6f;&#x62;&#111;&#x74;&#105;&#99;&#115;&#x2e;&#x69;&#x6c;&#x6c;&#x69;&#110;&#x6f;&#105;&#x73;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#109;">&#x69;&#114;&#x6f;&#x62;&#111;&#x74;&#105;&#99;&#115;&#x2e;&#x69;&#x6c;&#x6c;&#x69;&#110;&#x6f;&#105;&#x73;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#109;</a></p></li><li><p><strong>子项目</strong></p><ul><li>  <a href="https://irobotics.illinois.edu/teams/">全部团队</a></li></ul><ol><li> <a href="https://irobotics.illinois.edu/teams/jsdc/">MRDC</a></li><li> <a href="https://irobotics.illinois.edu/teams/collegiate-vex/">VEX U</a></li><li> <a href="https://irobotics.illinois.edu/teams/combotics/">Combots</a></li><li> <a href="https://irobotics.illinois.edu/teams/robobrawl/">Robobrawl</a></li></ol></li></ul><ol start="5"><li> <a href="https://irobotics.illinois.edu/design-print-destroy/">Design.Print.Destroy!</a></li></ol><hr><h3 id="ACM-UIUC"><a href="#ACM-UIUC" class="headerlink" title="ACM@UIUC"></a>ACM@UIUC</h3><ul><li>官网：<a href="https://acm.illinois.edu/">https://acm.illinois.edu</a></li><li>Email：<a href="mailto:&#x61;&#99;&#109;&#x40;&#105;&#x6c;&#x6c;&#x69;&#110;&#111;&#x69;&#115;&#x2e;&#x65;&#100;&#x75;">&#x61;&#99;&#109;&#x40;&#105;&#x6c;&#x6c;&#x69;&#110;&#111;&#x69;&#115;&#x2e;&#x65;&#100;&#x75;</a></li><li><strong>子项目</strong><ol><li> <a href="https://reflectionsprojections.org/">Reflections|Projections</a></li><li> <a href="https://hackillinois.org/">HackIllinois</a></li><li><a href="https://acm.illinois.edu/sigs">Special Interest Groups</a><ul><li>Webmonkeys<ul><li>  Special Interest Group for Web Development</li><li>  官网：<a href="http://www.acm.illinois.edu/webmonkeys">http://www.acm.illinois.edu/webmonkeys</a></li><li>  Email：<a href="mailto:&#87;&#x65;&#98;&#x6d;&#111;&#x6e;&#x6b;&#x65;&#x79;&#x73;&#45;&#108;&#64;&#97;&#x63;&#109;&#x2e;&#x69;&#108;&#x6c;&#x69;&#x6e;&#x6f;&#105;&#115;&#x2e;&#x65;&#100;&#x75;">&#87;&#x65;&#98;&#x6d;&#111;&#x6e;&#x6b;&#x65;&#x79;&#x73;&#45;&#108;&#64;&#97;&#x63;&#109;&#x2e;&#x69;&#108;&#x6c;&#x69;&#x6e;&#x6f;&#105;&#115;&#x2e;&#x65;&#100;&#x75;</a></li></ul></li><li>SIGBot<ul><li>  Special Interest Group for Robotics</li><li>  官网：<a href="http://illinoisauv.com/">http://illinoisauv.com</a></li><li>  Email：<a href="mailto:&#83;&#73;&#71;&#x42;&#111;&#x74;&#64;&#97;&#99;&#109;&#46;&#105;&#108;&#x6c;&#105;&#x6e;&#111;&#x69;&#115;&#46;&#101;&#x64;&#117;">&#83;&#73;&#71;&#x42;&#111;&#x74;&#64;&#97;&#99;&#109;&#46;&#105;&#108;&#x6c;&#105;&#x6e;&#111;&#x69;&#115;&#46;&#101;&#x64;&#117;</a></li></ul></li><li>SIGCHI<ul><li>  Special Interest Group for Human-Computer Interaction</li><li>  官网：<a href="http://www.acm.illinois.edu/sigchi">http://www.acm.illinois.edu/sigchi</a></li><li>  Email：<a href="mailto:&#x53;&#73;&#x47;&#67;&#x48;&#x49;&#45;&#x6c;&#x40;&#x61;&#99;&#x6d;&#x2e;&#105;&#108;&#x6c;&#x69;&#110;&#111;&#105;&#115;&#46;&#x65;&#x64;&#x75;">&#x53;&#73;&#x47;&#67;&#x48;&#x49;&#45;&#x6c;&#x40;&#x61;&#99;&#x6d;&#x2e;&#105;&#108;&#x6c;&#x69;&#110;&#111;&#105;&#115;&#46;&#x65;&#x64;&#x75;</a></li></ul></li></ul></li></ol></li></ul>]]></content>
    
    
    <categories>
      
      <category>UIUC资源</category>
      
    </categories>
    
    
    <tags>
      
      <tag>UIUC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[2019-08-09] 游戏计划</title>
    <link href="/posts/5b0ea8ea/"/>
    <url>/posts/5b0ea8ea/</url>
    
    <content type="html"><![CDATA[<h2 id="游戏计划"><a href="#游戏计划" class="headerlink" title="游戏计划"></a>游戏计划</h2><ul><li>  [ ] 【07:30】 起床，洗脸，刷牙，测体重</li><li>  [ ] 【07:50–08:10】吃早餐</li><li>  [ ] 【番茄工作法】【08:10–09:30】整理和处理邮件</li><li>  [ ] 【番茄工作法】【09:30–11:30】做学校要求的sexual protection作业</li><li>  [ ] 【11:30–12:10】找餐馆吃午餐</li><li>  [ ] 【12:10–12:30】去校图书馆</li><li>  [ ] 【番茄工作法】【12:30–02:00】看CSSA的微信文章</li><li>  [ ] 【番茄工作法】【02:00–04:00】写代码，研究react和redux的项目，做freeCodeCamp的项目</li><li>  [ ] 【番茄工作法】【04:00–05:30】复习微积分Anki卡片</li><li>  [ ] 【05:30–06:20】找餐馆吃晚餐，购买明天的早餐</li><li>  [ ] 【06:20–06:50】去ARC健身房</li><li>  [ ] 【06:50–09:00】健身，无氧，有氧</li><li>  [ ] 【09:00–09:40】回寝室</li><li>  [ ] 【09:40–10:20】洗澡</li><li>  [ ] 【10:20–11:20】写博客，每日总结，明日计划</li><li>  [ ] 【11:30】睡觉</li></ul>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>每日计划</tag>
      
      <tag>计划</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>我的第1篇博客</title>
    <link href="/posts/82c40913/"/>
    <url>/posts/82c40913/</url>
    
    <content type="html"><![CDATA[<h2 id="闲话"><a href="#闲话" class="headerlink" title="闲话"></a>闲话</h2><ul><li>  以后这个博客就会作为我的正式记录文档了，可能包括<strong>游戏人生</strong>（<em>尽量坚持每天写写，包括一些每天的总结反思，日程安排等等</em>），<strong>技术情报</strong>，<strong>认知哲思</strong>，<strong>创业海盗</strong>，<strong>课程笔记</strong>，<strong>刻印术式</strong>等等板块</li><li>  以前在手机的备忘录里面写了很多的文章和摘录，都没有找到合适的途径来收藏整理，现在有了Hexo后就方便多了，我没有打算让别人看见的打算，这只是我自己的外部记忆储存罢了，如果你有幸看到，那么这些留下的东西应该能够大幅度提升你的<strong>认知复杂度</strong></li><li>  当然如果是传记作家看到的，应该能当做很有趣的素材来使用</li></ul>]]></content>
    
    
    <categories>
      
      <category>游戏人生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>闲话</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
